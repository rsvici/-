!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.PunkUI={})}(this,function(t){"use strict";function e(t,e,i){this.event=t,this.target=e,this.args=i}function n(){this._domElement=null,this._listeners={};var t=this,e=function(t){h(tt.MouseOver,t)},i=function(t){h(tt.MouseOut,t)},n=function(t){h(tt.MouseMove,t)},s=function(t){h(tt.MouseUp,t)},o=function(t){h(tt.MouseDown,t)},a=function(t){h(tt.Click,t)},l=function(t){h(tt.DblClick,t)},r=function(t){h(tt.Resize,t)},h=function(e,i){if(t._listeners.hasOwnProperty(e))for(var n=t._listeners[e],s=0,o=n.length;s<o;s++){var a=n[s],l=[i];l=null===a.args?l:l.concat(a.args),a.dispatch(l)}};this.init=function(t){this._domElement=t,t.addEventListener("mouseover",e,!1),t.addEventListener("mouseout",i,!1),t.addEventListener("mousemove",n,!1),t.addEventListener("mouseup",s,!1),t.addEventListener("mousedown",o,!1),t.addEventListener("click",a,!1),t.addEventListener("dblclick",l,!1),window.addEventListener("resize",r,!1)},this.dispose=function(){for(var t in this._listeners)if(this._listeners.hasOwnProperty(t)){for(var h=this._listeners[t],c=0,p=h.length;c<p;c++)h[c].dispose(),h[c]=null;delete this._listeners[t]}this._listeners=null;var d=this._domElement;d.removeEventListener("mouseover",e,!1),d.removeEventListener("mouseout",i,!1),d.removeEventListener("mousemove",n,!1),d.removeEventListener("mouseup",s,!1),d.removeEventListener("mousedown",o,!1),d.removeEventListener("click",a,!1),d.removeEventListener("dblclick",l,!1),window.removeEventListener("resize",r,!1),this._domElement=null}}function s(t){nt.Div.call(this),this.setId(t),this._initView()}function o(t,e,i){this.isTriggerCurrentEvent=!1,this._tabs={},this._currentTab=null,this._onSelected=null,this._target=null,this._counter=0,this._normalClass=void 0===t?"":t,this._activeClass=void 0===e?"":e,this._disableClass=void 0===i?"":i}function a(t,e,i,n){this.name="",this.tabUI=t;var s=t,o=e,a=i,r=n,h=[],c=this,p=function(){s.onClick(function(t){c.select(t)})};!function(){s.setClass(o),p()}(),this.addSelectedEvent=function(t,e){if(-1===h.indexOf(t)){var i=new l(t,e=void 0===e?c:e);h.push(i)}},this.removeSelectedEvent=function(t){for(var e=0,i=h.length;e<i;e++){var n=h[e];if(n.event===t){n.dispose(),h.splice(e,1);break}}},this.select=function(t){if(s.setClass(a),t&&null!==h)for(var e=0,i=h.length;e<i;e++)h[e].dispatch(c,t)},this.unSelect=function(){s.setClass(o)},this.setDisabled=function(t){t?s.addClass(r):s.removeClass(r)},this.dispose=function(){if(s.onClick(null),s=null,null!==h)for(var t=0,e=h.length;t<e;t++)h[t].dispose();h=null}}function l(t,e){this.event=t,this.target=e,this.dispatch=function(){null!==this.event&&this.event.apply(this.target,arguments)},this.dispose=function(){this.event=null,this.target=null}}function r(t,e,i,n){n=void 0!==n&&n,this.isOn=n,this._ui=t,this._normalClass=e,this._activeClass=i,this._switchEvent=null,this._target=null,this._arguments=null,s.call(this,name)}function h(t,e,i){if(Object.defineProperty(this,"packingId",{value:ot++}),e=void 0===e?"packingUI_"+this.packingId:e,i=void 0!==i&&i,s.call(this,e),this.updateTitle(t),this.status="close",this._switchEvent=null,this._target=null,this._arguments=null,i){var n=(new nt.A).setClass("pull-right state stateAttach");this.switchButton=new r(n,"pull-right state unuseable","pull-right state",!0),this.switchButton.setClass("ButtonSwitch"),this.switchButton.bindSwitchEvent(this._onSwitch,this),this.menubar.add(this.switchButton),this.switch(!1,!1)}}function c(t,e){this._title=t,this._onLeftClick=null,this._onRightClick=null,this.enabled=!0,s.call(this,e),this._initEventListeners()}function p(){h.call(this,"场景轴向","sceneAxisUI")}function d(t,e,i,n,o){function a(t){var e,i;e=(e=((i=t||windows.e).touches?i.touches[0].pageX-d.slideX:i.pageX-d.slideX)/d.barwidth*100)>100?100:e<0?0:e,o&&o(e/100),d.sliderSli.setStyle("width",[e+"%"]);var n=r(e);d.sliderinput.setValue(n),d._dispatchEvent(n)}function l(t){var e=t||windows.e,i=d.sliderinput.dom.value;"13"==e.keyCode&&(i=i>d._maxNum-d._minNum?d._maxNum-d._minNum:i<0?0:i,d.sliderinput.dom.value=i,i=(i-d._minNum)/(d._maxNum-d._minNum)*100,d.sliderSli.setStyle("width",[i+"%"]),o&&o(i/100))}function r(t){return t=t*(d._maxNum-d._minNum)/100+d._minNum,t=t.toFixed(p),t=t.replace(u,"")}function h(t){var e=t.offsetLeft;return null!=t.offsetParent&&(e+=h(t.offsetParent)),e}s.call(this),this.setId("slidingUI"),this._onChange=null,this._target=null,this._arguments=null,this.changeCall=o||null;var c=!1;this._minNum=t,this.default=n<this._minNum?this._minNum:n,this.default=n>this._maxNum?this._maxNum:n,this._maxNum=e;var p=i;this._width=(n-this._minNum)/(this._maxNum-this._minNum)*100;var d=this,u=/\.0/g;this.sliderSli.setStyle("width",[this._width+"%"]),this.sliderinput.dom.value=this.default,this.slideX=h(d.sliderSli.dom),this.barwidth=d.sliderBar.getStyleValue("clientWidth"),this.sliderBar.onMouseDown(function(t){t.stopPropagation(),c||(c=!0,d.slideX=h(d.sliderSli.dom),d.barwidth=d.sliderBar.getStyleValue("clientWidth")),a(t),document.addEventListener("mousemove",a,!1)}),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",a,!1)},!1),this.sliderinput.onChange(function(t){t.target.value=t.target.value<d._minNum?d._minNum:t.target.value,t.target.value=t.target.value>d._maxNum?d._maxNum:t.target.value,d._dispatchEvent(t.target.value);var e=t.target.value;e=(e-d._minNum)/(d._maxNum-d._minNum)*100,d.sliderSli.setStyle("width",[e+"%"]),d._dispatchEvent(e),o&&o(e/100)}),this.sliderinput.onKeyPress(l)}function u(t,e,i){this.ui=t,this.itemId=-1,this._normalClass=e,this._activeClass=i,this._selectedEvents=[];var n=this,s=function(){n.ui.onClick(function(t){n.select(t)})};!function(){n.ui.setClass(n._normalClass),s()}()}function v(t,e){this.canUnSelected=!1,this.isTriggerCurrentEvent=!1,this.length=0,this._list=[],this._onSelected=null,this._target=null,this._selectedItemId=-1,this._itemDefine=u,s.call(this,t),void 0!==e&&this.setClass(e)}function C(t,e,i){u.call(this,t,e,i),this.id=0,this._onSaveClickEvent=null,this._onSaveClickTarget=null,this._onDeleteClickEvent=null,this._onDeleteClickTarget=null,this._onSlideChangeEvent=null,this._onSlideChangeTarget=null,this._initEventListener()}function m(t,e){v.call(this,t,e),this._itemDefine=C,this._onSaveClickEvent=null,this._onSaveClickTarget=null,this._onDeleteClickEvent=null,this._onDeleteClickTarget=null,this._onSlideChangeEvent=null,this._onSlideChangeTarget=null}function g(){h.call(this,"相机(  )","cameraUI"),this._maxFocal=179}function y(t){this._hasColor=t,s.call(this),this._initEventListeners(),this._color="",this._onColorChange=null,this._onColorChangeTarget=null,this.tabName=""}function f(t,e,i,n,o,a){var l=this;this.transparent=!1,this.slide=new d(e,i,n,o,function(t){l.transparent?l._alpChange(1-t):l._alpChange(t)}),this._firstUpdate=!1,this._onlyColor=void 0!==a&&a,this._map=null,this._onColorChange=null,this._onColorChangeTarget=null,this._onMapChange=null,this._onMapChangeTarget=void 0,this._color="",this._isControlsShow=!1,s.call(this,t);!function(){l._map.onClick(function(t){l._onMapClick(t)})}()}function _(t,e,i){u.call(this,t,e,i),this.visible=!1,this._onClick=null,this._target=null}function w(t,e){v.call(this,t,e),this._itemDefine=_}function b(){h.call(this,"灯光","lightUI",!0)}function S(t){s.call(this,t),this.list=[],this._onSelected=null,this._target=null,this._selectedOption=null}function T(t,e,i,n,s){this.name=t,this.value=e,this.ui=i,this.index=-1,this._onSelected=null,this._target=null;var o=this;i.setClass(n),this.ui.onClick(function(t){t.preventDefault(),t.stopPropagation(),null!==o._onSelected&&o._onSelected.call(o._target,o,!0,t)}),this.select=function(){i.setClass(s);this.ui.dom;return i},this.unSelect=function(){i.setClass(n)},this.bindSelectedEvent=function(t,e){this._onSelected=void 0===t?null:t,this._target=void 0===e?this:e},this.dispose=function(){this.ui.onClick(),this.ui=null,this.name=null,this.value=null,this._onSelected=null,this._target=null}}function k(){s.call(this,"environmentUI")}function P(){h.call(this,"材质列表","materialListUI")}function I(){s.call(this,"shaderUI")}function L(t){this.view=t,this._initEventListeners()}function E(t){L.call(this,t)}function x(t){L.call(this,t),this._count=0}function D(){}function M(t){L.call(this,t),this._selectedLightIndex=-1,this._setAttrPanelVisible(!1)}function B(t){L.call(this,t)}function U(){s.call(this,"scrollBarUI"),this._target=null,this._inited=!1}function O(t){L.call(this,t),this._selectedMaterialId=-1}function A(t){L.call(this,t),this._emissiveIsMap=!0,this._shaderIndex=null}function V(){s.call(this,"sidebarUI")}function N(t){L.call(this,t),this._selectedTab="scenesTab"}function j(){s.call(this,"colorPickerUI"),this._onChange=null,this._target=null,this._inited=!1}function R(t,e,i){u.call(this,t,e,i),this._onLoadEvent=null,this._onLoadTarget=null,this._onDeleteEvent=null,this._onDeleteTarget=null,this._initEventListener()}function F(t,e){v.call(this,t,e),this._itemDefine=R,this._onLoadEvent=null,this._onLoadTarget=null,this._onDeleteEvent=null,this._onDeleteTarget=null;var i=this;!function(){st.viewDrawImage.add(i.findTidItemImg,i)}()}function H(){s.call(this),this.setClass("loadItemBox")}function X(){s.call(this),this._onMapChange=null,this._target=null}function W(t){L.call(this,t)}function Y(){h.call(this,"背景","backgroundUI")}function z(t){L.call(this,t)}function G(){s.call(this)}function Z(t){L.call(this,t),t.addPreset(1,"/assets/editor/img/light1.png"),t.addPreset(2,"/assets/editor/img/light2.png"),t.addPreset(3,"/assets/editor/img/light3.png"),t.addPreset(4,"/assets/editor/img/light4.png"),t.addPreset(5,"/assets/editor/img/light5.png"),t.addPreset(6,"/assets/editor/img/light6.png")}function K(){this._uis={}}function q(t){var e=function(){et.init(t)},i=function(){var e=lt.getUI(it.Sidebar),i=lt.getUI(it.popup);t.appendChild(e.dom),document.body.appendChild(i.dom)};!function(){i(),e()}()}var J={XL:"xLeft",XR:"xRight",YL:"yLeft",YR:"yRight",ZL:"zLeft",ZR:"zRight"},Q={LayerCommand:1},tt={MouseOver:1,MouseOut:2,MouseMove:3,MouseUp:4,MouseDown:5,Click:6,DblClick:7,Resize:8};Object.assign(e.prototype,{dispatch:function(){null!==this.event&&this.event.apply(this.target,arguments)},dispose:function(){this.event=null,this.target=null,this.args=null}}),Object.assign(n.prototype,{add:function(t,i,n){if(this._hasEventType(t)){this._listeners.hasOwnProperty(t)||(this._listeners[t]=[]);var s=this._listeners[t];if(this._findListener(s,i)>-1)return;var o=null;if(arguments.length>3){o=[];for(var a=3,l=arguments.length;a<l;a++)o.push(arguments[a])}var r=new e(i,n,o);s.push(r)}},remove:function(t,e){var n=this._listeners.hasOwnProperty(t)?this._listeners[t]:null;if(null!==n&&0!==n.length){var s=this._findListener(n,e);s>-1&&(n[i].dispose(),this._listeners[t].splice(s,1))}},_hasEventType:function(t){for(var e in tt)if(tt[e]===t)return!0;return!1},_findListener:function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i].callback===e)return i;return-1}});var et=new n,it={Menubar:0,Sidebar:1,Scene:2,Light:3,Material:4,Process:5,Animation:6,colorPicker:7,popup:8,shader:9,Background:10,Loading:11,LightPreset:12},nt={};nt.Element=function(t){this.dom=t,this.parent=null,this.children=[],this.listeners=[]},nt.Open=function(t){return nt.Div.call(this),this.value=void 0!==t&&t,this.setClass("open"),this.opendiv=new nt.Panel,this.value?(this.opendiv.setClass("on"),this.setTextContent("打开")):(this.opendiv.setClass("off"),this.setTextContent("关闭")),this.add(this.opendiv),this},nt.Element.prototype={get visible(){return"none"!==this.getStyleValue("display")},set visible(t){var e=t?"block":"none";this.setStyle("display",[e])},add:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];e instanceof nt.Element?(this.dom.appendChild(e.dom),this.children.push(e),e.parent=this):console.error("UI.Element:",e,"is not an instance of UI.Element.")}return this},remove:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];e instanceof nt.Element?(this.dom.removeChild(e.dom),this.children.splice(this.children.indexOf(e),1),e.parent=null):console.error("UI.Element:",e,"is not an instance of UI.Element.")}return this},clear:function(){for(this.remove(this.children);this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)},setId:function(t){return this.dom.id=t,this},toggleClass:function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t),this},setClass:function(t){return this.dom.className=t,this},setAttr:function(t){for(var e in t)this.dom.setAttribute(e,t[e]);return this},addClass:function(t){return this.hasClass(t)||(this.dom.className+=" "+t),this},removeClass:function(t){for(var e=this,i=this.dom.className.split(" "),n=0;n<i.length;n++)i[n]==t&&(i.splice(n,1),function(){e.dom.className="";for(var t=0;t<i.length;t++)e.addClass(i[t])}());return this},hasClass:function(t){return this.dom.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},setStyle:function(t,e){for(var i=0;i<e.length;i++)this.dom.style[t]=e[i];return this},getStyleValue:function(t){return this.dom[t]},getAttrValue:function(t){return this.dom.getAttribute(t)},setDisabled:function(t){return this.dom.disabled=t,this},setTextContent:function(t){return this.dom.textContent=t,this}},["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"].forEach(function(t){var e="set"+t.substr(0,1).toUpperCase()+t.substr(1,t.length);nt.Element.prototype[e]=function(){return this.setStyle(t,arguments),this}}),["KeyUp","KeyDown","KeyPress","MouseOver","MouseOut","MouseDown","MouseMove","Click","DblClick","Change"].forEach(function(t){var e="on"+t;nt.Element.prototype[e]=function(i){if(i)this.listeners.hasOwnProperty(e)||(this.listeners[e]=[]),this.listeners[e].push(i),this.dom.addEventListener(t.toLowerCase(),i,!1);else{var n=this.listeners[e];if(n)for(var s=0,o=n.length;s<o;s++)this.dom.removeEventListener(t.toLowerCase(),n[s],!1);this.listeners[e]=[]}return this}}),nt.Span=function(){return nt.Element.call(this),this.dom=document.createElement("span"),this},nt.Span.prototype=Object.create(nt.Element.prototype),nt.Span.prototype.constructor=nt.Span,nt.P=function(){return nt.Element.call(this),this.dom=document.createElement("p"),this},nt.P.prototype=Object.create(nt.Element.prototype),nt.P.prototype.constructor=nt.P,nt.Img=function(){return nt.Element.call(this),this.dom=document.createElement("img"),this},nt.Img.prototype=Object.create(nt.Element.prototype),nt.Img.prototype.constructor=nt.Img,nt.Br=function(){return nt.Element.call(this),this.dom=document.createElement("br"),this},nt.Br.prototype=Object.create(nt.Element.prototype),nt.Br.prototype.constructor=nt.Br,nt.Div=function(){return nt.Element.call(this),this.dom=document.createElement("div"),this},nt.Div.prototype=Object.create(nt.Element.prototype),nt.Div.prototype.constructor=nt.Div,nt.Row=function(){nt.Element.call(this);var t=document.createElement("div");return t.className="Row",this.dom=t,this},nt.Row.prototype=Object.create(nt.Element.prototype),nt.Row.prototype.constructor=nt.Row,nt.Panel=function(){nt.Element.call(this);var t=document.createElement("div");return t.className="Panel",this.dom=t,this},nt.Panel.prototype=Object.create(nt.Element.prototype),nt.Panel.prototype.constructor=nt.Panel,nt.Ul=function(){nt.Element.call(this);var t=document.createElement("ul");return this.dom=t,this},nt.Ul.prototype=Object.create(nt.Element.prototype),nt.Ul.prototype.constructor=nt.Ul,nt.Li=function(){nt.Element.call(this);var t=document.createElement("li");return this.dom=t,this},nt.Li.prototype=Object.create(nt.Element.prototype),nt.Li.prototype.constructor=nt.Li,nt.I=function(){nt.Element.call(this);var t=document.createElement("i");return this.dom=t,this},nt.I.prototype=Object.create(nt.Element.prototype),nt.I.prototype.constructor=nt.I,nt.Form=function(){nt.Element.call(this);var t=document.createElement("form");return this.dom=t,this},nt.Form.prototype=Object.create(nt.Element.prototype),nt.Form.prototype.constructor=nt.Form,nt.Label=function(){nt.Element.call(this);var t=document.createElement("label");return this.dom=t,this},nt.Label.prototype=Object.create(nt.Element.prototype),nt.Label.prototype.constructor=nt.Label,nt.A=function(){nt.Element.call(this);var t=document.createElement("a");return this.dom=t,this},nt.A.prototype=Object.create(nt.Element.prototype),nt.A.prototype.constructor=nt.A,nt.Text=function(t){nt.Element.call(this);var e=document.createElement("span");return e.className="Text",e.style.cursor="default",e.style.display="inline-block",e.style.verticalAlign="middle",this.dom=e,this.setValue(t),this},nt.Text.prototype=Object.create(nt.Element.prototype),nt.Text.prototype.constructor=nt.Text,nt.Text.prototype.getValue=function(){return this.dom.textContent},nt.Text.prototype.setValue=function(t){return void 0!==t&&(this.dom.textContent=t),this},nt.Input=function(t){nt.Element.call(this);var e=document.createElement("input");return e.className="Input",e.style.padding="2px",e.addEventListener("keydown",function(t){t.stopPropagation()},!1),this.dom=e,this.setValue(t),this},nt.Input.prototype=Object.create(nt.Element.prototype),nt.Input.prototype.constructor=nt.Input,nt.Input.prototype.getValue=function(){return this.dom.value},nt.Input.prototype.setValue=function(t){return this.dom.value=t,this},nt.TextArea=function(){nt.Element.call(this);var t=document.createElement("textarea");return t.className="TextArea",t.style.padding="2px",t.spellcheck=!1,t.addEventListener("keydown",function(e){if(e.stopPropagation(),9===e.keyCode){e.preventDefault();var i=t.selectionStart;t.value=t.value.substring(0,i)+"\t"+t.value.substring(i),t.selectionStart=i+1,t.selectionEnd=t.selectionStart}},!1),this.dom=t,this},nt.TextArea.prototype=Object.create(nt.Element.prototype),nt.TextArea.prototype.constructor=nt.TextArea,nt.TextArea.prototype.getValue=function(){return this.dom.value},nt.TextArea.prototype.setValue=function(t){return this.dom.value=t,this},nt.Select=function(){nt.Element.call(this);var t=document.createElement("select");return t.className="Select",t.style.padding="2px",this.dom=t,this},nt.Select.prototype=Object.create(nt.Element.prototype),nt.Select.prototype.constructor=nt.Select,nt.Select.prototype.setMultiple=function(t){return this.dom.multiple=t,this},nt.Select.prototype.setOptions=function(t){for(var e=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var i in t){var n=document.createElement("option");n.value=i,n.innerHTML=t[i],this.dom.appendChild(n)}return this.dom.value=e,this},nt.Select.prototype.getValue=function(){return this.dom.value},nt.Select.prototype.setValue=function(t){return t=String(t),this.dom.value!==t&&(this.dom.value=t),this},nt.Checkbox=function(t){nt.Element.call(this);var e=document.createElement("input");return e.className="Checkbox",e.type="checkbox",this.dom=e,this.setValue(t),this},nt.Checkbox.prototype=Object.create(nt.Element.prototype),nt.Checkbox.prototype.constructor=nt.Checkbox,nt.Checkbox.prototype.getValue=function(){return this.dom.checked},nt.Checkbox.prototype.setValue=function(t){return void 0!==t&&(this.dom.checked=t),this},nt.Color=function(){nt.Element.call(this);var t=document.createElement("input");t.className="Color",t.style.width="64px",t.style.height="17px",t.style.border="0px",t.style.padding="2px",t.style.backgroundColor="transparent";try{t.type="color",t.value="#ffffff"}catch(t){}return this.dom=t,this},nt.Color.prototype=Object.create(nt.Element.prototype),nt.Color.prototype.constructor=nt.Color,nt.Color.prototype.getValue=function(){return this.dom.value},nt.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},nt.Color.prototype.setValue=function(t){return this.dom.value=t,this},nt.Color.prototype.setHexValue=function(t){return this.dom.value="#"+("000000"+t.toString(16)).slice(-6),this},nt.Number=function(t){function e(t){t.preventDefault(),c=0,p=l.value,u=[t.clientX,t.clientY],document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",n,!1)}function i(t){var e=l.value;d=[t.clientX,t.clientY],c+=d[0]-u[0]-(d[1]-u[1]);var i=p+c/(t.shiftKey?5:50)*l.step;e!==(i=Math.min(l.max,Math.max(l.min,i)))&&(l.setValue(i),r.dispatchEvent(h)),u=[t.clientX,t.clientY]}function n(t){document.removeEventListener("mousemove",i,!1),document.removeEventListener("mouseup",n,!1),Math.abs(c)<2&&(r.focus(),r.select())}function s(t){l.setValue(r.value)}function o(t){r.style.backgroundColor="",r.style.cursor=""}function a(t){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}nt.Element.call(this);var l=this,r=document.createElement("input");r.className="Number",r.value="0.00",r.addEventListener("keydown",function(t){t.stopPropagation(),13===t.keyCode&&r.blur()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.dom=r,this.setValue(t);var h=document.createEvent("HTMLEvents");h.initEvent("change",!0,!0);var c=0,p=0,d=[0,0],u=[0,0];return a(),r.addEventListener("mousedown",e,!1),r.addEventListener("change",s,!1),r.addEventListener("focus",o,!1),r.addEventListener("blur",a,!1),this},nt.Number.prototype=Object.create(nt.Element.prototype),nt.Number.prototype.constructor=nt.Number,nt.Number.prototype.getValue=function(){return this.value},nt.Number.prototype.setValue=function(t){return void 0!==t&&((t=parseFloat(t))<this.min&&(t=this.min),t>this.max&&(t=this.max),this.value=t,this.dom.value=t.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this},nt.Number.prototype.setPrecision=function(t){return this.precision=t,this},nt.Number.prototype.setStep=function(t){return this.step=t,this},nt.Number.prototype.setRange=function(t,e){return this.min=t,this.max=e,this},nt.Number.prototype.setUnit=function(t){return this.unit=t,this},nt.Integer=function(t){function e(t){t.preventDefault(),c=0,p=l.value,u=[t.clientX,t.clientY],document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",n,!1)}function i(t){var e=l.value;d=[t.clientX,t.clientY],c+=d[0]-u[0]-(d[1]-u[1]);var i=p+c/(t.shiftKey?5:50)*l.step;e!==(i=0|Math.min(l.max,Math.max(l.min,i)))&&(l.setValue(i),r.dispatchEvent(h)),u=[t.clientX,t.clientY]}function n(t){document.removeEventListener("mousemove",i,!1),document.removeEventListener("mouseup",n,!1),Math.abs(c)<2&&(r.focus(),r.select())}function s(t){l.setValue(r.value)}function o(t){r.style.backgroundColor="",r.style.cursor=""}function a(t){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}nt.Element.call(this);var l=this,r=document.createElement("input");r.className="Number",r.value="0",r.addEventListener("keydown",function(t){t.stopPropagation()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.dom=r,this.setValue(t);var h=document.createEvent("HTMLEvents");h.initEvent("change",!0,!0);var c=0,p=0,d=[0,0],u=[0,0];return a(),r.addEventListener("mousedown",e,!1),r.addEventListener("change",s,!1),r.addEventListener("focus",o,!1),r.addEventListener("blur",a,!1),this},nt.Integer.prototype=Object.create(nt.Element.prototype),nt.Integer.prototype.constructor=nt.Integer,nt.Integer.prototype.getValue=function(){return this.value},nt.Integer.prototype.setValue=function(t){return void 0!==t&&(t=parseInt(t),this.value=t,this.dom.value=t),this},nt.Number.prototype.setStep=function(t){return this.step=t,this},nt.Integer.prototype.setRange=function(t,e){return this.min=t,this.max=e,this},nt.Break=function(){nt.Element.call(this);var t=document.createElement("br");return t.className="Break",this.dom=t,this},nt.Break.prototype=Object.create(nt.Element.prototype),nt.Break.prototype.constructor=nt.Break,nt.HorizontalRule=function(){nt.Element.call(this);var t=document.createElement("hr");return t.className="HorizontalRule",this.dom=t,this},nt.HorizontalRule.prototype=Object.create(nt.Element.prototype),nt.HorizontalRule.prototype.constructor=nt.HorizontalRule,nt.Button=function(t){nt.Element.call(this);var e=document.createElement("button");return this.dom=e,this.dom.textContent=t,this},nt.Button.prototype=Object.create(nt.Element.prototype),nt.Button.prototype.constructor=nt.Button,nt.Button.prototype.setLabel=function(t){return this.dom.textContent=t,this},nt.Modal=function(t){var e=this,i=document.createElement("div");return i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0,0,0,0.5)",i.style.display="none",i.style.alignItems="center",i.style.justifyContent="center",i.addEventListener("click",function(t){e.hide()}),this.dom=i,this.container=new nt.Panel,this.container.dom.style.width="200px",this.container.dom.style.padding="20px",this.container.dom.style.backgroundColor="#ffffff",this.container.dom.style.boxShadow="0px 5px 10px rgba(0,0,0,0.5)",this.add(this.container),this},nt.Modal.prototype=Object.create(nt.Element.prototype),nt.Modal.prototype.constructor=nt.Modal,nt.Modal.prototype.show=function(t){return this.container.clear(),this.container.add(t),this.dom.style.display="flex",this},nt.Modal.prototype.hide=function(){return this.dom.style.display="none",this},nt.Canvas=function(){return nt.Element.call(this),this.dom=document.createElement("canvas"),this},nt.Canvas.prototype=Object.create(nt.Element.prototype),nt.Canvas.prototype.constructor=nt.Canvas,s.prototype=Object.create(nt.Div.prototype),s.prototype.constructor=s,s.prototype._initView=function(){},s.prototype.setVisible=function(t){this.visible=t},s.prototype.dispose=function(){null!==this.parent&&this.parent.remove(this)},Object.assign(o.prototype,{addTab:function(t,e,i,n,s){e=void 0===e?this._counter:e,i=void 0===i?this._normalClass:i,n=void 0===n?this._activeClass:n,s=void 0===s?this._disableClass:s,"string"!=typeof e&&"number"!=typeof e&&(console.warn("Tab : type "+typeof e+" is not allowed!!"),e=this._counter);var o=this,l=new a(t,i,n,s);return l.name=e,l.addSelectedEvent(function(t,e){o.switchTab(t,void 0,e)},o),this._tabs[e]=l,this._counter++,l},removeTab:function(t){this._tabs.hasOwnProperty(t.name)&&(t.dispose(),delete this._tabs[t.name])},switchTab:function(t,e,i){var n;if(t instanceof a)n=t;else{if("string"!=typeof t&&"number"!=typeof t)return void console.warn("Tab : type "+t+" is not allowed!!");n=this._tabs[t]}(this._currentTab!==n||this.isTriggerCurrentEvent)&&(e=void 0===e||e,null!==this._currentTab&&this._currentTab.unSelect(),this._currentTab=n,n.select(),e&&null!==this._onSelected&&this._onSelected.call(this._target,n,i))},bindSelected:function(t,e){this._onSelected=t,this._target=e},dispose:function(){for(var t in this._tabs)this._tabs.hasOwnProperty(t)&&this._tabs[t].dispose();this._tabs=null,this._currentTab=null,this._onSelected=null,this._target=null}}),r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype._initView=function(){var t=this;this._ui.setClass(this.isOn?this._activeClass:this._normalClass),this.add(this._ui),this._ui.onClick(function(e){t.switch(void 0,!0,e)})},r.prototype.bindSwitchEvent=function(t,e){if(this._switchEvent=void 0===t?null:t,this._target=void 0===e?this:e,arguments.length>2){this._arguments=[];for(var i=2,n=arguments.length;i<n;i++)this._arguments.push(arguments[i])}},r.prototype.switch=function(t,e,i){if(e=void 0===e||e,this.isOn=void 0===t?!this.isOn:t,this._ui.setClass(this.isOn?this._activeClass:this._normalClass),!1!==e&&null!==this._switchEvent){var n=[this.isOn,i];n=null===this._arguments?n:n.concat(this._arguments),this._switchEvent.apply(this._target,n)}},r.prototype.dispose=function(){s.prototype.dispose.call(this),this._ui=null,this._switchEvent=null,this._target=null,this._arguments=null};var st=Punk.PunkEvents,ot=0;h.prototype=Object.create(s.prototype),h.prototype.constructor=h,h.prototype._initView=function(){var t=this,e=t.setClass("widget-wrapper");this.menubar=(new nt.Div).setClass("widgetHeader"),this.triangle=(new nt.I).setClass("fa fa-sort-desc widget-triangle"),this.title=(new nt.Div).setClass("widgetTitle"),this.menubar.add(this.triangle,this.title),this.packArea=(new nt.Div).setClass("widgetBody"),this.menubar.onClick(function(){t.updateStatus()}),e.add(this.menubar,this.packArea)},h.prototype.updateStatus=function(){"close"==this.status?this.slideUp():this.slideDown(),this.status="close"==this.status?"open":"close"},h.prototype.slideUp=function(){this.packArea.addClass("closed"),this.triangle.removeClass("fa-sort-desc").addClass("fa-caret-right").setStyle("top",["0"])},h.prototype.slideDown=function(){this.packArea.removeClass("closed"),this.triangle.removeClass("fa-caret-right").addClass("fa-sort-desc").setStyle("top",["-3px"])},h.prototype.updateTitle=function(t){void 0!==t&&"string"==typeof t&&this.title.setTextContent(t),void 0!==t&&"object"==typeof t&&this.title.add(t)},h.prototype.addMenuUI=function(t){this.menubar.add(t)},h.prototype.addContent=function(t){for(var e=0,i=arguments.length;e<i;e++)this.packArea.add(arguments[e])},h.prototype.removeContent=function(t){for(var e=0,i=arguments.length;e<i;e++)this.packArea.remove(arguments[e])},h.prototype.switch=function(t,e){e=void 0===e||e,this.switchButton.switch(t,!1),this._onSwitch(this.switchButton.isOn,void 0,e)},h.prototype.bindSwitchEvent=function(t,e){if(this._switchEvent=void 0===t?null:t,this._target=void 0===e?this:e,arguments.length>2){this._arguments=[];for(var i=2,n=arguments.length;i<n;i++)this._arguments.push(arguments[i])}},h.prototype._onSwitch=function(t,e,i){if(e&&(e.stopPropagation(),st.clickEventsStopPushed.dispatch()),t?this.packArea.removeClass("disActive"):this.packArea.addClass("disActive"),!1!==i&&null!==this._switchEvent){var n=[t,e];n=null===this._arguments?n:n.concat(this._arguments),this._switchEvent.apply(this._target,n)}},c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.prototype._initView=function(){var t=this,e=(new nt.I).setClass("fa fa-caret-left"),i=(new nt.Div).setClass("scene-m").setTextContent(this._title),n=(new nt.I).setClass("fa fa-caret-right");this.buttonLeft=(new nt.Div).setClass("scene-l").add(e),this.buttonRight=(new nt.Div).setClass("scene-r").add(n),t.setClass("scene-control"),t.add(this.buttonLeft,i,this.buttonRight)},c.prototype._initEventListeners=function(){var t=this;this.buttonLeft.onClick(function(e){t._leftClick(e)}),this.buttonRight.onClick(function(e){t._rightClick(e)})},c.prototype._leftClick=function(t){this.enabled&&(t.preventDefault(),t.stopPropagation(),null!==this._onLeftClick&&this._onLeftClick())},c.prototype._rightClick=function(t){this.enabled&&(t.preventDefault(),t.stopPropagation(),null!==this._onRightClick&&this._onRightClick())},c.prototype.bindEvents=function(t,e){void 0===t||"function"!=typeof t&&null!==t||(this._onLeftClick=t),void 0===e||"function"!=typeof e&&null!==e||(this._onRightClick=e)},c.prototype.dispose=function(){s.prototype.dispose.call(this),this.buttonLeft.onClick(null),this.buttonRight.onClick(null)},p.prototype=Object.create(h.prototype),p.prototype.constructor=p,p.prototype._initView=function(){h.prototype._initView.call(this);var t=(new nt.Div).setClass("scene-control-comp");this.arrowX=new c("X"),this.arrowY=new c("Y"),this.arrowZ=new c("Z"),t.add(this.arrowX,this.arrowY,this.arrowZ),this.addContent(t)},d.prototype=Object.create(s.prototype),d.prototype.constructor=d,d.prototype._initView=function(){var t=(new nt.Div).setClass("widget-slider"),e=(new nt.Div).setClass("children"),i=(new nt.Div).setClass("widget slider-widget"),n=(new nt.Div).setClass("widget-slider");this.sliderBar=(new nt.Div).setClass("bar"),this.sliderSli=(new nt.Div).setClass("slide");var s=(new nt.Div).setClass("cursor"),o=(new nt.Div).setClass("widget number-widget"),a=(new nt.Div).setClass("widget-slider");this.sliderinput=(new nt.Input).setClass("value edited"),a.add(this.sliderinput),o.add(a),this.sliderSli.add(s),this.sliderBar.add(this.sliderSli),n.add(this.sliderBar),i.add(n),e.add(i,o),t.add(e),this.add(t)},d.prototype.setValue=function(t,e){e=!0===e;var i=t<this._minNum?this._minNum:t,n=(i-this._minNum)/(this._maxNum-this._minNum)*100;this.sliderinput.dom.value=i,this.sliderSli.setStyle("width",[n+"%"]),this.changeCall&&this.changeCall(n/100),e&&this._dispatchEvent(i)},d.prototype._dispatchEvent=function(t){if(null!=this._onChange){var e=[t,null];e=null===this._arguments?e:e.concat(this._arguments),this._onChange.apply(this._target,e)}},d.prototype.bindChange=function(t,e){if("function"==typeof t?(this._onChange=t,this._target=e||this):(this._onChange=null,this._target=null),arguments.length>2){this._arguments=[];for(var i=2,n=arguments.length;i<n;i++)this._arguments.push(arguments[i])}},d.prototype.dispose=function(){s.prototype.dispose.call(this),this._onChange=null,this._target=null,this._arguments=null},Object.assign(u.prototype,{addSelectedEvent:function(t,i){if(-1===this._selectedEvents.indexOf(t)){var n=new e(t,i=void 0===i?this:i);this._selectedEvents.push(n)}},removeSelectedEvent:function(t){for(var e=0,i=this._selectedEvents.length;e<i;e++){var n=this._selectedEvents[e];if(n.event===t){n.dispose(),this._selectedEvents.splice(e,1);break}}},select:function(t){if(this.ui.setClass(this._activeClass),t&&null!==this._selectedEvents)for(var e=0,i=this._selectedEvents.length;e<i;e++)this._selectedEvents[e].dispatch(this,t)},unSelect:function(){this.ui.setClass(this._normalClass)},dispose:function(){if(this.ui.onClick(null),this.ui=null,null!==this._selectedEvents)for(var t=0,e=this._selectedEvents.length;t<e;t++)this._selectedEvents[t].dispose();this._selectedEvents=null}}),v.prototype=Object.create(s.prototype),v.prototype.constructor=v,v.prototype.addItem=function(t,e,i){t.setClass(e);var n=this,s=this,o=new this._itemDefine(t,e,i);return o.itemId=this.length,o.addSelectedEvent(function(t){s.select(t.itemId,!1),s._onSelected&&s._onSelected.call(s._target,t)},s),n.add(o.ui),this._list.push(o),this.length++,o},v.prototype.removeItem=function(t,e){e=void 0===e?"itemId":e;for(var i=0,n=this._list.length;i<n;i++){var s=this._list[i];if(s[e]===t)return this.remove(s.ui),s.dispose(),this._list.splice(i,1),!0}return!1},v.prototype.getItem=function(t,e){e=void 0===e?"itemId":e;for(var i=0,n=this._list.length;i<n;i++){var s=this._list[i];if(s[e]===t)return s}return null},v.prototype.bindSelected=function(t,e){this._onSelected=t,this._target=t?e instanceof Object?e:this:null},v.prototype.select=function(t,e){e=!1!==e;var i=this._selectedItemId;if(i!==t||this.canUnSelected||this.isTriggerCurrentEvent){if((i!==t||this.canUnSelected)&&this.unSelect(),i!==t){this._selectedItemId=t;var n=this.getItem(t);n.select()}e&&this._onSelected&&this._onSelected.call(this._target,n)}},v.prototype.unSelect=function(){this._selectedItemId>-1&&this.getItem(this._selectedItemId).unSelect(),this._selectedItemId=-1},v.prototype.dispose=function(){for(var t=0,e=this._list.length;t<e;t++)this._list[t].dispose();this._list=null,this._onSelected=null,this._target=null},C.prototype=Object.create(u.prototype),C.prototype.constructor=C,C.prototype._initEventListener=function(){var t=this;this.ui.slide.bindChange(this._onSlideChange,this),this.ui.saveButton.onClick(function(e){t._onSaveButtonClick(e)}),this.ui.deleteButton&&this.ui.deleteButton.onClick(function(e){t._onDeleteButtonClick(e)})},C.prototype.bindClickEvent=function(t,e,i,n,s,o){this._onSaveClickEvent="function"==typeof t?t:null,this._onSaveClickTarget=e instanceof Object?e:null,this._onDeleteClickEvent="function"==typeof i?i:null,this._onDeleteClickTarget=n instanceof Object?n:null,this._onSlideChangeEvent="function"==typeof s?s:null,this._onSlideChangeTarget=o instanceof Object?o:null},C.prototype.select=function(t){u.prototype.select.call(this,t),this.ui.hasOwnProperty("deleteButton")&&this.ui.deleteButton.setStyle("display",["inline"]),this.ui.slide.sliderBar.removeClass("slideActive"),this.ui.slide.sliderSli.removeClass("sliActive")},C.prototype.unSelect=function(){u.prototype.unSelect.call(this),this.ui.hasOwnProperty("deleteButton")&&this.ui.deleteButton.setStyle("display",["none"])},C.prototype.updateTitle=function(t){var e=t>0?"相机"+t:"默认相机";this.ui.cameraTitle.setTextContent(e)},C.prototype.updateFov=function(t){this.ui.slide.setValue(t)},C.prototype.updatePic=function(t){this.ui.cameraImg.setAttr({src:t})},C.prototype._onSaveButtonClick=function(t){t.stopPropagation(),this._onSaveClickEvent&&this._onSaveClickEvent.call(this._onSaveClickTarget,this.id)},C.prototype._onDeleteButtonClick=function(t){t.stopPropagation(),this._onDeleteClickEvent&&this._onDeleteClickEvent.call(this._onDeleteClickTarget,this.id)},C.prototype._onSlideChange=function(t){this._onSlideChangeEvent&&this._onSlideChangeEvent.call(this._onSlideChangeTarget,this.id,t)},C.prototype._removeEventListener=function(){this.ui.slide.bindChange(),this.ui.saveButton.onClick(),this.ui.deleteButton&&this.ui.deleteButton.onClick()},C.prototype.dispose=function(){this._removeEventListener(),u.prototype.dispose.call(this),this._onSaveClickEvent=null,this._onSaveClickTarget=null,this._onDeleteClickEvent=null,this._onDeleteClickTarget=null,this._onSlideChangeEvent=null,this._onSlideChangeTarget=null},m.prototype=Object.create(v.prototype),m.prototype.constructor=m,m.prototype.addItem=function(t,e,i){var n=v.prototype.addItem.call(this,t,e,i);return n.bindClickEvent(this._onSaveButtonClick,this,this._onDeleteButtonClick,this,this._onSlideChange,this),n},m.prototype.bindListClickEvent=function(t,e,i,n,s,o){this._onSaveClickEvent="function"==typeof t?t:null,this._onSaveClickTarget=e instanceof Object?e:null,this._onDeleteClickEvent="function"==typeof i?i:null,this._onDeleteClickTarget=n instanceof Object?n:null,this._onSlideChangeEvent="function"==typeof s?s:null,this._onSlideChangeTarget=o instanceof Object?o:null},m.prototype._onSaveButtonClick=function(t){this._onSaveClickEvent&&this._onSaveClickEvent.call(this._onSaveClickTarget,t)},m.prototype._onDeleteButtonClick=function(t){this.unSelect(),this._onDeleteClickEvent&&this._onDeleteClickEvent.call(this._onDeleteClickTarget,t)},m.prototype._onSlideChange=function(t,e){this._onSlideChangeEvent&&this._onSlideChangeEvent.call(this._onSlideChangeTarget,t,e)},m.prototype.updateFov=function(t,e){var i=this.getItem(t,"id");i&&(i.updateFov(e.fov),e.img&&i.updatePic(e.img))},m.prototype.updatePic=function(t,e){var i=this.getItem(t,"id");i&&i.updatePic(e)},m.prototype._initSelect=function(){this._list[0]&&this._list[0].select()},m.prototype.removeItem=function(t,e){v.prototype.removeItem.call(this,t,e)&&this.updateTitles()},m.prototype.updateTitles=function(){for(var t=0,e=this._list.length;t<e;t++)this._list[t].updateTitle(t)},m.prototype._updateSelect=function(t){return this._list[this._list.length-1].select(),this._list[this._list.length-1].id},m.prototype._selectOne=function(t){for(var e=0,i=this._list.length;e<i;e++)this._list[e].itemId==t?this._list[e].select():this._list[e].unSelect()},g.prototype=Object.create(h.prototype),g.prototype.constructor=g,g.prototype._initView=function(){h.prototype._initView.call(this),this.cameraList=new m("cameraList"),this.buttonAddCamera=(new nt.I).setClass("fa fa-plus widget-right-icon"),this.addMenuUI(this.buttonAddCamera),this.addContent(this.cameraList)},g.prototype.addCamera=function(t,e){var i=(new nt.Div).setClass("children-container"),n=(new nt.Div).setClass("children-content"),s=(new nt.Div).setClass("label-header"),o=(new nt.Div).setClass("label-body"),a=t>0?"相机"+t:"默认相机",l=(new nt.Span).setTextContent(a),r=(new nt.Div).setClass("text-right"),h=(new nt.I).setClass("fa fa-camera"),c=(new nt.I).setClass("fa fa-trash").setStyle("margin-left",["8px"]),p=(new nt.Div).setClass("widget-inner"),u=(new nt.Div).setClass("widget-body-content"),v=(new nt.Div).setClass("widget-layout-left"),C=(new nt.Div).setClass("widget-layout-right"),m=(new nt.Div).setClass("widgetPreview").addClass("box-background"),g=(new nt.Div).setStyle("width",[]),y=(new nt.Img).setAttr({width:"100%",height:"100%"}),f=(new nt.P).setClass("widget-body-title"),_=(new nt.Div).setClass("widget-body-slider"),w=new d(1,this._maxFocal,1,e.fov);return p.add(u),u.add(v,C),v.add(m),C.add(_),g.add(y),m.add(g),_.add(f,w),o.add(p),r.add(h),s.add(l,r),n.add(s,o),i.add(n),i.cameraTitle=l,i.saveButton=h,t>0&&(r.add(c),i.deleteButton=c),i.cameraImg=y,i.slide=w,this.cameraList.addItem(i,"children-container","children-container active")},y.prototype=Object.create(s.prototype),y.prototype.constructor=y,y.prototype._initView=function(){var t=this._createTabPanel();this.setClass("selectBox active"),this.add(t)},y.prototype._createTabPanel=function(){var t=(new nt.Div).setClass("widget"),e=(new nt.Ul).setClass("list-unstyled selectTabs"),i=(new nt.Li).setClass("tab"),n=(new nt.Li).setClass("tab"),s=(new nt.A).setTextContent("贴图"),a=(new nt.A).setTextContent("颜色"),l=(new nt.Div).setClass("switchContent"),r=(new nt.Div).setClass("manageCtrlCont");return this.panel1Tab=new nt.Div,this.panel1TabBtn=(new nt.Button).addClass("btn fileBtn btn-block").setTextContent("文件管理"),this.panel1Tab.add(this.panel1TabBtn),this.panel2Tab=new nt.Div,r.add(this.panel1Tab,this.panel2Tab),l.add(r),i.add(s),n.add(a),"noColor"===this._hasColor?e.add(i):e.add(i,n),t.add(e,l),this.tab=new o("tab","tab active"),this.tab.addTab(i,"tabFile"),"noColor"!==this._hasColor&&this.tab.addTab(n,"tabColor"),this.tab.bindSelected(this._onSwitchTab,this),this.tab.switchTab("tabFile"),this.tab.isTriggerCurrentEvent=!0,t},y.prototype.bindColorChange=function(t,e){this._onColorChange=void 0===t?null:t,this._onColorChangeTarget=void 0===e?this:e},y.prototype.setColor=function(t){this._color=t},y.prototype._onSwitchTab=function(t,e){"tabFile"===t.name&&(this.tabName="tabFile"),this.panel1Tab.setClass("tabFile"===t.name?"tab-panel active":"tab-panel"),this.panel2Tab.setClass("tabColor"===t.name?"tab-panel active":"tab-panel"),e&&e.stopPropagation(),"tabColor"===t.name&&(this.tabName="tabColor",this.colorPicker=lt.getUI(it.colorPicker),this.colorPicker.bindColorChange(this._onColorMove,this),this.panel2Tab.add(this.colorPicker),this.colorPicker.setColor(this._color))},y.prototype._initEventListeners=function(){var t=this;this.panel1TabBtn.onClick(function(){t._fileCtrl()})},y.prototype._fileCtrl=function(){lt.getUI(it.popup).setVisible(!0)},y.prototype._onColorMove=function(t){this.setColor(t),this._onColorChange&&this._onColorChange.call(this._onColorChangeTarget,t)},y.prototype.reflashColor=function(t){$(this.colorPicker.dom).spectrum("set",t)},y.prototype.dispose=function(){s.prototype.dispose.call(this)},f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype._initView=function(){var t=this.setClass("ControlContainer"),e=(new nt.Div).setClass("ColorPreviewContainer"),i=(new nt.Div).setClass("ColorControlBarBox"),n=(new nt.Div).setClass("previewContent");this.previewContent=new nt.Div,this.previewContent.setStyle("display",["none"]),this.alpDiv=(new nt.Div).setClass("thumb_shade"),this.prevContCanvas=(new nt.Canvas).setClass("false-preview"),this._map=(new nt.A).setClass("display").setStyle("position",["relative"]),this._map.add(this.alpDiv,this.prevContCanvas),this._map.add(this.prevContCanvas),this.prevContCanvas.dom.width=28,this.prevContCanvas.dom.height=28,n.add(this._map,this.previewContent),this._onlyColor&&"noColor"!=this._onlyColor||("noColor"===this._onlyColor?this.fileManage=new y("noColor"):this.fileManage=new y,this.previewContent.add(this.fileManage)),i.add(this.slide),e.add(n),t.add(e,i)},f.prototype._alpChange=function(t){this.alpDiv.setStyle("opacity",[1-t])},f.prototype._onMapClick=function(t){this._isControlsShow||(t.stopPropagation(),st.clickEventsStopPushed.dispatch(),this._onlyColor&&"noColor"!==this._onlyColor?(this.colorPicker=lt.getUI(it.colorPicker),this.colorPicker.bindColorChange(this._drawColor,this),this.previewContent.add(this.colorPicker),this.colorPicker.setColor(this._color)):(this.fileManage.bindColorChange(this._drawColor,this),lt.getUI(it.popup).bindMapChange(this._drawMap,this),this.fileManage.colorPicker&&"tabColor"===this.fileManage.tabName&&this.fileManage.reflashColor(this._color)),this.previewContent.setStyle("display",["block"]),et.add(tt.Click,this._onClick,this),st.clickEventsStopPushed.add(this._onClick,this),this._isControlsShow=!0)},f.prototype._onClick=function(){this._isControlsShow&&(this.previewContent.setStyle("display",["none"]),et.remove(tt.Click,this._onClick,this),st.clickEventsStopPushed.remove(this._onClick,this),this._isControlsShow=!1)},f.prototype.bindChange=function(t,e,i){this.slide.bindChange(t,e),this.transparent=i},f.prototype.bindMapChange=function(t,e){this._onMapChange=void 0===t?null:t,this._onMapChangeTarget=e},f.prototype.bindColorChange=function(t,e){this._onColorChange=void 0===t?null:t,this._onColorChangeTarget=void 0===e?this:e},f.prototype.setColor=function(t){this._color=t,this.fileManage&&this.fileManage.setColor(t)},f.prototype.updateColor=function(t){var e=this.prevContCanvas.dom,i=e.getContext("2d"),n=e.width,s=e.height;i.clearRect(0,0,n,s),i.fillStyle=t,i.fillRect(0,0,n,s),this.setColor(t)},f.prototype.updateMap=function(t){if(t){var e=this.prevContCanvas.dom;st.drawImageToCanvas.dispatch(e,t)}else this.updateColor("#ffffff")},f.prototype.dispose=function(){s.prototype.dispose.call(this),this.slide.dispose(),this.slide=null,this._map.onClick(),this._map=null,this._onMapChange=null,this._onMapChangeTarget=null},f.prototype._drawColor=function(t){this.updateColor(t),this._onColorChange&&this._onColorChange.call(this._onColorChangeTarget,t)},f.prototype._drawMap=function(t){t?this.updateMap(t):this.updateColor("#ffffff"),this._onMapChange&&this._onMapChange.call(this._onMapChangeTarget,t)},_.prototype=Object.create(u.prototype),_.prototype.constructor=_,_.prototype.setVisible=function(t){t=void 0===t?!this.visible:t,this.visible=t,t?this.ui.eye.addClass("active"):this.ui.eye.removeClass("active")},_.prototype.setEyeVisible=function(t){this.ui.eye.setStyle("display",[t?"block":"none"])},_.prototype.bindClickEvent=function(t,e){var i=this;this._onClick=void 0===t?null:t,this._target=void 0===e?this:e,this.ui.eye.onClick(function(t){t.stopPropagation(),i.setVisible(),i._onClick&&i._onClick.call(i._target,i)})},w.prototype=Object.create(v.prototype),w.prototype.constructor=w,w.prototype._initView=function(){},b.prototype=Object.create(h.prototype),b.prototype.constructor=b,b.prototype._initView=function(){h.prototype._initView.call(this);var t=(new nt.Div).setClass("children-container"),e=(new nt.Div).setClass("children-content").setStyle("position",["relative"]);this.buttonLoadLight=(new nt.Div).setClass("loadLight").setTextContent("加载灯光预设"),this.buttonSaveLight=(new nt.Div).setClass("saveLight").setTextContent('保存灯光配置到"我的预设"'),this.lightList=new w("lightListUI","lightsContainer"),this.lightList.canUnSelected=!0,this.lightAttrPanel=this._createLightAttrPanel(),e.add(this.lightList,this.lightAttrPanel),t.add(e),this.addContent(t)},b.prototype._createLightAttrPanel=function(){var t=(new nt.Div).setClass("lightAttr"),e=(new nt.Div).setClass("label-header").setStyle("background-color","#666"),i=(new nt.Div).setClass("label-body specialTop specialBottom"),n=(new nt.Span).setTextContent("灯光属性"),s=(new nt.Div).setClass("atrrtabs"),a=(new nt.Div).setTextContent("关闭"),l=(new nt.Div).setTextContent("平行光"),r=(new nt.Div).setTextContent("点光源"),h=(new nt.Div).setTextContent("聚光灯"),c=(new nt.Div).setTextContent("球光"),p=(new nt.Div).setClass("tab").setStyle("display",["block"]),u=new f("lightColorSet",0,100,1,100,!0),v=(new nt.Div).setClass("weaken"),C=(new nt.Span).setClass("color-white").setTextContent("衰减"),m=new d(0,100,1,100);v.add(C,m);var g=(new nt.Div).setClass("SLAngleweaken"),y=(new nt.Span).setClass("color-white").setTextContent("张角"),_=new d(1,90,1,100);g.add(y,_);var w=(new nt.Div).setClass("SLSoftweaken"),b=(new nt.Span).setClass("color-white").setTextContent("软化"),S=new d(0,100,1,100);w.add(b,S),s.add(a,l,r,h,c),p.add(u,v,g,w),i.add(s,p),e.add(n),t.add(e,i);var T=new o("tab","tab active");return T.addTab(a,"tabClose"),T.addTab(l,"tabDirectLight"),T.addTab(r,"tabPointLight"),T.addTab(h,"tabSpotLight"),T.addTab(c,"tabHemiLight"),t.decayContainer=v,t.angleContainer=g,t.penumbraContainer=w,t.colorUI=u,t.slideDecay=m,t.slideAngle=_,t.slidePenumbra=S,t.lightTab=T,t},b.prototype.updateLightName=function(t,e){var i=this.lightList.getItem(t,"lightId"),n=this._getNameByLightType(e);i.ui.lightName.setTextContent(n)},b.prototype.switchLight=function(t,e){if(this.hideChildren(),e){var i=this.lightAttrPanel;switch(i.colorUI.setVisible(!0),e){case Punk.DirectionalLight:break;case Punk.PointLight:i.decayContainer.setStyle("display",["block"]);break;case Punk.SpotLight:i.decayContainer.setStyle("display",["block"]),i.angleContainer.setStyle("display",["block"]),i.penumbraContainer.setStyle("display",["block"]);break;case Punk.HemisphereLight:}this.updateLightName(t,e)}},b.prototype.hideChildren=function(){var t=this.lightAttrPanel;t.colorUI.setVisible(!1),t.decayContainer.setStyle("display",["none"]),t.angleContainer.setStyle("display",["none"]),t.penumbraContainer.setStyle("display",["none"])},b.prototype.addLightItem=function(t,e,i){i=!1!==i;var n=this._getNameByLightType(e),s=(new nt.Div).setClass("lightItemOne clearfix"),o=(new nt.Span).setClass("pull-left").setTextContent(n),a=(new nt.I).setClass("fa fa-eye pull-right");s.eye=a,s.lightName=o,s.add(o,a);var l=this.lightList.addItem(s,"lightItemOne clearfix","lightItemOne clearfix active");return l.lightId=t,e?l.setVisible(i):l.setEyeVisible(!1),l},b.prototype._getNameByLightType=function(t){var e="无";switch(t){case Punk.DirectionalLight:e="平行光";break;case Punk.PointLight:e="点光源";break;case Punk.SpotLight:e="聚光灯";break;case Punk.HemisphereLight:e="球光"}return e},S.prototype=Object.create(s.prototype),S.prototype.constructor=S,S.prototype._initView=function(){var t=this.setClass("selectorList"),e=(new nt.Div).setClass("select"),i=(new nt.I).setClass("pull-right fa fa-sort-desc");this.selectOptions=(new nt.Ul).setClass("list-unstyled selectOptions"),this.selectTitle=(new nt.Span).setClass("pull-left selectTitle").setTextContent(""),e.add(this.selectTitle,i),t.add(e,this.selectOptions);var n=this;e.onClick(function(t){t.preventDefault(),t.stopPropagation(),n.selectOptions.toggleClass("active")})},S.prototype.makeAlign=function(){},S.prototype.addOption=function(t,e,i,n,s){var o=new T(e,i,t,n,s);return o.bindSelectedEvent(this.selectOption,this),o.index=this.list.length,this.list.push(o),this.selectOptions.add(o.ui),o},S.prototype.getOption=function(t,e){e=void 0===e?"index":e;for(var i=0,n=this.list.length;i<n;i++){var s=this.list[i];if(s[e]===t)return s}return null},S.prototype.selectOption=function(t,e,i){"number"==typeof t&&(t=this.list[t]),this._selectedOption!==t&&(null!==this._selectedOption&&this._selectedOption.unSelect(),this._selectedOption=t,this._selectedOption.select(),this.selectTitle.setTextContent(t.name),this.makeAlign(),this.selectOptions.removeClass("active"),!1!==e&&this._onSelected.call(this._target,t.value,i))},S.prototype.bindSelectedEvent=function(t,e){this._onSelected=void 0===t?null:t,this._target=void 0===e?this:e},S.prototype.dispose=function(){for(var t=0,e=this.list.length;t<e;t++)this.list[t].dispose();this.list=null,this.selectOptions=null,this.selectTitle=null,this._onSelected=null,this._target=null,this._selectedOption=null},k.prototype=Object.create(h.prototype),k.prototype.constructor=k,k.prototype._initView=function(){var t=this._createEnvironmentUI();this.add(t)},k.prototype._createEnvironmentUI=function(){var t=(new nt.Span).setClass("smll").setTextContent("Environment"),e=new h((new nt.Div).setClass("centerDiv").setTextContent("环境贴图").add(t).setStyle("padding-left",[0]),"environmentUI",!1),i=(new nt.Div).setClass("children-container"),n=(new nt.Div).setClass("children-content"),s=(new nt.Div).setClass("selectContent"),o=(new nt.Div).setClass("selectContainer"),a=this._createEnvironmentPanel(),l=this._settingBackUI(),c=(new nt.Div).setClass("setBack").setTextContent("已设置为背景"),p=(new nt.Div).setClass("setBlur"),d=(new nt.P).setClass("BlurText").setTextContent("模糊开关"),u=(new nt.Span).setClass("blurSub").setTextContent("Blur"),v=(new nt.A).setClass("pull-right state stateAttach");return this.switchBulr=new r(v,"pull-right state unuseable","pull-right state",!0),this.switchBulr.setClass("BulrSwitch"),p.add(d,u,this.switchBulr),s.add(a,l,c,p),o.add(s),n.add(o),i.add(n),e.addContent(i),e},k.prototype._createEnvironmentPanel=function(){return this.selectBar=(new nt.Div).setClass("select active"),this.selector=new S("envSelector"),this.selector},k.prototype.addOption=function(t,e,i){var n=(new nt.Li).setClass("options"),s=(new nt.Div).setClass("optionsContentRow"),o=(new nt.Img).setClass("optionImg"),a=(new nt.Span).setClass("optionText");o.dom.src=i,o.dom.width="32",o.dom.height="32",a.setTextContent(t),s.add(o,a),n.add(s),this.selector.addOption(n,t,e,"options","options active").skyId=parseInt(e)},k.prototype._settingBackUI=function(){var t=(new nt.Div).setClass("environmentPreview");return this.environPreviewImg=new nt.Img,this.environPreviewImg.width="100%",this.environPreviewImg.height="100%",t.add(this.environPreviewImg),t},k.prototype._envdeflectUI=function(){var t=(new nt.Div).setClass("envdeflect"),e=(new nt.Span).setClass("color-white").setTextContent("偏转"),i=new d(0,25,1,9.2);return t.add(e,i),t},k.prototype._lightDegreeUI=function(){var t=(new nt.Div).setClass("lightDegree"),e=(new nt.Span).setClass("color-white").setTextContent("亮度"),i=new d(0,25,1,9.2);return t.add(e,i),t},k.prototype._geneShadowUI=function(){var t=(new nt.Div).setClass("spanSwitch clearfix"),e=(new nt.Div).setClass("switchLeft pull-left").setTextContent("生成投影"),i=(new nt.Div).setClass("pull-right"),n=(new nt.A).setClass("state");return i.add(n),t.add(e,i),t},k.prototype._shadowSlopUI=function(){var t=(new nt.Div).setClass("shadowSlop"),e=(new nt.Span).setClass("color-white").setTextContent("投影倾斜"),i=new d(0,25,1,9.2);return t.add(e,i),t},k.prototype._enAutoRotateUI=function(){var t=(new nt.Div).setClass("lightAutoRotate"),e=(new nt.Span).setClass("color-white").setTextContent("灯光自旋"),i=(new nt.Div).setClass("lightRoteContainer"),n=(new nt.Div).setClass("lightRoteCloseTab").setTextContent("关闭"),s=(new nt.Div).setClass("slowTab").setTextContent("慢"),o=(new nt.Div).setClass("middleTab").setTextContent("中"),a=(new nt.Div).setClass("fastTab").setTextContent("快");return i.add(n,s,o,a),t.add(e,i),i},P.prototype=Object.create(h.prototype),P.prototype.constructor=P,P.prototype._initView=function(){h.prototype._initView.call(this);var t=(new nt.Div).setClass("children-container"),e=(new nt.Div).setClass("children-content");this.materialList=new v("materialListUI","materialList"),e.add(this.materialList),t.add(e),this.addContent(t)},P.prototype.addItem=function(t,e){var i=(new nt.I).setClass("fa fa-circle-o"),n=(new nt.Span).setTextContent(e),s=(new nt.Div).add(i,n),o=this.materialList.addItem(s,"","listItemOne active");o.materialId=t,o.icon=i},P.prototype.updateHasTexture=function(t,e){this.materialList.getItem(t).icon.setClass(e?"fa fa-circle":"fa fa-circle-o")},I.prototype=Object.create(s.prototype),I.prototype.constructor=I,I.prototype._initView=function(){var t=this;this.shaderPanel=this._createShaderPanel(),t.add(this.shaderPanel),this.workflowPanel=this._createWorkflow(),t.add(this.workflowPanel),this.wireFrameColor=this._createWirefraemcolor(),t.add(this.wireFrameColor),this.mapPanel=this._createMapPanel(),t.add(this.mapPanel),this.specularMapPanel=this._createSpecularMapPanel(),t.add(this.specularMapPanel),this.metalnessPanel=this._createMetalnessPanel(),t.add(this.metalnessPanel),this.bumpPanel=this._createBumpPanel(),t.add(this.bumpPanel),this.aoPanel=this._createAOPanel(),t.add(this.aoPanel),this.cavityPanel=this._createPanel("细节(Cavity)");var e=(new nt.Span).setClass("smll").setTextContent("Transparency"),i=(new nt.Div).setClass("centerDiv").setTextContent("透明度").add(e).setStyle("padding-left",[0]);this.transparencyPanel=this._createPanel(i,"transparencyMapUI",!0),t.add(this.transparencyPanel);var n=(new nt.Span).setClass("smll").setTextContent("Emission"),s=(new nt.Div).setClass("centerDiv").setTextContent("自发光").add(n).setStyle("padding-left",[0]);this.emissionPanel=this._createPanel(s,"emissionMapUI",!0),t.add(this.emissionPanel);var o=(new nt.Span).setClass("smll").setTextContent("Displacement"),a=(new nt.Div).setClass("centerDiv").setTextContent("置换").add(o).setStyle("padding-left",[0]);this.displacementPanel=this._createPanel(a,"displacementMapUI",!0),t.add(this.displacementPanel),this.sidePanel=this._createSidePanel(),t.add(this.sidePanel),this.splitPanel=this._createSplitPanel()},I.prototype.updateShaderPanel=function(t,e){switch(this.hideChildren(),t){case Punk.ShaderType.NOSHADER:this.showNoShaderPanel();break;case Punk.ShaderType.PBR:this.showPBRPanel(e);break;case Punk.ShaderType.Wireframe:this.showWireframePanel();break;case Punk.ShaderType.MATCAP:this.showMatCapPanel()}},I.prototype.showNoShaderPanel=function(){this.mapPanel.setVisible(!0),this.transparencyPanel.setVisible(!0)},I.prototype.showPBRPanel=function(t){t?this.metalnessPanel.setVisible(!0):this.specularMapPanel.setVisible(!0),this.workflowPanel.setVisible(!0),this.mapPanel.setVisible(!0),this.bumpPanel.setVisible(!0),this.aoPanel.setVisible(!0),this.transparencyPanel.setVisible(!0),this.emissionPanel.setVisible(!0),this.displacementPanel.setVisible(!0)},I.prototype.showWireframePanel=function(){this.wireFrameColor.setVisible(!0),this.sidePanel.setVisible(!0)},I.prototype.showMatCapPanel=function(){this.bumpPanel.setVisible(!0),this.transparencyPanel.setVisible(!0),this.displacementPanel.setVisible(!0)},I.prototype.hideChildren=function(){this.workflowPanel.setVisible(!1),this.mapPanel.setVisible(!1),this.specularMapPanel.setVisible(!1),this.metalnessPanel.setVisible(!1),this.bumpPanel.setVisible(!1),this.aoPanel.setVisible(!1),this.transparencyPanel.setVisible(!1),this.emissionPanel.setVisible(!1),this.displacementPanel.setVisible(!1),this.wireFrameColor.setVisible(!1)},I.prototype._createShaderPanel=function(){var t=this._createBasePanel("着色器"),e=(new nt.Div).setClass("label-header").setStyle("background-color","#666"),i=(new nt.Div).setClass("label-body specialBottom"),n=(new nt.Span).setTextContent("着色器预设"),s=function(){return{container:(new nt.Div).setClass("itemsColor"),selectors:[],onSelected:null,eventTarget:null,addPresets:function(t,e,i,n){var s=this,o=(new nt.Div).setClass(t).setAttr({"data-tab":e});return o.onClick(function(){null!==s.onSelected&&s.onSelected.call(s.eventTarget,o)}),this.container.add(o),s.selectors.push(o),o.shaderIndex=n,o.type=i,o},select:function(t,e){if(t){for(var i=0,n=this.selectors.length;i<n;i++)this.selectors[i].hasClass("choose-active")&&this.selectors[i].removeClass("choose-active");this.selectors[t].addClass("choose-active")}else{for(var i=0,n=this.selectors.length;i<n;i++)this.selectors[i].hasClass("choose-active")&&this.selectors[i].removeClass("choose-active");e===Punk.ShaderType.PBR&&this.selectors[0].addClass("choose-active"),e===Punk.ShaderType.NOSHADER&&this.selectors[1].addClass("choose-active"),e===Punk.ShaderType.Wireframe&&this.selectors[2].addClass("choose-active")}},bindSelected:function(t,e){this.onSelected=t,this.eventTarget=void 0===e?this:e},dispose:function(){for(var t=0,e=this.selectors.length;t<e;t++)this.selectors[t].onClick();this.onSelected=null}}}();s.addPresets("colourOne","PBR",Punk.ShaderType.PBR),s.addPresets("colourTwo","无shader",Punk.ShaderType.NOSHADER),s.addPresets("colourThree","线框图",Punk.ShaderType.Wireframe),s.addPresets("colourFour","MatCap",Punk.ShaderType.MATCAP,3),s.addPresets("colourFive","MatCap",Punk.ShaderType.MATCAP,4),s.addPresets("colourSix","MatCap",Punk.ShaderType.MATCAP,5),s.addPresets("colourSeven","MatCap",Punk.ShaderType.MATCAP,6),s.addPresets("colourEight","MatCap",Punk.ShaderType.MATCAP,7);var a=(new nt.P).setClass("color-white").setTextContent("着色器类型"),l=(new nt.P).setClass("color-white").setTextContent("着色方式"),r=(new nt.Div).setClass("colourItemTag"),h=(new nt.Div).setClass("color-white noShader").setTextContent("无Shader"),c=(new nt.Div).setClass("color-white pbrTab").setTextContent("PBR"),p=(new nt.Div).setClass("color-white pbrTab").setTextContent("线框图"),d=(new nt.Div).setClass("color-white matcapTab").setTextContent("Matcap"),u=(new nt.Div).setClass("colourWayContainer"),v=(new nt.Div).setClass("color-white").setTextContent("光滑组"),C=(new nt.Div).setClass("color-white").setTextContent("平面");r.add(h,c,p,d),u.add(v,C),e.add(n),i.add(s.container,a,r,l,u),t.addUI(e,i);var m=new o;m.addTab(h,"noShaderTab","color-white noShader","color-white noShader active"),m.addTab(c,"pbrTab","color-white pbrTab","color-white pbrTab active"),m.addTab(p,"wireframeTab","color-white wireframeTab","color-white wireframeTab active"),m.addTab(d,"matCapTab","color-white matcapTab","color-white matcapTab active");var g=new o;return g.smoothTab=g.addTab(v,"smoothTab","color-white","color-white active"),g.flatTab=g.addTab(C,"floatTab","color-white","color-white active"),t.colorPresets=s,t.shaderTab=m,t.methodTab=g,t},I.prototype._createWorkflow=function(){var t=this._createBasePanel("工作流程"),e=(new nt.Div).setClass("workFlowContainer"),i=(new nt.Div).setClass("metalFlow"),n=(new nt.Div).setClass("hightLightFlow"),s=(new nt.Span).setClass("smll").setTextContent("Metalness"),a=(new nt.Span).setClass("smll").setTextContent("Specular"),l=(new nt.Div).setClass("centerDiv").setTextContent("金属性").add(s),r=(new nt.Div).setClass("centerDiv").setTextContent("高光").add(a);i.add(l),n.add(r),e.add(i,n),t.addUI(e);var h=new o;return h.addTab(i,"metalTab","metalFlow","metalFlow active"),h.addTab(n,"specularTab","hightLightFlow","hightLightFlow active"),t.tab=h,t},I.prototype._createMapPanel=function(){var t=(new nt.Span).setClass("smll").setTextContent("Base/Diffuse/Albedo"),e=(new nt.Div).setClass("centerDiv").setTextContent("基色/固有色").add(t).setStyle("padding-left",[0]),i=this._createBasePanel(e),n=new f("mapSet",0,100,1,100);return i.addUI(n),i.mapUI=n,i},I.prototype._createSpecularMapPanel=function(){var t=(new nt.Span).setClass("smll").setTextContent("Specular"),e=(new nt.Div).setClass("centerDiv").setTextContent("高光").add(t).setStyle("padding-left",[0]),i=this._createBasePanel(e),n=new f("colorMapSet",0,100,1,100),s=(new nt.Div).setClass("roughGlossiContainer").setStyle("margin",["10px 0"]),a=(new nt.Div).setClass("roughness"),l=(new nt.Div).setClass("glossiness"),r=(new nt.Span).setClass("smll").setTextContent("Roughness"),h=(new nt.Span).setClass("smll").setTextContent("Glossiness"),c=new f("glossinessMapSet",0,100,1,100,"noColor"),p=(new nt.Div).setClass("centerDiv").setTextContent("粗糙度").add(r),d=(new nt.Div).setClass("centerDiv").setTextContent("光泽度").add(h);a.add(p),l.add(d),s.add(a,l),i.addUI(n,s,c);var u=new o;return u.addTab(a,"roughnessTab","roughness","roughness active"),u.addTab(l,"glossinessTab","glossiness","glossiness active"),i.colorMapUI=n,i.glossinessMapUI=c,i.tab=u,i},I.prototype._createMetalnessPanel=function(){var t=(new nt.Span).setClass("smll").setTextContent("Metalness"),e=(new nt.Div).setClass("centerDiv").setTextContent("金属性").add(t).setStyle("padding-left",[0]),i=this._createBasePanel(e),n=(new nt.P).setClass("color-white").setTextContent("金属性"),s=(new nt.Span).setClass("smll").setTextContent("Metalness"),a=(new nt.P).setClass("color-white").setTextContent("菲涅尔式高光衰减"),l=new f("metalnessMapSet",0,100,1,100,"noColor"),r=new f("specularMapSet",0,100,1,100,"noColor"),h=(new nt.Span).setClass("smll").setTextContent("Specular F0");a.add(h);var c=(new nt.Div).setClass("roughGlossiContainer").setStyle("margin",["10px 0"]),p=(new nt.Div).setClass("roughness"),d=(new nt.Div).setClass("glossiness"),u=new f("colorMapSet",0,100,1,100,"noColor"),v=(new nt.Div).setClass("centerDiv"),C=(new nt.Div).setClass("centerDiv"),m=(new nt.Span).setClass("smll").setTextContent("Roughness"),g=(new nt.Span).setClass("smll").setTextContent("Glossiness");v.setTextContent("粗糙度").add(m),C.setTextContent("光泽度").add(g),p.add(v),d.add(C),n.add(s),c.add(p,d),i.addUI(n,l,c,u);var y=new o;return y.addTab(p,"roughnessTab","roughness","roughness active"),y.addTab(d,"glossinessTab","glossiness","glossiness active"),i.metalnessMapUI=l,i.specularMapUI=r,i.colorMapUI=u,i.tab=y,i},I.prototype._createBumpPanel=function(){var t=(new nt.Span).setClass("smll").setTextContent("Normal/Bump"),e=(new nt.Div).setClass("centerDiv").setTextContent("法线/凹凸").add(t).setStyle("padding-left",[0]),i=this._createBasePanel(e,"bumpMapUI",!0),n=(new nt.Div).setClass("normalContainer").setStyle("margin",["0 0 10px"]),s=(new nt.Div).setClass("normal"),a=(new nt.Div).setClass("bump"),l=new f("colorMapSet",0,100,1,100),r=(new nt.Span).setClass("smll").setTextContent("Normal"),h=(new nt.Span).setClass("smll").setTextContent("Bump"),c=(new nt.Span).setClass("smll").setTextContent("法线"),p=(new nt.Span).setClass("smll").setTextContent("凹凸"),d=(new nt.Div).setClass("centerDiv").add(c).add(r),u=(new nt.Div).setClass("centerDiv").add(p).add(h);s.add(d),a.add(u);var v=(new nt.Div).setClass("diyDirection"),C=(new nt.A).setClass("correct-symble"),m=(new nt.Span).setClass("direction-show-advan-rote").setTextContent("翻转绿色通道(-Y)");v.add(C,m),n.add(s,a),i.addUI(n,l,v);var g=new o;return g.addTab(s,"normalTab","normal","normal active"),g.addTab(a,"bumpTab","bump","bump active"),i.colorMapUI=l,i.rotateYButton=v,i.tab=g,i},I.prototype._createAOPanel=function(){var t=(new nt.Span).setClass("smll").setTextContent("AO"),e=(new nt.Div).setClass("centerDiv").setTextContent("环境光遮蔽").add(t).setStyle("padding-left",[0]),i=this._createBasePanel(e,"aoMapUI",!0),n=new f("colorMapSet",0,100,1,100,"noColor"),s=(new nt.Div).setClass("diyDirection"),o=(new nt.A).setClass("correct-symble"),a=(new nt.Span).setClass("direction-show-advan-rote").setTextContent("遮蔽高光");return s.add(o,a),i.addUI(n,s),i.colorMapUI=n,i.occlusionButton=s,i},I.prototype._createPanel=function(t,e,i,n,s,o,a,l){n=void 0===n?0:n,s=void 0===s?100:s,o=void 0===o?1:o,a=void 0===a?0:a,"emissionMapUI"!==e&&(l="noColor");var r=this._createBasePanel(t,e,i),h=new f("colorMapSet",n,s,o,a,l);return r.addUI(h),r.colorMapUI=h,r},I.prototype._createSidePanel=function(){var t=this._createBasePanel("单双面切换"),e=(new nt.Div).setClass("pageSwitchContainer"),i=(new nt.Div).setClass("normal").setTextContent("单面"),n=(new nt.Div).setClass("bump").setTextContent("双面");e.add(i,n),t.addUI(e);var s=new o;return s.addTab(i,"frontTab","normal","normal active"),s.addTab(n,"doubleTab","bump","bump active"),t.tab=s,t},I.prototype._createWirefraemcolor=function(){var t=(new nt.Span).setClass("smll").setTextContent("/Frameonly"),e=(new nt.Div).setClass("centerDiv").setTextContent("线框").add(t).setStyle("padding-left",[0]),i=this._createBasePanel(e),n=(new nt.Span).setClass("smll").setTextContent("Frame Color"),s=(new nt.P).setClass("color-white").setTextContent("线框颜色").add(n),o=new f("wireMapSet",0,100,1,100,!0);return i.addUI(s,o),i.wireMapUI=o,i},I.prototype._createSplitPanel=function(){var t=this._createBasePanel("强制细分"),e=(new nt.Div).setClass("splitContainer"),i=(new nt.Div).setClass("noSplit").setTextContent("无细分"),n=(new nt.Div).setClass("doubleSplit").setTextContent("x2"),s=(new nt.Div).setClass("twoDoubleSplit").setTextContent("x4");e.add(i,n,s),t.addUI(e);var a=new o;return a.addTab(i,"noSplitTab","noSplit","noSplit active"),a.addTab(n,"splitX2Tab","doubleSplit","doubleSplit active"),a.addTab(s,"splitX4Tab","twoDoubleSplit","twoDoubleSplit active"),t.tab=a,t},I.prototype._createBasePanel=function(t,e,i){var n=new h(t,e,i),s=(new nt.Div).setClass("children-container"),o=(new nt.Div).setClass("children-content");return s.add(o),n.addContent(s),n.addUI=function(){for(var t=0,e=arguments.length;t<e;t++)o.add(arguments[t])},n},I.prototype.dispose=function(){s.prototype.dispose.call(this)},Object.assign(L.prototype,{focus:function(){},blur:function(){},dispose:function(){this._removeEventListeners()},_initEventListeners:function(){st.worldCreated.add(this._onWorldCreated,this)},_onWorldCreated:function(){},_removeEventListeners:function(){st.worldCreated.remove(this._onWorldCreated,this)}}),E.prototype=Object.create(L.prototype),E.prototype.constructor=E,E.prototype._initEventListeners=function(){this.view.arrowX.bindEvents(this._xLeftClick,this._xRightClick),this.view.arrowY.bindEvents(this._yLeftClick,this._yRightClick),this.view.arrowZ.bindEvents(this._zLeftClick,this._zRightClick)},E.prototype._xLeftClick=function(){st.switchCommand.dispatch(J.XL)},E.prototype._xRightClick=function(){st.switchCommand.dispatch(J.XR)},E.prototype._yLeftClick=function(){st.switchCommand.dispatch(J.YL)},E.prototype._yRightClick=function(){st.switchCommand.dispatch(J.YR)},E.prototype._zLeftClick=function(){st.switchCommand.dispatch(J.ZL)},E.prototype._zRightClick=function(){st.switchCommand.dispatch(J.ZR)},E.prototype._removeEventListeners=function(){this.view.arrowX.bindEvents(null,null),this.view.arrowY.bindEvents(null,null),this.view.arrowZ.bindEvents(null,null)},x.prototype=Object.create(L.prototype),x.prototype.constructor=x,x.prototype._initEventListeners=function(){var t=this;this.view.buttonAddCamera.onClick(function(e){navigator.userAgent.indexOf("MSIE")>=0&&navigator.userAgent.indexOf("Opera")<0?e.cancelBubble=!0:e.stopPropagation(),t._addCameraConfig()}),st.cameraConfigAdded.add(this._onCameraConfigAdded,this),st.cameraConfigChanged.add(this._onCameraConfigChanged,this),st.stopUIReact.add(this._stopUIReact,this),st.beginUIReact.add(this._beginUIReact,this),st.ViewPicSaved.add(this._ViewPicSaved,this),st.initCameraImg.add(this._initCameraImg,this),st.viewSelectedCamera.add(this._viewSelectCamera,this),this.view.cameraList.bindListClickEvent(this._onSaveButtonClick,this,this._onRemoveButtonClick,this,this._onSlideChange,this),this.view.cameraList.bindSelected(this._onCameraUISelect,this)},x.prototype._addCameraConfig=function(){st.viewAddCameraConfig.dispatch()},x.prototype._viewSelectCamera=function(t){this.view.cameraList._selectOne(t)},x.prototype._initCameraImg=function(t,e){var i="/uploads/camera/"+e+"/camera_"+(parseInt(t)+1)+".png";this.view.cameraList.updatePic(t,i)},x.prototype._isHasImg=function(t){var e=new Image;return e.src=t,e.fileSize>0||e.width>0&&e.height>0},x.prototype._addCameraItem=function(t,e){this.view.addCamera(t,e).id=t,this._count++,this._updateCameraSum(),0!==t&&st.cameraSaveButton.dispatch(t),this.view.cameraList.updateTitles()},x.prototype._updateCameraSum=function(){this.view.updateTitle("相机("+this._count+")")},x.prototype._onSlideChange=function(t,e){st.viewFovChanged.dispatch(t,e)},x.prototype._onSaveButtonClick=function(t){st.viewSaveCameraConfig.dispatch(t),st.cameraSaveButton.dispatch(t)},x.prototype._ViewPicSaved=function(t,e){this.view.cameraList.updatePic(t,e)},x.prototype._onRemoveButtonClick=function(t){st.viewDeleteCameraConfig.dispatch(t),this.view.cameraList.removeItem(t);var e=this.view.cameraList._updateSelect(t);this._nextAnimation(e),this._count--,this._updateCameraSum()},x.prototype._onCameraConfigAdded=function(t,e){this._addCameraItem(t,e)},x.prototype._onCameraConfigChanged=function(t,e){this.view.cameraList.updateFov(t,e)},x.prototype._stopUIReact=function(){this.view.parent.setClass("widget-wrapper noActive")},x.prototype._beginUIReact=function(){this.view.parent.removeClass("noActive")},x.prototype._onCameraUISelect=function(t){st.viewCameraConfigChanged.dispatch(t.id),this.view.cameraList._selectOne(t.id)},x.prototype._nextAnimation=function(t){st.viewCameraConfigChanged.dispatch(t)},x.prototype._removeEventListeners=function(){L.prototype._removeEventListeners.call(this),this.view.buttonAddCamera.onClick(),st.ViewPicSaved.remove(this._ViewPicSaved,this),this.view.cameraList.bindListClickEvent(),this.view.cameraList.bindSelected()},Object.assign(D.prototype,{getValueScale:function(t,e,i){return i=void 0===i?100:i,t/e*i},getRandom:function(t,e){return parseInt(Math.random()*(t-e+1)+e,10)}});var at=new D;M.prototype=Object.create(L.prototype),M.prototype.constructor=M,M.prototype._initEventListeners=function(){L.prototype._initEventListeners.call(this);var t=this.view.buttonLoadLight,e=this.view.lightAttrPanel,i=this.view.lightList,n=this;this.view.bindSwitchEvent(this._onSwitch,this),t.onClick(function(){n._loadLightPreset()}),i.bindSelected(this._onSelectLight,this),e.colorUI.bindChange(this._onColorValueChange,this),e.colorUI.bindColorChange(this._onColorChange,this),e.slideDecay.bindChange(this._onDecayChange,this),e.slideAngle.bindChange(this._onAngleChange,this),e.slidePenumbra.bindChange(this._onPenumbraChange,this),e.lightTab.bindSelected(this._onLightTabSelected,this),st.lightTypeChanged.add(this._onLightTypeChanged,this),st.lightSelected.add(this._onLightSelected,this),st.lightUnSelected.add(this._onLightUnSelected,this),st.lightsAdded.add(this._onLightsAdded,this),st.lightsStatusChanged.add(this._onSwitchAllLights,this)},M.prototype.blur=function(){st.viewModeChanged.dispatch("Light",!1)},M.prototype.focus=function(){st.viewModeChanged.dispatch("Light",!0)},M.prototype._onLightsAdded=function(t){for(var e,i=0,n=t.length;i<n;i++)e=t[i],this.view.addLightItem(i,e.lightType,!1!==e.visible).bindClickEvent(this._onEyeClick,this)},M.prototype._onSwitchAllLights=function(t){this.view.switch(t)},M.prototype._onSwitch=function(t){st.setLightStatus.dispatch(null,t)},M.prototype._onEyeClick=function(t){st.setLightStatus.dispatch(t.lightId,t.visible),t.lightId===this._selectedLightIndex&&this._setAttrPanelVisible(t.visible)},M.prototype._loadLightPreset=function(){lt.appendUI(it.LightPreset)},M.prototype._onSelectLight=function(t){st.selectLight.dispatch(t.lightId)},M.prototype._onColorChange=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"color",t)},M.prototype._onColorValueChange=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"intensity",parseFloat(t))},M.prototype._onDecayChange=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"decay",parseFloat(t))},M.prototype._onAngleChange=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"angle",parseFloat(t))},M.prototype._onPenumbraChange=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"penumbra",parseFloat(t))},M.prototype._onLightTabSelected=function(t){var e="";switch(t.name){case"tabDirectLight":e=Punk.DirectionalLight;break;case"tabPointLight":e=Punk.PointLight;break;case"tabSpotLight":e=Punk.SpotLight;break;case"tabHemiLight":e=Punk.HemisphereLight}st.updateLightType.dispatch(this._selectedLightIndex,e)},M.prototype._updatePanel=function(t,e){var i=this.view.lightAttrPanel;this.view.switchLight(t,e.lightType),e.lightType&&(i.colorUI.updateColor(e.color),i.colorUI.slide.setValue(this._transferValue("intensity",e.intensity,100,e.lightType)),i.slideDecay.setValue(this._transferValue("decay",e.decay)),i.slideAngle.setValue(this._transferValue("angle",e.angle)),i.slidePenumbra.setValue(this._transferValue("penumbra",e.penumbra)),e.castShadow)},M.prototype._onLightTypeChanged=function(t,e){var i=null!==e.lightType;this.view.updateLightName(t,e.lightType);var n=this.view.lightList.getItem(t,"lightId");n.setEyeVisible(i),i&&n.setVisible(!1!==e.visible),this._updatePanel(t,e)},M.prototype._onLightSelected=function(t,e){if(this._selectedLightIndex!==t){this._selectedLightIndex=t;var i=this.view.lightAttrPanel,n="tabClose";switch(this._setAttrPanelVisible(!e.lightType||!1!==e.visible),e.lightType){case Punk.DirectionalLight:n="tabDirectLight";break;case Punk.PointLight:n="tabPointLight";break;case Punk.SpotLight:n="tabSpotLight";break;case Punk.HemisphereLight:n="tabHemiLight"}i.lightTab.switchTab(n,!1),this._updatePanel(t,e)}},M.prototype._onLightUnSelected=function(t,e){this._selectedLightIndex===t&&(this._selectedLightIndex=-1,this._setAttrPanelVisible(!1))},M.prototype._setAttrPanelVisible=function(t){this.view.lightAttrPanel.setStyle("display",[t?"block":"none"])},M.prototype._transferValue=function(t,e,i,n){var s,o=e;switch(t){case"intensity":var a=this._getLightScale(n);o=e>.1*a?(e/a+.8)/1.8*100:e/a*500;break;case"angle":o=180*e/Math.PI;break;default:s=Punk.GlobalData.scaleSetting[t]}return(o=s?at.getValueScale(e,s,i):o).toFixed(1)},M.prototype._removeEventListeners=function(){L.prototype._removeEventListeners.call(this),this.view.lightAttrPanel.lightTab.bindSelected(null,null)},M.prototype._onShadowSlopChange=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"color",t)},M.prototype._onBindCameraSwitch=function(t){},M.prototype._onGeneShadowSwitch=function(t){st.updateLightAttr.dispatch(this._selectedLightIndex,"castShadow",t)},M.prototype._onLightSpeedTabSelected=function(t){t.name},M.prototype._getLightScale=function(t){switch(t){case Punk.DirectionalLight:return Punk.GlobalData.scaleSetting.DirectionalLightScale;case Punk.PointLight:return Punk.GlobalData.scaleSetting.PointLightScale;case Punk.SpotLight:return Punk.GlobalData.scaleSetting.SpotLightScale;case Punk.HemisphereLight:return Punk.GlobalData.scaleSetting.HemisphereLightScale;case Punk.AmbientLight:return Punk.GlobalData.scaleSetting.AmbientLightScale}},B.prototype=Object.create(L.prototype),B.prototype.constructor=B,B.prototype._initEventListeners=function(){L.prototype._initEventListeners.call(this),this.view.selector.bindSelectedEvent(this._onEnvMapSelected,this),this.view.switchBulr.bindSwitchEvent(this._setBlur,this),st.envMapAdded.add(this._onEnvMapAdded,this),st.skyChanged.add(this._onSkyChanged,this)},B.prototype._onEnvMapAdded=function(t){var e;for(var i in t)e=t[i],this.view.addOption(e.name,e.skyId,"/"+e.icon)},B.prototype._onSkyChanged=function(t){var e=this.view.selector,i=e.getOption(t.skyId,"skyId");e.selectOption(i,!1),this._setEnvMapPreview(t)},B.prototype._setBlur=function(t){st.setSkyBlur.dispatch(t)},B.prototype._setEnvMapPreview=function(t){this.view.environPreviewImg.dom.src="/"+t.thumb},B.prototype._onEnvMapSelected=function(t){st.viewSelectedEnvMap.dispatch(parseInt(t))},U.prototype=Object.create(s.prototype),U.prototype.constructor=U,U.prototype._initView=function(){},U.prototype.showScroll=function(t){$(t).perfectScrollbar()},U.prototype.dispose=function(){s.prototype.dispose.call(this)},O.prototype=Object.create(L.prototype),O.prototype.constructor=O,O.prototype._initEventListeners=function(){L.prototype._initEventListeners.call(this),st.materialAdded.add(this._onMaterialAdded,this),st.materialSelected.add(this._onMaterialSelected,this),st.updateMaterialMaps.add(this._updateMaterialMaps,this),this.view.materialList.bindSelected(this._onItemSelected,this)},O.prototype._onWorldCreated=function(){(new U).showScroll(this.view.materialList.dom)},O.prototype._updateMaterialMaps=function(t,e){var i=!1;for(var n in e)if(e[n]>0){i=!0;break}this.view.updateHasTexture(t,i)},O.prototype._onMaterialAdded=function(t,e){this.view.addItem(t,e.name)},O.prototype._onMaterialSelected=function(t){if(this._selectedMaterialId!==t){var e=this.view.materialList,i=e.getItem(t,"materialId");i&&(e.select(i.itemId,!1),this._selectedMaterialId=t)}},O.prototype._onItemSelected=function(t){this._selectedMaterialId!==t.materialId&&(st.viewSelectedMaterial.dispatch(t.materialId),this._selectedMaterialId=t.materialId)},O.prototype._removeEventListeners=function(){st.materialAdded.remove(this._onMaterialAdded,this),st.materialSelected.remove(this._onMaterialSelected,this),st.updateMaterialMaps.remove(this._updateMaterialMaps,this),this.view.materialList.bindSelected(null,null)},A.prototype=Object.create(L.prototype),A.prototype.constructor=A,A.prototype._initEventListeners=function(){var t=this.view.shaderPanel,e=this.view.workflowPanel,i=this.view.mapPanel,n=this.view.specularMapPanel,s=this.view.metalnessPanel,o=this.view.transparencyPanel,a=this.view.bumpPanel,l=this.view.displacementPanel,r=this.view.aoPanel,h=this.view.cavityPanel,c=this.view.emissionPanel,p=this.view.sidePanel,d=this.view.splitPanel,u=this.view.wireFrameColor,v=this;t.colorPresets.bindSelected(this._onColorPickSelected,this),t.shaderTab.bindSelected(this._onShaderTypeSelected,this),t.methodTab.bindSelected(this._onMethodTabSelected,this),i.mapUI.bindChange(this._onMapSlideChange,this),i.mapUI.bindMapChange(this._onMapChange,this),i.mapUI.bindColorChange(this._onColorChange,this),e.tab.bindSelected(this._onWorkflowSelected,this),n.tab.bindSelected(this._onRoughnessSelected,this),n.colorMapUI.bindChange(this._onSpecularColorScaleChange,this),n.colorMapUI.bindMapChange(this._onSpecularColorMapChange,this),n.colorMapUI.bindColorChange(this._onSpecularColorChange,this),n.glossinessMapUI.bindChange(this._onSpecularGlossinessChange,this),n.glossinessMapUI.bindMapChange(this._onSpecularGlossinessMapChange,this),s.tab.bindSelected(this._onRoughnessSelected,this),s.metalnessMapUI.bindChange(this._onMetalnessChange,this),s.metalnessMapUI.bindMapChange(this._onMetalnessMapChange,this),s.specularMapUI.bindChange(this._onSpecularFSlideChange,this),s.specularMapUI.bindMapChange(this._onSpecularFMapChange,this),s.colorMapUI.bindChange(this._onSpecularGlossinessChange,this),s.colorMapUI.bindMapChange(this._onSpecularGlossinessMapChange,this),o.bindSwitchEvent(this._onSwitchButtonChange,this,"alpha"),o.colorMapUI.bindChange(this._onTransparencySlideChange,this,"true"),o.colorMapUI.bindMapChange(this._onTransparencyMapChange,this),a.bindSwitchEvent(this._onSwitchButtonChange,this,"normal"),a.tab.bindSelected(this._onNBSelected,this),a.rotateYButton.onClick(function(){v._onNBYClick()}),a.colorMapUI.bindChange(this._onNBSlideChange,this),a.colorMapUI.bindMapChange(this._onNBMapChange,this),l.bindSwitchEvent(this._onSwitchButtonChange,this,"displacement"),l.colorMapUI.bindChange(this._onDisplacementSlideChange,this),l.colorMapUI.bindMapChange(this._onDisplacementMapChange,this),r.bindSwitchEvent(this._onSwitchButtonChange,this,"ao"),r.colorMapUI.bindChange(this._onAOSlideChange,this),r.colorMapUI.bindMapChange(this._onAOMapChange,this),r.occlusionButton.onClick(function(){v._onOcclusionButtonClick()}),h.colorMapUI.bindChange(this._onCavitySlideChange,this),h.colorMapUI.bindMapChange(this._onCavityMapChange,this),c.bindSwitchEvent(this._onSwitchButtonChange,this,"emissive"),c.colorMapUI.bindChange(this._onEmissionSlideChange,this),c.colorMapUI.bindMapChange(this._onEmissionMapChange,this),c.colorMapUI.bindColorChange(this._onEmissionColorChange,this),p.tab.bindSelected(this._onSideSelected,this),d.tab.bindSelected(this._onSplitSelected,this),u.wireMapUI.bindChange(this._onwireFrame,this),u.wireMapUI.bindColorChange(this._onwireFrameColor,this),st.materialSelected.add(this._onMaterialSelected,this),st.passWireframe.add(this._onPassWireframe,this)},A.prototype._onPassWireframe=function(t,e){var i=this.view.wireFrameColor;"init"===t&&(i.wireMapUI.slide.setValue(100*e.wireAlpha.val),i.wireMapUI.setColor(e.wireColor.val))},A.prototype._updateShaderIndex=function(t,e){this._shaderIndex=t;var i=t&&t>=2;this.view.shaderPanel.colorPresets.select(t,e),this.view.shaderPanel.methodTab.smoothTab.setDisabled(i),this.view.shaderPanel.methodTab.flatTab.setDisabled(i)},A.prototype._onMaterialSelected=function(t,e){function i(t){switch(t){case"map":e.map?(n.mapUI.updateMap(e.map),n.mapUI.setColor(e.color)):n.mapUI.updateColor(e.color),n.mapUI.slide.setValue(100*e.color_scale);break;case"specular":e.specularMap?(l.colorMapUI.updateMap(e.specularMap),l.colorMapUI.setColor(e.specular),l.colorMapUI.slide.setValue(e.shininess)):(l.colorMapUI.updateColor(e.specular),l.colorMapUI.slide.setValue(100*e.specular_scale));break;case"emission":e.emissiveMap?(d.colorMapUI.updateMap(e.emissiveMap),d.colorMapUI.setColor(e.emissive),d.colorMapUI.slide.setValue(100*e.emissiveIntensity)):(d.colorMapUI.updateColor(e.emissive),d.colorMapUI.slide.setValue(100*e.emissiveIntensity));break;case"alpha":r.colorMapUI.updateMap(e.alphaMap),r.colorMapUI.slide.setValue(100*e.transparency);break;case"nb":h.colorMapUI.updateMap(e.isNormalSelected?e.normalMap:e.bumpMap),h.colorMapUI.slide.setValue(e.isNormalSelected?50*(e.normalScale+1):e.bumpScale?0:100*e.bumpScale);break;case"ao":p.colorMapUI.updateMap(e.aoMap),p.colorMapUI.slide.setValue(100*e.aoMapIntensity);break;case"displacement":c.colorMapUI.updateMap(e.displacementMap),c.colorMapUI.slide.setValue(e.displacementScale);break;case"metalness":a.metalnessMapUI.updateMap(e.metalnessMap),a.metalnessMapUI.slide.setValue(100*e.metalness)}}var n=this.view.mapPanel,s=this.view.shaderPanel,o=this.view.workflowPanel,a=this.view.metalnessPanel,l=this.view.specularMapPanel,r=this.view.transparencyPanel,h=this.view.bumpPanel,c=this.view.displacementPanel,p=this.view.aoPanel,d=this.view.emissionPanel,u=this.view.sidePanel,v=this.view.splitPanel;h.switch(!1!==e.nb_s,!1),p.switch(!1!==e.ao_s,!1),r.switch(!1!==e.alpha_s,!1),d.switch(!1!==e.emissive_s,!1),c.switch(!1!==e.displacement_s,!1),s.shaderTab.switchTab(this._getShaderTabName(e.materialType),!1),s.methodTab.switchTab(!0===e.flatShading?"floatTab":"smoothTab",!1),a.tab.switchTab(e.isRoughnessSelected?"roughnessTab":"glossinessTab",!1),l.tab.switchTab(e.isRoughnessSelected?"roughnessTab":"glossinessTab",!1),h.tab.switchTab(e.isNormalSelected?"normalTab":"bumpTab",!1),u.tab.switchTab(e.side===Punk.DoubleSide?"doubleTab":"frontTab",!1),v.tab.switchTab("noSplitTab",!1),e.type===Punk.ShaderType.NOSHADER?(i("map"),i("alpha")):e.type===Punk.ShaderType.MATCAP?(i("alpha"),i("nb"),i("displacement")):(i("map"),i("emission"),i("alpha"),i("nb"),i("ao"),i("displacement"),e.isMetal?(i("metalness"),a.colorMapUI.updateMap(e.roughnessMap),a.colorMapUI.slide.setValue(50*(e.isRoughnessSelected?e.roughness:1-e.roughness)),o.tab.switchTab("metalTab",!1)):(i("specular"),l.glossinessMapUI.updateMap(e.glossinessMap),l.glossinessMapUI.slide.setValue(100*(e.isRoughnessSelected?1-e.glossiness:e.glossiness)),o.tab.switchTab("specularTab",!1))),this._updateShaderIndex(e.shaderIndex,e.materialType),this.view.updateShaderPanel(e.materialType,e.isMetal)},A.prototype._onColorPickSelected=function(t){var e=this.view.shaderPanel,i=this._getShaderTabName(t.type);e.shaderTab.switchTab(i,!1),this._switchShaderType(t.type,null,t.shaderIndex)},A.prototype._onShaderTypeSelected=function(t){var e,i;switch(t.name){case"noShaderTab":e=Punk.ShaderType.NOSHADER;break;case"pbrTab":e=Punk.ShaderType.PBR;break;case"wireframeTab":e=Punk.ShaderType.Wireframe;break;case"matCapTab":e=Punk.ShaderType.MATCAP,(!this._shaderIndex||this._shaderIndex<2)&&(i=3)}this._switchShaderType(e,null,i)},A.prototype._onMethodTabSelected=function(t){this._updateFlatShading("floatTab"===t.name)},A.prototype._onWorkflowSelected=function(t){this._switchShaderType(Punk.ShaderType.PBR,"metalTab"===t.name)},A.prototype._onRoughnessSelected=function(t){this._setMaterialSetting("isRoughnessSelected","roughnessTab"===t.name)},A.prototype._onSwitchButtonChange=function(t,e,i){st.materialSwitchChange.dispatch(i,t)},A.prototype._onNBSelected=function(t){var e="normalTab"===t.name?"block":"none";this.view.bumpPanel.rotateYButton.setStyle("display",[e]),this._setMaterialSetting("isNormalSelected","normalTab"===t.name)},A.prototype._onSideSelected=function(t){this._updateShaderSide("frontTab"===t.name?Punk.FrontSide:Punk.DoubleSide)},A.prototype._onSplitSelected=function(t){var e;switch(t.name){case"noSplitTab":e=1;break;case"splitX2Tab":e=2;break;case"splitX4Tab":e=4}this._updateSplitLevel(e)},A.prototype._onNBYClick=function(){this._setMaterialSetting("isNBFlipY")},A.prototype._onMapChange=function(t){st.setColorMap.dispatch("map",t)},A.prototype._onColorChange=function(t){st.onColorChange.dispatch("color",t)},A.prototype._onMapSlideChange=function(t){st.onColorChange.dispatch("color",void 0,parseFloat(t))},A.prototype._onSpecularColorScaleChange=function(t){st.setMaterialAttr.dispatch("shininess",parseFloat(t),1),st.onColorChange.dispatch("specular",void 0,parseFloat(t))},A.prototype._onSpecularColorMapChange=function(t){st.setColorMap.dispatch("specularMap",t)},A.prototype._onSpecularColorChange=function(t){st.onColorChange.dispatch("specular",t)},A.prototype._onSpecularGlossinessChange=function(t){st.onGlossinessSlideChange.dispatch(parseFloat(t))},A.prototype._onSpecularGlossinessMapChange=function(t){t=t?parseInt(t):0,st.setColorMap.dispatch("roughnessMap",t),t>0&&this.view.metalnessPanel.colorMapUI.slide.setValue(100,!0)},A.prototype._onMetalnessChange=function(t){st.setMaterialAttr.dispatch("metalness",parseFloat(t),.01)},A.prototype._onMetalnessMapChange=function(t){t=t?parseInt(t):0,st.setColorMap.dispatch("metalnessMap",t),t>0&&this.view.metalnessPanel.metalnessMapUI.slide.setValue(100,!0)},A.prototype._onSpecularFSlideChange=function(t){st.setMaterialAttr.dispatch("specular",parseFloat(t),.01)},A.prototype._onSpecularFMapChange=function(t){t=t?parseInt(t):0,st.setColorMap.dispatch("specularMap",t)},A.prototype._onTransparencySlideChange=function(t){st.onTransparencySlideChange.dispatch(parseFloat(t))},A.prototype._onTransparencyMapChange=function(t){st.setColorMap.dispatch("alphaMap",t)},A.prototype._onNBSlideChange=function(t){st.onNBSlideChange.dispatch(parseFloat(t))},A.prototype._onNBMapChange=function(t){st.setColorMap.dispatch("normalMap",t)},A.prototype._onDisplacementSlideChange=function(t){st.onDisplacementSlideChange.dispatch(parseFloat(t))},A.prototype._onDisplacementMapChange=function(t){st.setColorMap.dispatch("displacementMap",t)},A.prototype._onAOSlideChange=function(t){st.setMaterialAttr.dispatch("aoMapIntensity",parseFloat(t),.01)},A.prototype._onAOMapChange=function(t){st.setColorMap.dispatch("aoMap",t)},A.prototype._onCavitySlideChange=function(t){st.setMaterialAttr.dispatch("cavityMapIntensity",parseFloat(t),.01)},A.prototype._onCavityMapChange=function(t){st.setColorMap.dispatch("cavityMap",t)},A.prototype._onEmissionSlideChange=function(t){this._emissiveIsMap?st.setMaterialAttr.dispatch("emissiveIntensity",parseFloat(t),.01):st.onColorChange.dispatch("emissive",void 0,parseFloat(t))},A.prototype._onEmissionMapChange=function(t){st.setColorMap.dispatch("emissiveMap",t)},A.prototype._onEmissionColorChange=function(t){st.onColorChange.dispatch("emissive",t)},A.prototype._onOcclusionButtonClick=function(){var t=this.view.aoPanel.occlusionButton;t.selected=!1,this._setMaterialSetting("isOcclusionSelected",t.selected)},A.prototype._switchShaderType=function(t,e,i){st.setShaderType.dispatch(t,e,i)},A.prototype._setMaterialSetting=function(t,e){st.setMaterialSetting.dispatch(t,e)},A.prototype._updateFlatShading=function(t){st.setFlatShading.dispatch(t)},A.prototype._updateShaderSide=function(t){st.setShaderSide.dispatch(t)},A.prototype._updateSplitLevel=function(t){st.setSplitLevel.dispatch(t)},A.prototype._onwireFrame=function(t){st.passWireframe.dispatch("wireAlpha",parseFloat(t/100))},A.prototype._onwireFrameColor=function(t){st.passWireframe.dispatch("wireColor",t)},A.prototype._onmodeleFrame=function(t){st.passWireframe.dispatch("modelAlpha",parseFloat(t))},A.prototype._onmodeleFrameColor=function(t){st.passWireframe.dispatch("modelColor",t)},A.prototype._getShaderTabName=function(t){var e;switch(t){case Punk.ShaderType.PBR:e="pbrTab";break;case Punk.ShaderType.NOSHADER:e="noShaderTab";break;case Punk.ShaderType.Wireframe:e="wireframeTab";break;case Punk.ShaderType.MATCAP:e="matCapTab"}return e},A.prototype._removeEventListeners=function(){this.view.shaderPanel.colorPresets.bindSelected(null)},V.prototype=Object.create(s.prototype),V.prototype.constructor=V,V.prototype._initView=function(){var t=(new nt.Div).setClass("editor-control editor-content"),e=(new nt.Ul).setClass("list-unstyled tabs"),i=(new nt.Div).setClass("widget");this.contentChild=(new nt.Div).setClass("tagsContent");var n=(new nt.Li).setClass("tab").setAttr({"data-tab":"场景"}),s=(new nt.I).setClass("secentab");n.add(s);var a=(new nt.Li).setClass("tab").setAttr({"data-tab":"灯光"}),l=(new nt.I).setClass("fa fa-lightbulb-o lighttab");a.add(l);var r=(new nt.Li).setClass("tab").setAttr({"data-tab":"材质"}),h=(new nt.I).setClass("materialtab");r.add(h),e.add(n,a,r),this.scenePanel=this._createScenePanel().setClass("tab-panel active"),this.lightPanel=this._createLightPanel().setClass("tab-panel "),this.materialPanel=this._createMaterialPanel().setClass("tab-panel "),this.contentChild.add(this.scenePanel,this.lightPanel,this.materialPanel),i.add(this.contentChild),t.add(e,i),this.add(t),this.tab=new o("tab","tab active"),this.tab.addTab(n,"scenesTab"),this.tab.addTab(a,"lightsTab"),this.tab.addTab(r,"materialsTab")},V.prototype._createScenePanel=function(){var t=new nt.Div,e=(new nt.Li).setClass("tab").setAttr({"data-tab":"场景"}),i=(new nt.I).setClass("secentab");e.add(i);var n,s,o=[];return n=new p,s=new E(n),t.add(n),o.push(s),n=new g,s=new x(n),o.push(s),t.add(n),t.button=i,t.ctls=o,t},V.prototype._createLightPanel=function(){var t,e,i=new nt.Div,n=[];return t=new b,e=new M(t),n.push(e),i.add(t),t=new k,e=new B(t),n.push(e),i.add(t),i.ctls=n,i},V.prototype._createMaterialPanel=function(){var t,e,i=new nt.Div,n=[];return t=new P,e=new O(t),i.add(t),n.push(e),t=new I,e=new A(t),i.add(t),n.push(e),i.ctls=n,i},N.prototype=Object.create(L.prototype),N.prototype.constructor=N,N.prototype._initEventListeners=function(){L.prototype._initEventListeners.call(this),(new U).showScroll(this.view.contentChild.dom);var t=this.view.tab;t.bindSelected(this._onTabSelected,this),t.switchTab("scenesTab")},N.prototype._onWorldCreated=function(){},N.prototype._onSelectSkyBox=function(){this.view.tab.switchTab("lightsTab")},N.prototype._onSelectSkyBox=function(){this.view.tab.switchTab("specialsTab")},N.prototype._onTabSelected=function(t){if(t.tabId!==this._selectedTab){var e,i,n;if(""!==this._selectedTab&&((e=this._getPanelByTabId(this._selectedTab)).setClass("tab-panel"),e.ctls&&e.ctls.length>0))for(i=0,n=e.ctls.length;i<n;i++)e.ctls[i].blur();if(this._selectedTab=t.name,(e=this._getPanelByTabId(this._selectedTab)).setClass("tab-panel active"),e.ctls&&e.ctls.length>0)for(i=0,n=e.ctls.length;i<n;i++)e.ctls[i].focus();$(this.view.contentChild.dom).scrollTop(0)}},N.prototype._getPanelByTabId=function(t){var e,i=this.view;switch(t){case"scenesTab":e=i.scenePanel;break;case"lightsTab":e=i.lightPanel;break;case"materialsTab":e=i.materialPanel;break;case"specialsTab":e=i.specialPanel}return e},N.prototype._removeEventListeners=function(){this.view.tab.bindSelected(null)},j.prototype=Object.create(s.prototype),j.prototype.constructor=j,j.prototype._initView=function(){},j.prototype.toggle=function(){this._inited?$(this.dom).spectrum("toggle"):this._init()},j.prototype.show=function(){this._inited?$(this.dom).spectrum("show"):this._init()},j.prototype.hidden=function(){this._inited&&$(this.dom).spectrum("toggle")},j.prototype.setColor=function(t){this._init(t)},j.prototype.bindColorChange=function(t,e){this._onChange=void 0===t?null:t,this._target=void 0===e?this:e},j.prototype.dispose=function(){s.prototype.dispose.call(this),this._onChange=null},j.prototype._init=function(t){var e=this;this.dom;$(this.dom).spectrum({showInput:!0,showButtons:!1,preferredFormat:"hex",theme:"sp-dark",color:t,flat:!0,move:function(t){e._onChange&&e._onChange.call(e._target,t.toHexString())}}),$(this.dom).spectrum("show"),this._inited=!0},R.prototype=Object.create(u.prototype),R.prototype.constructor=R,R.prototype._initEventListener=function(){var t=this;this.ui.deleteButton&&this.ui.deleteButton.onClick(function(e){t._onDeleteButtonClick(e)})},R.prototype.bindLoadEvent=function(t,e){this._onLoadEvent="function"==typeof t?t:null,this._onLoadTarget=e instanceof Object?e:null},R.prototype.bindClickEvent=function(t,e){this._onDeleteEvent="function"==typeof t?t:null,this._onDeleteTarget=e instanceof Object?e:null},R.prototype._onDeleteButtonClick=function(t){t.stopPropagation(),this._onDeleteEvent&&this._onDeleteEvent.call(this._onDeleteTarget,this.tid,this.itemId)},R.prototype._textureItemLoad=function(t){this._onLoadEvent&&this._onLoadEvent.call(this._onLoadTarget,this.itemId,t)},R.prototype._SuccShow=function(t,e){var i=t.uri+"_thumb.png";this.ui.textureImg.setAttr({src:i}),this.ui.deleteButton.setStyle("display",["inline-block"]),this.tid=t.tid},R.prototype.dispose=function(){this._onLoadEvent=null,this._onLoadTarget=null,this._onDeleteEvent=null,this._onDeleteTarget=null},F.prototype=Object.create(v.prototype),F.prototype.constructor=F,F.prototype.addItem=function(t,e,i){var n=v.prototype.addItem.call(this,t,e,i);return n.bindLoadEvent(this._textureItemLoad,this),n.bindClickEvent(this._onDeleteButtonClick,this),n},F.prototype.getItemLength=function(){var t=this._list.length;return t+=1},F.prototype.bindListLoadEvent=function(t,e){this._onLoadEvent="function"==typeof t?t:null,this._onLoadTarget=e instanceof Object?e:null},F.prototype.bindClickListEvent=function(t,e){this._onDeleteEvent="function"==typeof t?t:null,this._onDeleteTarget=e instanceof Object?e:null},F.prototype._textureItemLoad=function(t,e){this._onLoadEvent&&this._onLoadEvent.call(this._onLoadTarget,t,e)},F.prototype._onDeleteButtonClick=function(t,e){this.unSelect(),this._onDeleteEvent&&this._onDeleteEvent.call(this._onDeleteTarget,t,e)},F.prototype.removeItem=function(t){v.prototype.removeItem.call(this,t)},F.prototype.findTidItemImg=function(t,e){var i=this.getItem(t,"tid");i&&e(i.ui.textureImg.dom)},F.prototype.findSuccTextureItem=function(t,e){var i=this.getItem(e);i&&i._SuccShow(t,e)},H.prototype=Object.create(s.prototype),H.prototype.constructor=H,H.prototype._initView=function(){var t=(new nt.Div).setClass("loadItem").setStyle("margin-top",["8px"]).setStyle("border-radius",["5px"]);this.loadProgress=(new nt.Div).setClass("loadProgress").setStyle("border-radius",["5px"]),t.add(this.loadProgress),this.add(t)},H.prototype.onLoad=function(t){t>=100&&this._remove(),this.loadProgress.setStyle("width",[t+"%"])},H.prototype._remove=function(){this._onLoad=null,s.prototype.dispose.call(this)},X.prototype=Object.create(s.prototype),X.prototype.constructor=X,X.prototype._initView=function(){this.setClass("popup").setId("popupUI");var t=(new nt.Div).setClass("popup-texture"),e=(new nt.Div).setClass("popup-header"),i=(new nt.Div).setClass("popup-name").setTextContent("文件管理");this.popupClose=(new nt.Div).setClass("popup-close");var n=(new nt.I).setClass("fa fa-times");this.popupClose.add(n),e.add(i,this.popupClose);var s=(new nt.Div).setClass("popup-content"),o=(new nt.Div).setClass("toolbar"),a=(new nt.Div).setClass("buttons"),l=(new nt.Div).setClass("butt").setClass("btn btn-pri uploadBtn"),r=(new nt.Label).setAttr({for:"upload-texture"});this.uploadInput=(new nt.Input).setClass("upload-input").setId("upload-texture").setAttr({type:"file",multiple:"multiple"}),r.add(this.uploadInput);var h=(new nt.Span).setTextContent("上传");r.add(h),l.add(r),a.add(l),o.add(a),this.textureList=new F("textureListUI","textures"),this.addTextureItem(0),this.textureList.bindSelected(this._onTextureSelected,this),s.add(o,this.textureList),t.add(e,s),this.add(t)},X.prototype.addTextureItem=function(t,e){if(0!==t&&!t&&!e)return!1;var i=(new nt.Div).setClass("texture"),n=(new nt.Div).setClass("text_img"),s=(new nt.Img).setAttr({width:"100%",height:"100%"}),o=void 0===e?"无":e.name.split(".")[0],a=(new nt.Div).setClass("text_name").setTextContent(o);if(n.add(s),i.add(n,a),e&&e.uri){var l=e.uri+"_thumb."+e.t_format;s.setAttr({src:l})}var r=(new nt.Div).setClass("pull-right"),h=(new nt.Div).setClass("popup-close deleteDiv"),c=(new nt.I).setClass("fa fa-times-circle");if(h.add(c),e){if(e.uri)p=h;else var p=h.setStyle("display",["none"]);r.add(p)}if(i.add(r),i.textureImg=s,i.deleteButton=p,e&&e.size){var d=new H;i.add(d),i.loader=d}var u=this.textureList.addItem(i,"texture","texture");return(t||0===t)&&(u.tid=t),u},X.prototype._onTextureSelected=function(t){if(t.tid||0===t.tid){var e=t.tid;null!==this._onMapChange&&this._onMapChange.call(this._target,e),this._closePopup()}},X.prototype._closePopup=function(){this.setVisible(!1)},X.prototype.bindMapChange=function(t,e){this._onMapChange=void 0===t?null:t,this._target=void 0===e?this:e},X.prototype.dispose=function(){s.prototype.dispose.call(this),this._onMapChange=null,this._target=null},W.prototype=Object.create(L.prototype),W.prototype.constructor=W,W.prototype._initEventListeners=function(){var t=this;(new U).showScroll(t.view.textureList.dom),st.reponseTexture.add(this._reponseTexture,this),this.view.uploadInput.onChange(function(){t._addTextures()}),this.view.popupClose.onClick(function(){t._popupClose()}),this.view.textureList.bindClickListEvent(this._onDeleteButtonClick,this),st.uploadTextureSucc.add(this._onUploadSuccess,this),st.uploadTextureFailed.add(this._onFailedUpload,this),st.deleteTextureSucc.add(this._onFailedUpload,this)},W.prototype._reponseTexture=function(t){t?this._initTexture(t):console.log("first time")},W.prototype._initTexture=function(t){for(var e=0;e<t.length;e++)this._addTextureItem(t[e].tid,t[e])},W.prototype._onUploadSuccess=function(t,e){this.view.textureList.findSuccTextureItem(t,e)},W.prototype._onFailedUpload=function(t){this.view.textureList.removeItem(t)},W.prototype._addTextureItem=function(t,e){if(!t&&!e)return!1;var i=this.view.addTextureItem(t,e),n=i.itemId;this.item=i;var s=this;e.size&&st.uploadTexture.dispatch(n,e,function(t){s.item.ui.loader.onLoad(t)})},W.prototype._addTextures=function(){for(var t=this.view.uploadInput.dom.files,e=0;e<t.length;e++){var i=t[e].name.split(".").pop();"png"!==(i=i.toLowerCase())&&"jpeg"!==i&&"bmp"!==i&&"dds"!==i&&"tga"!==i&&"jpg"!==i||this._addTextureItem("",t[e])}},W.prototype._onDeleteButtonClick=function(t,e){$.tipPop({title:"",content:"确定删除贴图？",cancelBtn:!1,clearBtn:!1,closeFn:function(){$("#messageUI").remove()},confirmFn:function(){st.deleteTexture.dispatch(t,e),$("#messageUI").remove()}})},W.prototype._popupClose=function(){this.view._closePopup()},Y.prototype=Object.create(h.prototype),Y.prototype.constructor=Y,Y.prototype._initView=function(){h.prototype._initView.call(this);var t=this._createBackCtrlPanel();this.addContent(t)},Y.prototype._createBackCtrlPanel=function(){var t=(new nt.Div).setClass("children-container backCtrlUI"),e=this._createBackToolsBar();return this.toolBody=this._createBackCtrlBody(),t.add(e,this.toolBody),t},Y.prototype._createBackToolsBar=function(){var t=(new nt.Div).setClass("backToolsBar"),e=(new nt.Div).setClass("tab active").setTextContent("天空盒"),i=(new nt.Div).setClass("tab").setTextContent("图片"),n=(new nt.Div).setClass("tab").setTextContent("颜色"),s=(new nt.Div).setClass("tab").setTextContent("透明");return this.toolsTab=new o("tab","tab active"),this.toolsTab.addTab(e,"skybox"),this.toolsTab.addTab(i,"picture"),this.toolsTab.addTab(n,"color"),this.toolsTab.addTab(s,"transparent"),t.add(e,i,n,s),t},Y.prototype._createBackCtrlBody=function(){var t=(new nt.Div).setClass("back-ctrl-body"),e=this._skybox(),i=this._img(),n=this._color(),s=this._transparent();return t.add(e,i,n,s),t.skybox=e,t.img=i,t.color=n,t.transparent=s,t},Y.prototype._skybox=function(){var t=(new nt.Div).setClass("skybox"),e=(new nt.Div).setTextContent("点这里更改天空盒和环境贴图").setClass("save-back-img colourItemTag"),i=(new nt.P).setTextContent("高斯模糊").setClass("color-white"),n=(new nt.Div).setClass("gaussian-container colourItemTag"),s=(new nt.Div).setTextContent("0"),a=(new nt.Div).setTextContent("X1"),l=(new nt.Div).setTextContent("X2"),r=(new nt.Div).setTextContent("X3"),h=new o("blurTab","active");h.addTab(s,"gaussian_0"),h.addTab(a,"gaussian_X1"),h.addTab(l,"gaussian_X2"),h.addTab(r,"gaussian_X3");var c=(new nt.P).setTextContent("背景亮度").setClass("color-white"),p=new d(0,100,0,20);return n.add(s,a,l,r),t.add(e,i,n,c,p),t.linkToSkyBox=e,t.blurTab=h,t.lightSlide=p,t},Y.prototype._img=function(){var t=(new nt.Div).setClass("img-panel"),e=(new nt.Div).setTextContent("上传自定义fF背景").setClass("upload-back-img colourItemTag"),i=(new nt.Ul).setClass("list-unstyled backOptions active"),n=(new nt.Li).setClass("options"),s=(new nt.Div).setClass("optionsContentRow"),o=(new nt.Img).setClass("optionImg").setAttr({width:32,height:32}),a=(new nt.Span).setClass("optionText").setTextContent("这是一个测试");s.add(o,a),n.add(s),i.add(n);var l=(new nt.P).setTextContent("背景亮度").setClass("color-white"),r=new d(0,100,0,20);return t.add(e,i,l,r),t},Y.prototype._color=function(){var t=(new nt.Div).setClass("color-picker-container"),e=new j;return t.add(e),e.show(),t.colorPicker=e,t},Y.prototype._transparent=function(){var t=(new nt.Div).setClass("back-trans color-white"),e=(new nt.Div).setStyle("margin-bottom",["10px"]).setTextContent("背景透明效果与以下特性不兼容，已自动关闭如下特性："),i=(new nt.Ul).setClass("back-trans-intro-content"),n=(new nt.Li).setClass("trans-list-des").setTextContent("*边缘抗锯齿"),s=(new nt.Li).setClass("trans-list-des").setTextContent("*边缘抗锯齿");return i.add(n,s),t.add(e,i),t},Y.prototype.switchBack=function(t){if(this.hideChildren(),t){var e=this.toolBody;switch(t){case"skybox":e.skybox.setStyle("display",["block"]);break;case"picture":e.img.setStyle("display",["block"]);break;case"color":e.color.setStyle("display",["block"]);break;case"transparent":e.transparent.setStyle("display",["block"])}}},Y.prototype.hideChildren=function(){var t=this.toolBody;t.skybox.setStyle("display",["none"]),t.img.setStyle("display",["none"]),t.transparent.setStyle("display",["none"]),t.color.setStyle("display",["none"])},Y.prototype.dispose=function(){BaseUI.prototype.dispose.call(this)},z.prototype=Object.create(L.prototype),z.prototype.constructor=z,z.prototype._initEventListeners=function(){var t=this.view.toolBody.skybox,e=this.view.toolBody.color;t.linkToSkyBox.onClick(this._onLinkToSkyBoxClick),e.colorPicker.bindColorChange(this._onColorChange,this),this.view.toolsTab.bindSelected(this._onToolsTabChange,this),this.view.toolsTab.switchTab("skybox")},z.prototype._onLinkToSkyBoxClick=function(){st.viewToSelectSkyBox.dispatch()},z.prototype._onColorChange=function(t){st.skyChanged.dispatch(CGPUNKEditor.SkyColor,t)},z.prototype._onToolsTabChange=function(t){var e=t.name;this.view.switchBack(e),"transparent"===e&&st.skyChanged.dispatch(CGPUNKEditor.SkyTransparency)},z.prototype._removeEventListeners=function(){this.view.toolBody.skybox.linkToSkyBox.onClick(),this.view.toolsTab.bindSelected()},G.prototype=Object.create(s.prototype),G.prototype.constructor=G,G.prototype._initView=function(){this.setClass("popup").setId("lightPresetUI");var t=(new nt.Div).setClass("popup-texture").setStyle("width",["320px"]).setStyle("height",["auto"]),e=(new nt.Div).setClass("popup-header"),i=(new nt.Div).setClass("popup-name").setTextContent("选择灯光预设"),n=(new nt.I).setClass("fa fa-times");this.popupClose=(new nt.Div).setClass("popup-close"),this.popupClose.add(n),e.add(i,this.popupClose);var s=(new nt.Div).setClass("popup-content"),o=(new nt.Div).setClass("preinstallListTitle color-white").setTextContent("系统预设");(new nt.Div).setClass("warmSunlight"),(new nt.Div).setClass("coldBlue"),(new nt.Div).setClass("moonBlack"),(new nt.Div).setClass("desertYellow"),(new nt.Div).setClass("moonWhite"),(new nt.Div).setClass("shallowPurple");this.systemPresetList=new v("systemPresetList","preinstallListContainer");new nt.Div;var a=(new nt.Div).setClass("myPreinstall color-white").setTextContent("我的预设");this.userPresetList=new v("userPresetList","myPreinstallContainer"),s.add(o,this.systemPresetList,a,this.userPresetList),t.add(e,s),this.add(t)},G.prototype.addPreset=function(t,e,i){var n=(i=!1!==i)?this.systemPresetList:this.userPresetList,s=(new nt.Div).setStyle("background",["url("+e+") no-repeat center center"]);n.addItem(s,"","").type=t},Z.prototype=Object.create(L.prototype),Z.prototype.constructor=Z,Z.prototype._initEventListeners=function(){L.prototype._initEventListeners.call(this);var t=this;this.view.popupClose.onClick(function(){t._removeView()}),this.view.systemPresetList.bindSelected(this._onPresetSelected,this)},Z.prototype._onPresetSelected=function(t){st.setLightPreset.dispatch(t.type),this._removeView()},Z.prototype._removeView=function(){lt.removeUI(this.view)},K.prototype={createUI:function(t){var e;switch(t){case it.Sidebar:new N(e=new V);break;case it.colorPicker:e=new j;break;case it.popup:new W(e=new X),e.setVisible(!1);break;case it.Material:new O(e=new P);break;case it.shader:new A(e=new I);break;case it.Background:new z(e=new Y);break;case it.Loading:e=new H;break;case it.LightPreset:new Z(e=new G)}return this._uis[t]=e,e},getUI:function(t){return this._uis.hasOwnProperty(t)?this._uis[t]:this.createUI(t)},appendUI:function(t){document.body.appendChild(this.getUI(t).dom)},removeUI:function(t){t.dom.parentNode&&t.dom.parentNode.removeChild(t.dom)}};var lt=new K;t.main=q,t.Directions=J,t.SkyBox=0,t.SkyColor=1,t.SkyBackground=2,t.skyTransparency=3,t.CubeSky=0,t.HdrSky=1,t.CommandType=Q,Object.defineProperty(t,"__esModule",{value:!0})});
