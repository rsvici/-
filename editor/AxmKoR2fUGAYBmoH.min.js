!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Punk={})}(this,function(e){"use strict";function l(e){this.type||(this.type="BaseModel"),this.setValues(e)}function s(e){this.parentDom=document.body,this.mode=1,this.transparent=!1,this.autoLoad=!1,this.autoPlay=!1,this.autoRotate=!1,this.zoom=!0,this.startMovie=!0,this.showLoading=!0,this.toolBar=!0,this.ad=!0,this._quality=Punk.Quality.ORIGINAL,this.type="EditorModel",l.call(this,e)}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}),l.prototype={isModel:!0,constructor:l,setValues:function(e){if(null!=e)if(!e instanceof Object)console.error("3DPunkEditor."+this.type+": parameter is not an Object.");else for(var t in e){var i=e[t];if(void 0!==i){var n=this[t];void 0!==n&&("type"===t&&(t="meta"),n&&n.isColor?n.setStyle("#"+i):n&&(n.isVector3||n.isVector2)&&i?n.copy(i):this[t]=0===n||n&&"number"==typeof n?Number(i):i)}}},dispose:function(){}},(s.prototype=Object.create(l.prototype)).constructor=s,Object.defineProperty(s.prototype,"quality",{set:function(e){switch(e){case"low":this._quality=Punk.Quality.LOW;break;case"middle":this._quality=Punk.Quality.MIDDLE;break;case"high":this._quality=Punk.Quality.HIGH;break;case"thumb":this._quality=Punk.Quality.THUMB;break;default:this._quality=Punk.Quality.ORIGINAL}},get:function(){return this._quality}}),s.prototype.setValues=function(e){e&&(l.prototype.setValues.call(this,e),this.transparent=1===this.transparent,this.autoLoad=1===this.autoLoad,this.autoPlay=1===this.autoPlay,this.autoRotate=1===this.autoRotate,this.zoom=0!==this.zoom,this.startMovie=0!==this.startMovie,this.showLoading=0!==this.showLoading,this.toolBar=0!==this.toolBar,this.ad=0!==this.ad)};var g={MouseOver:1,MouseOut:2,MouseMove:3,MouseUp:4,MouseDown:5,Click:6,DblClick:7,Resize:8};function h(e,t,i){this.event=e,this.target=t,this.args=i}function t(){this._domElement=null,this._listeners={};var a=this,h=[],t=[],l=[],c=0,r=function(e){y(g.MouseOver,e)},o=function(e){y(g.MouseOut,e)},d=function(e){y(g.MouseMove,e)},i=function(e){var t,i,n,s,a,r,o=Date.now();0<c&&o-c<300&&0===(s=l,a=(n=h)[0]-s[0],r=n[1]-s[1],Math.sqrt(a*a+r*r))?(c=0,i=e,y(g.DblClick,i)):(c=o,h[0]=l[0],h[1]=l[1],t=e,y(g.Click,t))},u=function(e){y(g.MouseUp,e),l[0]=e.clientX,l[1]=e.clientY,l[0]===t[0]&&l[1]===t[1]&&i(e)},p=function(e){y(g.MouseDown,e),t[0]=e.clientX,t[1]=e.clientY},m=function(e){1<e.touches.length||(y(g.MouseDown,e),t[0]=e.touches[0].pageX,t[1]=e.touches[0].pageY)},f=function(e){1<e.changedTouches.length||(y(g.MouseUp,e),l[0]=e.changedTouches[0].pageX,l[1]=e.changedTouches[0].pageY,l[0]===t[0]&&l[1]===t[1]&&i(e))},_=function(e){y(g.Resize,e)},y=function(e,t){if(a._listeners.hasOwnProperty(e))for(var i=a._listeners[e],n=0,s=i.length;n<s;n++)i[n].dispatch(t)};this.init=function(e){(this._domElement=e).addEventListener("mouseover",r,!1),e.addEventListener("mouseout",o,!1),e.addEventListener("mousemove",d,!1),e.addEventListener("mouseup",u,!1),e.addEventListener("mousedown",p,!1),e.addEventListener("touchstart",m,!1),e.addEventListener("touchend",f,!1),window.addEventListener("resize",_,!1)},this.dispose=function(){for(var e in this._listeners)if(this._listeners.hasOwnProperty(e)){for(var t=this._listeners[e],i=0,n=t.length;i<n;i++)t[i].dispose(),t[i]=null;delete this._listeners[e]}this._listeners=null;var s=this._domElement;s.removeEventListener("mouseover",r,!1),s.removeEventListener("mouseout",o,!1),s.removeEventListener("mousemove",d,!1),s.removeEventListener("mouseup",u,!1),s.removeEventListener("mousedown",p,!1),s.removeEventListener("touchstart",m,!1),s.removeEventListener("touchend",f,!1),window.removeEventListener("resize",_,!1),this._domElement=null}}Object.assign(h.prototype,{dispatch:function(e){var t=[e];t=null===this.args?t:t.concat(this.args),null!==this.event&&this.event.apply(this.target,t)},dispose:function(){this.event=null,this.target=null,this.args=null}}),Object.assign(t.prototype,{add:function(e,t,i){if(this._hasEventType(e)){this._listeners.hasOwnProperty(e)||(this._listeners[e]=[]);var n=this._listeners[e];if(-1<this._findListener(n,t))return;var s=null;if(3<arguments.length){s=[];for(var a=3,r=arguments.length;a<r;a++)s.push(arguments[a])}var o=new h(t,i,s);n.push(o)}},remove:function(e,t){var n=this._listeners.hasOwnProperty(e)?this._listeners[e]:null;if(null!==n&&0!==n.length){var s=this._findListener(n,t);-1<s&&(n[i].dispose(),this._listeners[e].splice(s,1))}},_hasEventType:function(e){for(var t in g)if(g[t]===e)return!0;return!1},_findListener:function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i].callback===t)return i;return-1}});var a=new t;var T=(new function(){var e=signals.Signal;this.signals={enableControl:new e,disableControl:new e,networkRequest:new e,networkResponse:new e,windowResize:new e,keyDown:new e,needsRenderer:new e,rendererStarted:new e,rendererSceneStarted:new e,rendererSceneFinish:new e,rendererFinish:new e,renderProxyAdded:new e,renderProxyRemoved:new e,ObjectRendered:new e,composerAdded:new e,composerEnabled:new e,passAdded:new e,passInsert:new e,preLoaderComplete:new e,loadingComplete:new e,worldCreated:new e,editorInited:new e,sceneAdded:new e,cameraAdded:new e,cameraChanged:new e,cameraMoved:new e,cameraMovieStarted:new e,cameraMovieFinished:new e,cameraReset:new e,cameraRedo:new e,cameraConfigAdded:new e,cameraConfigChanged:new e,cameraSaveButton:new e,objectAdded:new e,objectRemoved:new e,objectMoved:new e,clickEventsStopPushed:new e,ViewPicSaved:new e,viewAddCameraConfig:new e,viewCameraConfigChanged:new e,viewFovChanged:new e,viewSaveCameraConfig:new e,viewDeleteCameraConfig:new e,viewSelectedMaterial:new e,updateMaterialView:new e,materialParsed:new e,materialAdded:new e,materialSelected:new e,materialSwitchChange:new e,materialChanged:new e,updateMaterialMaps:new e,setShaderType:new e,setShaderSide:new e,setFlatShading:new e,setMaterialSetting:new e,setColorMap:new e,setMaterialAttr:new e,onColorChange:new e,onGlossinessSlideChange:new e,onTransparencySlideChange:new e,onNBSlideChange:new e,onDisplacementSlideChange:new e,startPlayer:new e,stopPlayer:new e,historyChanged:new e,skyTypeChanged:new e,setSplitLevel:new e,setLightBindCamera:new e,objectChanged:new e,objectUnSelected:new e,objectSelected:new e,selectLight:new e,setLightStatus:new e,updateLightType:new e,updateLightAttr:new e,lightsAdded:new e,lightTypeChanged:new e,lightsStatusChanged:new e,lightSelected:new e,lightUnSelected:new e,switchCommand:new e,uploadTexture:new e,uploadTextureSucc:new e,uploadTextureFailed:new e,deleteTextureSucc:new e,reponseTexture:new e,clearTexture:new e,deleteTexture:new e,clearDrawMap:new e,saveSceneStarted:new e,saveSceneSuccess:new e,publishStarted:new e,clearOutLine:new e,envMapAdded:new e,envMapChanged:new e,skyChanged:new e,viewSelectedEnvMap:new e,sceneRemoved:new e,sceneShift:new e,updateMaterialProxy:new e,saveSenceConfigSucc:new e,CameraInitUpdate:new e,viewMaterialBall:new e,saveQuickPicStarted:new e,saveCoverSucc:new e,publishSucc:new e,stopUIReact:new e,beginUIReact:new e,updateCameraImgStatus:new e,initCameraImg:new e,ableSaveConfig:new e,viewSelectedCamera:new e,viewDrawImage:new e,viewModeChanged:new e,ViewUpdateAllMaterial:new e,ViewUpdateTextureQuailty:new e,updateTextureQuality:new e,ViewShowQrcode:new e,beginSplitScreen:new e,endSplitScreen:new e,applyRenderMap:new e,publishFailed:new e,drawImageToCanvas:new e,setLightPreset:new e,setSkyBlur:new e,passWireframe:new e,passSSAO:new e,passGrain:new e,passDepthField:new e,passSharpNess:new e,passChromaticAberrations:new e,passVignette:new e,passBloom:new e,passToneMapping:new e,passColorBalance:new e,animUpdateTime:new e,animTickTok:new e,animPlay:new e,animPause:new e,animStartPlay:new e,animSetSpeed:new e,addAnimation:new e,playAction:new e,actionPlay:new e,loadNoteJS:new e,noteJSLoaded:new e,noteAdded:new e,noteSelected:new e,noteDeleted:new e,noteMoved:new e,noteReIndexed:new e,selectNote:new e,deleteNote:new e,editNote:new e,saveNote:new e,removeAD:new e}}).signals,n=UITools.Events;function r(){this._timeScale=1,this._framePerSecond=60,this._delay=0,this._count=0,this._actors=[],this._playing=!1;var i=0,n=0,s=0,a=!1,r=this;!function e(t){r._playing&&function(e){if(s+=e,++n>=r._delay){for(var t in n=0,a=!1,r._actors){var i=r._actors[t];i.isPlaying&&i.update(s),i.needsUpdate&&(a=!0,i.needsUpdate=!1)}s=0,a&&T.needsRenderer.dispatch()}}(t-i);i=t,requestAnimationFrame(e)}(0)}r.prototype={get lastIndex(){return this._count++},get timeScale(){return this._timeScale},set timeScale(e){this._timeScale=e},set speed(e){this._framePerSecond=e,this._delay=60/e},add:function(e){if(!e.isBehavior)throw new Error("AnimationTimeLine - add : param must be an Actor");this._actors[e.index]=e},remove:function(e){delete this._actors[e.index]},clear:function(){this._actors=[]},play:function(){this._playing=!0},stop:function(){this._playing=!1}};var o=new r;function c(){}Object.assign(c.prototype,{getFileExtension:function(e){return e.split(".").pop().toLowerCase()},getFilePath:function(e){var t=e.split("/");return t.pop(),t.join("/")},getFileName:function(e){return e.split("/").pop()},getStringByTypedArray:function(e){for(var t="",i=0,n=Math.ceil(e.length/1e4),s=0;s<n;s++)i=1e4*s,t+=String.fromCharCode.apply(null,e.slice(i,i+1e4));return t},getRandom:function(e,t){return e=void 0===e?0:parseInt(e),Math.round(Math.random()*(t-e)+e)},getRandomKey:function(e){var t=[];for(var i in e)t.push(i);return 0<t.length?t[this.getRandom(0,t.length-1)]:null}});var d=new c;function u(){this._domElement=null,this._listeners={},this._listenerInited=!1;var a=this,h=[],t=[],l=[],c=0,r=function(e){_(g.MouseOver,e)},o=function(e){_(g.MouseOut,e)},d=function(e){_(g.MouseMove,e)},i=function(e){var t,i,n,s,a,r,o=Date.now();0<c&&o-c<300&&0===(s=l,a=(n=h)[0]-s[0],r=n[1]-s[1],Math.sqrt(a*a+r*r))?(c=0,i=e,_(g.DblClick,i)):(c=o,h[0]=l[0],h[1]=l[1],t=e,_(g.Click,t))},u=function(e){_(g.MouseUp,e),l[0]=e.clientX,l[1]=e.clientY,l[0]===t[0]&&l[1]===t[1]&&i(e)},p=function(e){_(g.MouseDown,e),t[0]=e.clientX,t[1]=e.clientY},m=function(e){1<e.touches.length||(_(g.MouseDown,e),t[0]=e.touches[0].pageX,t[1]=e.touches[0].pageY)},f=function(e){1<e.changedTouches.length||(_(g.MouseUp,e),l[0]=e.changedTouches[0].pageX,l[1]=e.changedTouches[0].pageY,l[0]===t[0]&&l[1]===t[1]&&i(e))},_=function(e,t){if(a._listeners.hasOwnProperty(e))for(var i=a._listeners[e],n=0,s=i.length;n<s;n++)i[n].dispatch(t)};this.initEventListener=function(e){this._listenerInited||((this._domElement=e).addEventListener("mouseover",r,!1),e.addEventListener("mouseout",o,!1),e.addEventListener("mousemove",d,!1),e.addEventListener("mouseup",u,!1),e.addEventListener("mousedown",p,!1),e.addEventListener("touchstart",m,!1),e.addEventListener("touchend",f,!1),this._listenerInited=!0)},this.dispose=function(){for(var e in this._listeners)if(this._listeners.hasOwnProperty(e)){for(var t=this._listeners[e],i=0,n=t.length;i<n;i++)t[i].dispose(),t[i]=null;delete this._listeners[e]}this._listeners=null;var s=this._domElement;s&&(s.removeEventListener("mouseover",r,!1),s.removeEventListener("mouseout",o,!1),s.removeEventListener("mousemove",d,!1),s.removeEventListener("mouseup",u,!1),s.removeEventListener("mousedown",p,!1),s.removeEventListener("touchstart",m,!1),s.removeEventListener("touchend",f,!1),this._domElement=null)}}u.prototype={addEventListener:function(e,t,i){if(this._hasEventType(e)){this._listeners.hasOwnProperty(e)||(this._listeners[e]=[]);var n=this._listeners[e];if(-1<this._findListener(n,t))return;var s=null;if(3<arguments.length){s=[];for(var a=3,r=arguments.length;a<r;a++)s.push(arguments[a])}var o=new h(t,i,s);n.push(o)}},removeEventListener:function(e,t){var n=this._listeners.hasOwnProperty(e)?this._listeners[e]:null;if(null!==n&&0!==n.length){var s=this._findListener(n,t);-1<s&&(n[i].dispose(),this._listeners[e].splice(s,1))}},_hasEventType:function(e){for(var t in g)if(g[t]===e)return!0;return!1},_findListener:function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i].callback===t)return i;return-1}};var p={Element:function(e){u.call(this),this.dom=e,this.parent=null,this.children=[],this.listeners=[]}};Object.defineProperty(p.Element.prototype,"visible",{get:function(){return"none"!==this.getStyleValue("display")},set:function(e){var t=e?"block":"none";this.setStyle("display",[t])}}),Object.assign(p.Element.prototype,u.prototype,{add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];this.dom.appendChild(t.dom),this.children.push(t),t.parent=this}return this},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof p.Element?(this.dom.removeChild(t.dom),this.children.splice(this.children.indexOf(t),1),t.parent=null):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},clear:function(){for(this.remove(this.children);this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)},setId:function(e){return this.dom.id=e,this},toggleClass:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e),this},setClass:function(e){return this.dom.className=e,this},setAttr:function(e){for(var t in e)this.dom.setAttribute(t,e[t]);return this},addClass:function(e){return this.hasClass(e)||(this.dom.className+=" "+e),this},removeClass:function(e){for(var t=this,i=this.dom.className.split(" "),n=0;n<i.length;n++)i[n]==e&&(i.splice(n,1),s());function s(){t.dom.className="";for(var e=0;e<i.length;e++)t.addClass(i[e])}return this},hasClass:function(e){return this.dom.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},setStyle:function(e,t){for(var i=0;i<t.length;i++)this.dom.style[e]=t[i];return this},getStyleValue:function(e){return this.dom.style[e]},getAttrValue:function(e){return this.dom.getAttribute(e)},setDisabled:function(e){return this.dom.disabled=e,this},setTextContent:function(e){return this.dom.textContent=e,this},addEventListener:function(e,t,i){this._listenerInited||this.initEventListener(this.dom),u.prototype.addEventListener.call(this,e,t,i)}});["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"].forEach(function(e){var t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);p.Element.prototype[t]=function(){return this.setStyle(e,arguments),this}});function m(e){p.Div.call(this),this.setId(e),this._initView()}function f(e,t,i,n){this._items={},this._itemLoaded=0,this._itemTotal=0,this._onFinish=null,this._target=null,this._loadingText=null,this._wraperFifth=null,this._secondDiv=null,this._outerDiv=null,this._playBtn=null,this._playImg=null,this._autoLoad=!1!==i,this._onStart=t,this._showBar=!1!==n,m.call(this,e)}function _(e){this.type="IBehavior",this.name="",this.index=o.lastIndex,this.isTimeScale=void 0===e||e,this.needsUpdate=!1,this._playing=!1,o.add(this)}function y(e){_.call(this,e),this.type="Actor",this._actionQueue=[],this._actions=[]}["KeyUp","KeyDown","KeyPress","MouseOver","MouseOut","MouseDown","MouseMove","Click","DblClick","Change"].forEach(function(s){var a="on"+s;p.Element.prototype[a]=function(e){if(e)this.listeners.hasOwnProperty(a)||(this.listeners[a]=[]),this.listeners[a].push(e),this.dom.addEventListener(s.toLowerCase(),e,!1);else{var t=this.listeners[a];if(t)for(var i=0,n=t.length;i<n;i++)this.dom.removeEventListener(s.toLowerCase(),t[i],!1);this.listeners[a]=[]}return this}}),p.Open=function(e){return p.Div.call(this),this.value=void 0!==e&&e,this.setClass("open"),this.opendiv=new p.Panel,this.value?(this.opendiv.setClass("on"),this.setTextContent("打开")):(this.opendiv.setClass("off"),this.setTextContent("关闭")),this.add(this.opendiv),this},p.Span=function(){return p.Element.call(this),this.dom=document.createElement("span"),this},p.Span.prototype=Object.create(p.Element.prototype),p.Span.prototype.constructor=p.Span,p.P=function(){return p.Element.call(this),this.dom=document.createElement("p"),this},p.P.prototype=Object.create(p.Element.prototype),p.P.prototype.constructor=p.P,p.Img=function(){return p.Element.call(this),this.dom=document.createElement("img"),this},p.Img.prototype=Object.create(p.Element.prototype),p.Img.prototype.constructor=p.Img,p.Br=function(){return p.Element.call(this),this.dom=document.createElement("br"),this},p.Br.prototype=Object.create(p.Element.prototype),p.Br.prototype.constructor=p.Br,p.Div=function(){return p.Element.call(this),this.dom=document.createElement("div"),this},p.Div.prototype=Object.create(p.Element.prototype),p.Div.prototype.constructor=p.Div,p.Row=function(){p.Element.call(this);var e=document.createElement("div");return e.className="Row",this.dom=e,this},p.Row.prototype=Object.create(p.Element.prototype),p.Row.prototype.constructor=p.Row,p.Panel=function(){p.Element.call(this);var e=document.createElement("div");return e.className="Panel",this.dom=e,this},p.Panel.prototype=Object.create(p.Element.prototype),p.Panel.prototype.constructor=p.Panel,p.Ul=function(){p.Element.call(this);var e=document.createElement("ul");return this.dom=e,this},p.Ul.prototype=Object.create(p.Element.prototype),p.Ul.prototype.constructor=p.Ul,p.Li=function(){p.Element.call(this);var e=document.createElement("li");return this.dom=e,this},p.Li.prototype=Object.create(p.Element.prototype),p.Li.prototype.constructor=p.Li,p.I=function(){p.Element.call(this);var e=document.createElement("i");return this.dom=e,this},p.I.prototype=Object.create(p.Element.prototype),p.I.prototype.constructor=p.I,p.Form=function(){p.Element.call(this);var e=document.createElement("form");return this.dom=e,this},p.Form.prototype=Object.create(p.Element.prototype),p.Form.prototype.constructor=p.Form,p.Label=function(){p.Element.call(this);var e=document.createElement("label");return this.dom=e,this},p.Label.prototype=Object.create(p.Element.prototype),p.Label.prototype.constructor=p.Label,p.A=function(){p.Element.call(this);var e=document.createElement("a");return this.dom=e,this},p.A.prototype=Object.create(p.Element.prototype),p.A.prototype.constructor=p.A,p.Text=function(e){p.Element.call(this);var t=document.createElement("span");return t.className="Text",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle",this.dom=t,this.setValue(e),this},p.Text.prototype=Object.create(p.Element.prototype),p.Text.prototype.constructor=p.Text,p.Text.prototype.getValue=function(){return this.dom.textContent},p.Text.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e),this},p.Input=function(e){p.Element.call(this);var t=document.createElement("input");return t.className="Input",t.style.padding="2px",t.style.border="1px solid transparent",t.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.dom=t,this.setValue(e),this},p.Input.prototype=Object.create(p.Element.prototype),p.Input.prototype.constructor=p.Input,p.Input.prototype.getValue=function(){return this.dom.value},p.Input.prototype.setValue=function(e){return this.dom.value=e,this},p.TextArea=function(){p.Element.call(this);var i=document.createElement("textarea");return i.className="TextArea",i.style.padding="2px",i.spellcheck=!1,i.addEventListener("keydown",function(e){if(e.stopPropagation(),9===e.keyCode){e.preventDefault();var t=i.selectionStart;i.value=i.value.substring(0,t)+"\t"+i.value.substring(t),i.selectionStart=t+1,i.selectionEnd=i.selectionStart}},!1),this.dom=i,this},p.TextArea.prototype=Object.create(p.Element.prototype),p.TextArea.prototype.constructor=p.TextArea,p.TextArea.prototype.getValue=function(){return this.dom.value},p.TextArea.prototype.setValue=function(e){return this.dom.value=e,this},p.Select=function(){p.Element.call(this);var e=document.createElement("select");return e.className="Select",e.style.padding="2px",this.dom=e,this},p.Select.prototype=Object.create(p.Element.prototype),p.Select.prototype.constructor=p.Select,p.Select.prototype.setMultiple=function(e){return this.dom.multiple=e,this},p.Select.prototype.setOptions=function(e){for(var t=this.dom.value;0<this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);for(var i in e){var n=document.createElement("option");n.value=i,n.innerHTML=e[i],this.dom.appendChild(n)}return this.dom.value=t,this},p.Select.prototype.getValue=function(){return this.dom.value},p.Select.prototype.setValue=function(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this},p.Checkbox=function(e){p.Element.call(this);var t=document.createElement("input");return t.className="Checkbox",t.type="checkbox",this.dom=t,this.setValue(e),this},p.Checkbox.prototype=Object.create(p.Element.prototype),p.Checkbox.prototype.constructor=p.Checkbox,p.Checkbox.prototype.getValue=function(){return this.dom.checked},p.Checkbox.prototype.setValue=function(e){return void 0!==e&&(this.dom.checked=e),this},p.Color=function(){p.Element.call(this);var e=document.createElement("input");e.className="Color",e.style.width="64px",e.style.height="17px",e.style.border="0px",e.style.padding="2px",e.style.backgroundColor="transparent";try{e.type="color",e.value="#ffffff"}catch(e){}return this.dom=e,this},p.Color.prototype=Object.create(p.Element.prototype),p.Color.prototype.constructor=p.Color,p.Color.prototype.getValue=function(){return this.dom.value},p.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},p.Color.prototype.setValue=function(e){return this.dom.value=e,this},p.Color.prototype.setHexValue=function(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this},p.Number=function(e){p.Element.call(this);var n=this,s=document.createElement("input");s.className="Number",s.value="0.00",s.addEventListener("keydown",function(e){e.stopPropagation(),13===e.keyCode&&s.blur()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.dom=s,this.setValue(e);var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!0);var r=0,o=0,h=[0,0],l=[0,0];function t(e){var t=n.value;h=[e.clientX,e.clientY],r+=h[0]-l[0]-(h[1]-l[1]);var i=o+r/(e.shiftKey?5:50)*n.step;t!==(i=Math.min(n.max,Math.max(n.min,i)))&&(n.setValue(i),s.dispatchEvent(a)),l=[e.clientX,e.clientY]}function i(e){document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",i,!1),Math.abs(r)<2&&(s.focus(),s.select())}function c(e){s.style.backgroundColor="transparent",s.style.cursor="col-resize"}return c(),s.addEventListener("mousedown",function(e){e.preventDefault(),r=0,o=n.value,l=[e.clientX,e.clientY],document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",i,!1)},!1),s.addEventListener("change",function(e){n.setValue(s.value)},!1),s.addEventListener("focus",function(e){s.style.backgroundColor="",s.style.cursor=""},!1),s.addEventListener("blur",c,!1),this},p.Number.prototype=Object.create(p.Element.prototype),p.Number.prototype.constructor=p.Number,p.Number.prototype.getValue=function(){return this.value},p.Number.prototype.setValue=function(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this},p.Number.prototype.setPrecision=function(e){return this.precision=e,this},p.Number.prototype.setStep=function(e){return this.step=e,this},p.Number.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},p.Number.prototype.setUnit=function(e){return this.unit=e,this},p.Integer=function(e){p.Element.call(this);var n=this,s=document.createElement("input");s.className="Number",s.value="0",s.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.dom=s,this.setValue(e);var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!0);var r=0,o=0,h=[0,0],l=[0,0];function t(e){var t=n.value;h=[e.clientX,e.clientY],r+=h[0]-l[0]-(h[1]-l[1]);var i=o+r/(e.shiftKey?5:50)*n.step;t!==(i=0|Math.min(n.max,Math.max(n.min,i)))&&(n.setValue(i),s.dispatchEvent(a)),l=[e.clientX,e.clientY]}function i(e){document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",i,!1),Math.abs(r)<2&&(s.focus(),s.select())}function c(e){s.style.backgroundColor="transparent",s.style.cursor="col-resize"}return c(),s.addEventListener("mousedown",function(e){e.preventDefault(),r=0,o=n.value,l=[e.clientX,e.clientY],document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",i,!1)},!1),s.addEventListener("change",function(e){n.setValue(s.value)},!1),s.addEventListener("focus",function(e){s.style.backgroundColor="",s.style.cursor=""},!1),s.addEventListener("blur",c,!1),this},p.Integer.prototype=Object.create(p.Element.prototype),p.Integer.prototype.constructor=p.Integer,p.Integer.prototype.getValue=function(){return this.value},p.Integer.prototype.setValue=function(e){return void 0!==e&&(e=parseInt(e),this.value=e,this.dom.value=e),this},p.Number.prototype.setStep=function(e){return this.step=e,this},p.Integer.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},p.Break=function(){p.Element.call(this);var e=document.createElement("br");return e.className="Break",this.dom=e,this},p.Break.prototype=Object.create(p.Element.prototype),p.Break.prototype.constructor=p.Break,p.HorizontalRule=function(){p.Element.call(this);var e=document.createElement("hr");return e.className="HorizontalRule",this.dom=e,this},p.HorizontalRule.prototype=Object.create(p.Element.prototype),p.HorizontalRule.prototype.constructor=p.HorizontalRule,p.Button=function(e){p.Element.call(this);var t=document.createElement("button");return this.dom=t,this.dom.textContent=e,this},p.Button.prototype=Object.create(p.Element.prototype),p.Button.prototype.constructor=p.Button,p.Button.prototype.setLabel=function(e){return this.dom.textContent=e,this},p.Modal=function(e){var t=this,i=document.createElement("div");return i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0,0,0,0.5)",i.style.display="none",i.style.alignItems="center",i.style.justifyContent="center",i.addEventListener("click",function(e){t.hide()}),this.dom=i,this.container=new p.Panel,this.container.dom.style.width="200px",this.container.dom.style.padding="20px",this.container.dom.style.backgroundColor="#ffffff",this.container.dom.style.boxShadow="0px 5px 10px rgba(0,0,0,0.5)",this.add(this.container),this},p.Modal.prototype=Object.create(p.Element.prototype),p.Modal.prototype.constructor=p.Modal,p.Modal.prototype.show=function(e){return this.container.clear(),this.container.add(e),this.dom.style.display="flex",this},p.Modal.prototype.hide=function(){return this.dom.style.display="none",this},p.Canvas=function(){return p.Element.call(this),this.dom=document.createElement("canvas"),this},p.Canvas.prototype=Object.create(p.Element.prototype),p.Canvas.prototype.constructor=p.Canvas,((m.prototype=Object.create(p.Div.prototype)).constructor=m).prototype._initView=function(){},m.prototype.setVisible=function(e){this.visible=e},m.prototype.dispose=function(){null!==this.parent&&this.parent.remove(this)},((f.prototype=Object.create(m.prototype)).constructor=f).prototype._initView=function(){if(this._showBar){var e=(new p.Div).setClass("LoadingMainTop"),t=(new p.Div).setClass("LoadingMainBot"),i=(new p.Div).setClass("LoadingMainBotOut");this._loadingText=new p.Text("").setClass("LoadingMainShow"),this._outerDiv=(new p.Div).setId("Loading-begin"),this._wraperFifth=(new p.Div).setClass("LoadingMainBotin"),this._secondDiv=(new p.Div).setId("LoadingMain"),e.add(this._loadingText),i.add(this._wraperFifth),t.add(i),this._secondDiv.add(e,t);var n=(new m).setClass("play-triangle");this._playImg=(new p.Img).setAttr({src:"/assets/editor/img/animat-play.png"}),this._playBtn=(new p.Div).setClass("play-box"),n.add(this._playImg),this._playBtn.add(n),this.add(this._outerDiv),this._autoLoad?(this._outerDiv.add(this._secondDiv),this._onStart&&this._onStart()):(this.add(this._playBtn),this._playImg.addEventListener(g.Click,this._startLoad,this))}else this._onStart&&this._onStart()},f.prototype.addItem=function(e){this._items.hasOwnProperty(e)||(this._items[e]=0,this._itemTotal++)},f.prototype.updateBackground=function(e){this._outerDiv&&(this._outerDiv.setStyle("background",["#2E2E2E url("+e+") no-repeat center top"]),this._outerDiv.setStyle("background-size",["auto 100%"]))},f.prototype.updateTitle=function(e){this._loadingText&&this._loadingText.setValue(e)},f.prototype.updateProgress=function(e,t,i){if(this._wraperFifth&&0===this._items[e]){var n=(this._itemLoaded+t/i)/this._itemTotal,s=Math.round(100*n);this._wraperFifth.setStyle("width",[s+"%"])}},f.prototype.finishProgress=function(e){this._items[e]=1,this._itemLoaded++,this._itemLoaded===this._itemTotal&&this._onFinish&&this._onFinish.call(this._target)},f.prototype.bindFinishFunc=function(e,t){"function"==typeof e?(this._target=void 0===t?this:t,this._onFinish=e):(this._target=null,this._onFinish=null)},f.prototype.reset=function(){this._items={},this._itemLoaded=0,this._itemTotal=0},f.prototype._startLoad=function(e){this._playImg.removeEventListener(g.Click,this._startLoad,this),this.remove(this._playBtn),this._outerDiv.add(this._secondDiv),this._onStart&&this._onStart()},f.prototype.dispose=function(){this._target=null,this._onFinish=null,this._items=null,this._loadingText=null,this._wraperFifth=null,this._secondDiv=null,this._outerDiv=null,this._playBtn=null,this._playImg=null,this._onStart=null,m.prototype.dispose.call(this)},_.prototype={constructor:_,get isBehavior(){return!0},get isPlaying(){return this._playing},get timeScale(){return o.timeScale},update:function(e){},play:function(){this._playing=!0},stop:function(){this._playing=!1},dispose:function(){o.remove(this)}},((y.prototype=Object.create(_.prototype)).constructor=y).prototype.update=function(e){var t,i,n,s=!1,a=[];if(null!==this._actions&&0<this._actions.length)for(i=0,n=this._actions.length;i<n;i++)t=this._actions[i],this.playAction(t,e)&&!t.isDisposed?s=!0:a.push(t);for(i=0,n=a.length;i<n;i++)t=a[i],this._actions.splice(this._actions.indexOf(t),1);this._playQueue(e)&&(s=!0),s||this.stop()},y.prototype.addAction=function(e){this._actions.push(e)},y.prototype.addQueue=function(e){this._actionQueue.push(e)},y.prototype.playAction=function(e,t){return e.started||this._computeAction(e),e.timePassed+=t*(this.isTimeScale?this.timeScale:1),!1},y.prototype._playQueue=function(e){if(null!==this._actionQueue&&0<this._actionQueue.length){var t=this._actionQueue[0];return!!this.playAction(t,e)||(this._actionQueue.splice(0,1),this._playQueue(e))}return!1},y.prototype._computeAction=function(e){e.started=!0},y.prototype.dispose=function(){var e,t;if(null!==this._actions&&0<this._actions.length)for(e=0,t=this._actions.length;e<t;e++)this._actions[e].dispose();if(null!==this._actionQueue&&0<this._actionQueue.length)for(e=0,t=this._actionQueue.length;e<t;e++)this._actionQueue[e].dispose();this._actionQueue=[],this._actions=[],_.prototype.dispose.call(this)};var v={Linear:function(e,t,i,n){return i*e/n+t},Quad:{easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}},Cubic:{easeIn:function(e,t,i,n){return i*(e/=n)*e*e+t},easeOut:function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t}},Quart:{easeIn:function(e,t,i,n){return i*(e/=n)*e*e*e+t},easeOut:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t}},Quint:{easeIn:function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},easeOut:function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t}},Sine:{easeIn:function(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t},easeOut:function(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t},easeInOut:function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t}},Expo:{easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(1-Math.pow(2,-10*e/n))+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t}},Circ:{easeIn:function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOut:function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},Elastic:{easeIn:function(e,t,i,n,s,a){if(0==e)return t;if(1==(e/=n))return t+i;if(a||(a=.3*n),!s||s<Math.abs(i)){s=i;var r=a/4}else r=a/(2*Math.PI)*Math.asin(i/s);return-s*Math.pow(2,10*(e-=1))*Math.sin((e*n-r)*(2*Math.PI)/a)+t},easeOut:function(e,t,i,n,s,a){if(0==e)return t;if(1==(e/=n))return t+i;if(a||(a=.3*n),!s||s<Math.abs(i)){s=i;var r=a/4}else r=a/(2*Math.PI)*Math.asin(i/s);return s*Math.pow(2,-10*e)*Math.sin((e*n-r)*(2*Math.PI)/a)+i+t},easeInOut:function(e,t,i,n,s,a){if(0==e)return t;if(2==(e/=n/2))return t+i;if(a||(a=n*(.3*1.5)),!s||s<Math.abs(i)){s=i;var r=a/4}else r=a/(2*Math.PI)*Math.asin(i/s);return e<1?s*Math.pow(2,10*(e-=1))*Math.sin((e*n-r)*(2*Math.PI)/a)*-.5+t:s*Math.pow(2,-10*(e-=1))*Math.sin((e*n-r)*(2*Math.PI)/a)*.5+i+t}},Back:{easeIn:function(e,t,i,n,s){return null==s&&(s=1.70158),i*(e/=n)*e*((s+1)*e-s)+t},easeOut:function(e,t,i,n,s){return null==s&&(s=1.70158),i*((e=e/n-1)*e*((s+1)*e+s)+1)+t},easeInOut:function(e,t,i,n,s){return null==s&&(s=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(s*=1.525))*e-s))+t:i/2*((e-=2)*e*((1+(s*=1.525))*e+s)+2)+t}},Bounce:{easeIn:function(e,t,i,n){return i-v.Bounce.easeOut(n-e,0,i,n)+t},easeOut:function(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOut:function(e,t,i,n){return e<n/2?.5*v.Bounce.easeIn(2*e,0,i,n)+t:.5*v.Bounce.easeOut(2*e-n,0,i,n)+.5*i+t}}};function w(e,t,i){this.type="BaseAction",this.started=!1,this.object=e,this.onFinish=void 0===t?null:t,this.time=0,this.timePassed=0,this.start=null,this.change=null,this.speed=0,this.easeFunc=void 0===i?v.Linear:i,this.frameFunc=null,this.isDisposed=!1}function S(){y.call(this),this.type="HTMLDomAlphaActor"}function C(e){this.pid=0,this.sendType=Punk.NetworkType.POST,this.uri=null,this.data=null,this.throwError=!1,this.type="NetworkModel",l.call(this,e)}function b(e){this.key=0,this.uri="",this.name="",this.thumb="",this.format="",this.tFormat="",this.isCube=!1,this.texture=null,this.textures={},this.onLoad={},this.qualityLoad=[],this._quality=[Punk.Quality.ORIGINAL],this.type="TextureLoaderModel",l.call(this,e)}function M(e){b.call(this,e),this.type="SkyTextureLoaderModel",this._isCube=!1}function E(){y.call(this),this.type="PositionActor"}function x(){y.call(this),this.type="RotateActor",this._vector=new Q.SDK.Vector3,this._spherical=new Q.SDK.Spherical}function P(){y.call(this),this.type="LookAtActor",this._vector=new Q.SDK.Vector3}function k(e,t,i){w.call(this),this.type="CameraAction",this.onFinish=void 0===t?null:t,this.object=e,this.easeFunc=void 0===i?v.Linear:i}function L(){y.call(this),this.type="CameraActor",this._vector=new Q.SDK.Vector3}function R(){this._actors={}}Object.assign(w.prototype,{dispose:function(){this.object=null,this.onFinish=null,this.start=null,this.change=null,this.easeFunc=null,this.frameFunc=null,this.isDisposed=!0}}),((S.prototype=Object.create(y.prototype)).constructor=S).prototype.to=function(e,t,i,n,s){var a=new w(e,n);a.endAlpha=t,a.time=i,a.easeFunc=void 0!==s?s:a.easeFunc,this.addAction(a),this.play()},S.prototype.playAction=function(e,t){return 1e3<t||(y.prototype.playAction.call(this,e,t),e.timePassed>=e.time?(e.object.style.opacity=e.endAlpha,this.endAction(e),!1):(e.object.style.opacity=e.easeFunc(e.timePassed,e.start,e.change,e.time),!0))},S.prototype.endAction=function(e){null!==e.onFinish&&e.onFinish(),e.dispose()},S.prototype._computeAction=function(e){null===e.start&&(e.start=e.object.style.opacity?e.object.style.opacity:1),null===e.change&&(e.change=e.endAlpha-e.start),e.started=!0},((C.prototype=Object.create(l.prototype)).constructor=C).prototype.dispose=function(){l.prototype.dispose.call(this),this.data=null},Object.defineProperty(b.prototype,"quality",{set:function(e){e&&(-1<e.indexOf("h")&&(this._quality.push(Punk.Quality.HIGH),this.thumb="high"),-1<e.indexOf("m")&&(this._quality.push(Punk.Quality.MIDDLE),this.thumb="middle"),-1<e.indexOf("l")&&(this._quality.push(Punk.Quality.LOW),this.thumb="low"),-1<e.indexOf("t")&&(this._quality.push(Punk.Quality.THUMB),this.thumb="thumb"))},get:function(){return this._quality}}),Object.defineProperty(b.prototype,"tid",{set:function(e){this.key=parseInt(e)},get:function(){return this.key}}),Object.defineProperty(b.prototype,"t_format",{set:function(e){this.tFormat=e},get:function(){return this.tFormat}}),Object.assign(b.prototype,l.prototype,{getQuality:function(e){var t;if(-1<this._quality.indexOf(e))t=e;else for(var i=Punk.Quality.ORIGINAL;i>=Punk.Quality.THUMB&&!(-1<this._quality.indexOf(i)&&(t=i)<e);i--);return this._getQualityName(t)},_getQualityName:function(e){switch(e){case Punk.Quality.LOW:return"low";case Punk.Quality.THUMB:return"thumb";case Punk.Quality.MIDDLE:return"middle";case Punk.Quality.HIGH:return"high";default:return""}},dispose:function(){l.prototype.dispose.call(this),this.texture=null,this.textures=null,this.onLoad=null,this.quality=null,this.qualityLoad=null}}),Object.defineProperty(M.prototype,"quality",{set:function(e){},get:function(){return this._quality}}),Object.defineProperty(M.prototype,"tid",{set:function(e){this.key="sky_"+parseInt(e)},get:function(){return this.key}}),Object.defineProperty(M.prototype,"t_format",{set:function(e){this.tFormat=e},get:function(){return this.tFormat}}),Object.defineProperty(M.prototype,"isCube",{set:function(e){this._isCube=e,this.thumb=e?"":"32X32",this._quality=e?[Punk.Quality.ORIGINAL]:[Punk.Quality.THUMB,Punk.Quality.LOW,Punk.Quality.HIGH]},get:function(){return this._isCube}}),Object.assign(M.prototype,b.prototype,{_getQualityName:function(e){switch(e){case Punk.Quality.LOW:return"128X64";case Punk.Quality.THUMB:return"32X32";case Punk.Quality.MIDDLE:return"512X256";case Punk.Quality.HIGH:return"1024X512";default:return""}}}),((E.prototype=Object.create(y.prototype)).constructor=E).prototype.moveTo=function(e,t,i,n,s,a,r,o){a=void 0!==a&&a;var h=new w(e,s);h.endPoint=(new Q.SDK.Vector3).copy(t),h.time=i,h.center=null!==n?(new Q.SDK.Vector3).copy(n):null,h.easeFunc=void 0!==r?r:h.easeFunc,h.frameFunc=o,a?this.addQueue(h):this.addAction(h),this.play()},E.prototype.playAction=function(e,t){if(1e3<t)return!0;if(y.prototype.playAction.call(this,e,t),this.needsUpdate=!0,e.timePassed>=e.time)return e.object.position.copy(e.start).add(e.change),null!==e.center&&e.object.lookAt(e.center),this.endAction(e),!1;var i=e.easeFunc(e.timePassed,e.start.x,e.change.x,e.time),n=e.easeFunc(e.timePassed,e.start.y,e.change.y,e.time),s=e.easeFunc(e.timePassed,e.start.z,e.change.z,e.time);return e.object.position.set(i,n,s),null!==e.center&&e.object.lookAt(e.center),e.frameFunc&&e.frameFunc(),!0},E.prototype.endAction=function(e){null!==e.onFinish&&e.onFinish(),e.dispose()},E.prototype._computeAction=function(e){null===e.start&&(e.start=(new Q.SDK.Vector3).copy(e.object.position)),null===e.change&&(e.change=(new Q.SDK.Vector3).copy(e.endPoint).sub(e.object.position)),e.started=!0},((x.prototype=Object.create(y.prototype)).constructor=x).prototype.axisRotateAddition=function(e,t,i,n,s,a,r){a=void 0!==a&&a;var o=new w(e,s);switch(o.type="AxisRotate",o.time=n,o.change=new Q.SDK.Vector3,o.easeFunc=void 0!==r?r:o.easeFunc,i){case"x":o.change.x=t;break;case"y":o.change.y=t;break;case"z":o.change.z=t}a?this.addQueue(o):this.addAction(o),this.play()},x.prototype.rotateTo=function(e,t,i,n,s){s=void 0!==s&&s;var a=new w(e,n);a.time=i,a.endRo=t,s?this.addQueue(a):this.addAction(a),this.play()},x.prototype.targetAxisRotate=function(e,t,i,n){var s=new w(e,null);s.type="targetRotate",s.target=t instanceof Q.SDK.Object3D?t.position:t,s.speed=n,s.axis=i,s.started=!0,this.addAction(s),this.play()},x.prototype.playAction=function(e,t){if(1e3<t)return!0;if(y.prototype.playAction.call(this,e,t),this.needsUpdate=!0,"targetRotate"===e.type){var i=e.speed*t/1e3;this._vector.copy(e.object.position).sub(e.target),this._spherical.setFromVector3(this._vector),"x"===e.axis?this._spherical.theta+=i:"y"===e.axis&&(this._spherical.phi+=i),this._spherical.makeSafe(),this._vector.setFromSpherical(this._spherical),e.object.position.copy(e.target).add(this._vector),e.object.lookAt(e.target)}else{if(e.timePassed>=e.time)return this._vector.copy(e.start).add(e.change),e.object.rotation.x=this._vector.x,e.object.rotation.y=this._vector.y,e.object.rotation.z=this._vector.z,this.endAction(e),!1;var n=e.easeFunc(e.timePassed,e.start.x,e.change.x,e.time),s=e.easeFunc(e.timePassed,e.start.y,e.change.y,e.time),a=e.easeFunc(e.timePassed,e.start.z,e.change.z,e.time);e.object.rotation.x=n,e.object.rotation.y=s,e.object.rotation.z=a}return!0},x.prototype.endAction=function(e){null!==e.onFinish&&e.onFinish(),e.dispose()},x.prototype.dispose=function(){y.prototype.dispose.call(this),this._vector=null},x.prototype._computeAction=function(e){null===e.start&&(e.start=(new Q.SDK.Vector3).copy(e.object.rotation)),null===e.change&&(e.change=(new Q.SDK.Vector3).copy(e.endRo).sub(e.object.rotation)),e.started=!0},((P.prototype=Object.create(y.prototype)).constructor=P).prototype.lookAtTo=function(e,t,i,n,s,a){var r=new w(e,s);r.start=(new Q.SDK.Vector3).copy(t),r.change=(new Q.SDK.Vector3).copy(i).sub(r.start),r.time=n,r.easeFunc=void 0!==a?a:r.easeFunc,this.addAction(r),this.play()},P.prototype.playAction=function(e,t){if(1e3<t)return!0;if(y.prototype.playAction.call(this,e,t),this.needsUpdate=!0,e.timePassed>=e.time)return this._vector.copy(e.start).add(e.change),e.object.lookAt(this._vector),this.endAction(e),!1;var i=e.easeFunc(e.timePassed,e.start.x,e.change.x,e.time),n=e.easeFunc(e.timePassed,e.start.y,e.change.y,e.time),s=e.easeFunc(e.timePassed,e.start.z,e.change.z,e.time);return this._vector.set(i,n,s),e.object.lookAt(this._vector),!0},P.prototype.endAction=function(e){null!==e.onFinish&&e.onFinish(),e.dispose()},P.prototype.dispose=function(){y.prototype.dispose.call(this),this._vector=null},Object.assign(k.prototype,{dispose:function(){this.object=null,this.onFinish=null,this.start=null,this.change=null,this.easeFunc=null}}),((L.prototype=Object.create(y.prototype)).constructor=L).prototype.fovAtTo=function(e,t,i,n,s,a,r,o){r=void 0!==r&&r;var h=new k(e,a);h.endFov=Number(t),h.startFov=i,h.time=n,h.center=null!==s?(new Q.SDK.Vector3).copy(s):null,h.easeFunc=void 0!==o?o:h.easeFunc,r?this.addQueue(h):this.addAction(h),this.play()},L.prototype.playAction=function(e,t){if(1e3<t)return!0;if(y.prototype.playAction.call(this,e,t),this.needsUpdate=!0,e.timePassed>=e.time||Math.abs(e.object.fov-e.endFov)<=1)return e.object.fov=e.endFov,e.object.updateProjectionMatrix(),this.endAction(e),!1;var i=e.easeFunc(e.timePassed,e.start,e.change,e.time);return e.object.fov=i,e.object.updateProjectionMatrix(),!0},L.prototype.endAction=function(e){null!==e.onFinish&&e.onFinish(!0),e.dispose()},L.prototype._computeAction=function(e){null===e.start&&(e.start=parseFloat(e.object.fov)),null===e.change&&(e.change=parseFloat(e.endFov-e.start)),e.started=!0},Object.assign(R.prototype,{getActor:function(e){if(this._actors.hasOwnProperty(e))return this._actors[e];var t=new(this._defineActor(e));return this._actors[e]=t},_defineActor:function(e){switch(e){case"PositionActor":return E;case"RotateActor":return x;case"LookAtActor":return P;case"CameraActor":return L}}});var A,O,I=new R;function D(){THREE.Scene.call(this),this.type="Scene",this.objects=[],this.viewLayer=new THREE.Object3D,this._index=0,this.add(this.viewLayer)}function j(){THREE.Scene.call(this),this._helpers={}}function H(e){this.oldIndex=-1,this.data="",this.cameraId=-1,this.type="CameraImageModel",l.call(this,e)}function B(e){this.name="",this.cameraType=null,this.fov=50,this.matrix=null,this.active=0,this.img=new H,this._center=new Q.SDK.Vector3,this.type="CameraModel",l.call(this,e)}function F(e,t,i,n){THREE.PerspectiveCamera.call(this,e,t,i,n)}((D.prototype=Object.create(THREE.Scene.prototype)).constructor=D).prototype.addObject=function(t,e){this._beforeObjectAdd(t),this._getLayer(e).add(t);var i,n,s=this;t.traverse(function(e){!e.isMesh&&!t.isPoint||e.isWireframe||(s.objects.push(e),e.name||(e.name=s._index),s._index++,e.geometry&&((i=e.geometry)instanceof Q.SDK.Geometry?1==i.faceVertexUvs.length&&(i.faceVertexUvs[1]=i.faceVertexUvs[0]):i instanceof Q.SDK.BufferGeometry&&i.attributes.uv&&(n=i.attributes.uv.array,i.getAttribute("uv2")||i.addAttribute("uv2",new Q.SDK.BufferAttribute(n,2)))))}),this._afterObjectAdd(t)},D.prototype.removeObject=function(t){if(null!==t.parent){this._beforeRemoveObject(t);var i=this;t.parent.remove(t),t.traverse(function(e){(e instanceof THREE.Mesh||t.isPoint)&&i.objects.splice(i.objects.indexOf(e),1)}),this._afterRemoveObject(t)}},D.prototype.findObjectByMaterial=function(e){for(var t,i=this.objects,n=[],s=0,a=i.length;s<a;s++){var r=i[s];if(r instanceof THREE.Mesh)if((t=r.material)instanceof Array){for(var o=0,h=t.length;o<h;o++)if(t[o]===e){n.push(r);break}}else t===e&&n.push(r)}return 0<n.length?n:null},D.prototype.dispose=function(){this.remove(this.viewLayer),this.viewLayer=null;for(var e=0,t=this.objects.length;e<t;e++)this.removeObject(this.objects[e]);this.objects=null},D.prototype.fromJSON=function(e){},D.prototype.toJSON=function(){},D.prototype._getLayer=function(e){switch(e){case Punk.ViewLayer:default:return this.viewLayer}},D.prototype.rotateLayer=function(e,t,i){i=void 0!==i&&i,e=this._getLayer(e),t=i?this._getOppositeDirection(t):t;var n=Math.PI/2,s="";switch(t){case Punk.Directions.XL:case Punk.Directions.XR:n=t==Punk.Directions.XL?-n:n,s="x";break;case Punk.Directions.YL:case Punk.Directions.YR:n=t==Punk.Directions.YL?-n:n,s="z";break;case Punk.Directions.ZL:case Punk.Directions.ZR:n=t==Punk.Directions.ZL?-n:n,s="y"}I.getActor("RotateActor").axisRotateAddition(e,n,s,300,null,!0)},D.prototype._getOppositeDirection=function(e){switch(e){case Punk.Directions.XL:return Punk.Directions.XR;case Punk.Directions.XR:return Punk.Directions.XL;case Punk.Directions.YL:return Punk.Directions.YR;case Punk.Directions.YR:return Punk.Directions.YL;case Punk.Directions.ZL:return Punk.Directions.ZR;case Punk.Directions.ZR:return Punk.Directions.ZL;default:return null}},D.prototype._beforeObjectAdd=function(e){},D.prototype._afterObjectAdd=function(e){},D.prototype._beforeRemoveObject=function(e){},D.prototype._afterRemoveObject=function(e){},((j.prototype=Object.create(THREE.Scene.prototype)).constructor=j).prototype.addHelper=(A=new THREE.SphereBufferGeometry(2,4,2),O=new THREE.MeshBasicMaterial({color:16711680,visible:!1}),function(e){var t;if(e instanceof THREE.Camera)t=new THREE.CameraHelper(e,1);else if(e instanceof THREE.PointLight)t=new THREE.PointLightHelper(e,1);else if(e instanceof THREE.DirectionalLight)t=new THREE.DirectionalLightHelper(e,1);else if(e instanceof THREE.SpotLight)t=new THREE.SpotLightHelper(e,1);else if(e instanceof THREE.HemisphereLight)t=new THREE.HemisphereLightHelper(e,1);else{if(!(e instanceof THREE.SkinnedMesh))return;t=new THREE.SkeletonHelper(e)}var i=new THREE.Mesh(A,O);i.name="picker",i.userData.object=e,t.add(i),t.visible=!1,this.add(t),this._helpers[e.id]=t}),j.prototype.getHelper=function(e){return this._helpers.hasOwnProperty(e.id)?this._helpers[e.id]:null},j.prototype.removeHelper=function(e){if(void 0!==this._helpers[e.id]){var t=this._helpers[e.id];this.remove(t),delete this._helpers[e.id]}},Object.assign(H.prototype,l.prototype),Object.defineProperty(B.prototype,"meta",{set:function(e){this.cameraType=e}}),Object.defineProperty(B.prototype,"oldIndex",{set:function(e){this.img.oldIndex=e}}),Object.defineProperty(B.prototype,"object",{get:function(){return!0},set:function(e){this.fov=e.fov,this.matrix=e.matrix}}),Object.defineProperty(B.prototype,"center",{get:function(){return this._center},set:function(e){this._center.copy(e)}}),Object.assign(B.prototype,l.prototype,{clone:function(){var e=new B;return e.name=this.name,e.fov=this.fov,e.matrix=this.matrix,e.active=this.active,e._center=this._center,e.type=this.type,e.cameraType=this.cameraType,e},dispose:function(){this._center=null,this.matrix=null}}),((F.prototype=Object.create(THREE.PerspectiveCamera.prototype)).constructor=F).prototype.updateFov=function(e){this.fov=e,this.updateProjectionMatrix()},F.prototype.fromJSON=function(e){null!=e&&(this.fov=e.fov,this.matrix.fromArray(e.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale),this.lookAt(e.center),this.updateProjectionMatrix())},F.prototype.toJSON=function(){this.updateProjectionMatrix();var e=new B;return e.name=this.name,e.cameraType=this.type,e.fov=this.fov,e.matrix=this.matrix.toArray(),e};var N=function(){var n=0,s=1,T=4663,i=4664,d=4665,a=4666,r=4667,u=4668,l=4669,o=4670,k=1,L=2,R=4,A=256,O=65536,I=8,D=8,f={},_=[],c={"?mat.name":"name","$mat.shadingm":"flatShading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},p={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$mat.shininess":"float","$tex.file":"map"};function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function m(e,t){for(var i,n,s,a=t.name||"",r=t.duration||-1,o=t.fps||30,h=r/o,l=[],c=0;c<t.numChannels;c++)s=W(e,(n=t.channels[c]).name),0<n.numPositionKeys&&l.push(y(s.uuid,n.positionKeys,"position",o)),0<n.numRotationKeys&&l.push(y(s.uuid,n.rotationKeys,"quaternion",o)),0<n.numScalingKeys&&l.push(y(s.uuid,n.scalingKeys,"scale",o));return(i=new THREE.AnimationClip(a,h,l)).frameCount=r,i.fps=o,i}function y(e,t,i,n){var s,a;switch(e=e+"."+i,t.sort(G),i){case"position":case"scale":a=THREE.VectorKeyframeTrack;break;case"quaternion":a=THREE.QuaternionKeyframeTrack}for(var r,o=[],h=[],l=0,c=t.length;l<c;l++){if(o.push(t[l].time/n),r=t[l].values,"quaternion"===i){var d=r[0];r[0]=r[1],r[1]=r[2],r[2]=r[3],r[3]=d}for(var u in r)h.push(r[u])}return(s=new a(e,o,h)).bTimes=o,s.bValues=h,s}function g(e){K(N(e)==T),e.seek(4),e.seek(4);var t,i,n,s,a,r,o,h,l,c=F(e),d=F(e),u=F(e),p=F(e),m=[],f=null,_=F(e);_&k&&(t=e.subArray32(e.readOffset,e.readOffset+3*c*4),e.seek(3*c*4)),_&L&&(i=e.subArray32(e.readOffset,e.readOffset+3*c*4),e.seek(3*c*4)),_&R&&(n=e.subArray32(e.readOffset,e.readOffset+3*c*4),e.seek(3*c*4),s=e.subArray32(e.readOffset,e.readOffset+3*c*4),e.seek(3*c*4));for(var y=0;y<I&&_&O<<y;++y)a=e.subArray32(e.readOffset,e.readOffset+4*c*4),e.seek(4*c*4);for(r=[],y=0;y<D&&_&A<<y;++y){e.seek(4),r[y]=[];for(var g=0;g<c;g++)r[y].push(H(e)),r[y].push(H(e)),e.seek(4)}for(var v=0;v<d;++v){for(o=B(e),h=[],l=0;l<o;++l)h[l]=c<65536?B(e):F(e);3===o?(m.push(h[0]),m.push(h[1]),m.push(h[2])):4===o&&(m.push(h[0]),m.push(h[1]),m.push(h[2]),m.push(h[2]),m.push(h[3]),m.push(h[0]))}if(u)for(f=[],l=0;l<u;++l)f[l]=j(e);var w=new function(){this.geometry=null,this.bones=null,this.materialIndex=-1},S=new THREE.BufferGeometry;if(S.setIndex(new THREE.BufferAttribute(new Uint32Array(m),1)),S.addAttribute("position",new THREE.BufferAttribute(t,3)),i&&0<i.length&&S.addAttribute("normal",new THREE.BufferAttribute(i,3)),a&&0<a.length&&S.addAttribute("color",new THREE.BufferAttribute(a,4)),r[0]&&0<r[0].length&&S.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(r[0]),2)),r[1]&&0<r[1].length&&S.addAttribute("uv2",new THREE.BufferAttribute(new Float32Array(r[1]),2)),n&&0<n.length&&S.addAttribute("tangents",new THREE.BufferAttribute(n,3)),s&&0<s.length&&S.addAttribute("bitangents",new THREE.BufferAttribute(s,3)),f&&0<f.length){var C=[],b=[];for(v=0;v<f.length;v++)for(var M=0;M<f[v].weights.length;M++){var E=f[v].weights[M];E&&(C[E.mVertexId]||(C[E.mVertexId]=[]),b[E.mVertexId]||(b[E.mVertexId]=[]),C[E.mVertexId].push(E.mWeight),b[E.mVertexId].push(v))}for(v in b)Q(b[v],C[v]);var x=[],P=[];for(v=0;v<C.length;v++)for(M=0;M<4;M++)C[v]&&b[v]?(x.push(C[v][M]),P.push(b[v][M])):(x.push(0),P.push(0));S.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(x),4)),S.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(P),4))}return w.geometry=S,w.bones=f,w.materialIndex=p,w}function j(e){K(N(e)==a),e.seek(4);var t=new function(){this.name="",this.numWeights=0,this.offsetMatrix=null,this.weights=[]};return t.name=x(e),t.numWeights=F(e),t.offsetMatrix=V(e),z(e,t.weights,t.numWeights,P),t}function v(e){K(N(e)==l),e.seek(4);var t=F(e),i=[];if(t)for(var n=0;n<t;++n)i[n]=w(e);var s,a=i[0].dataAsString();if(f&&f.hasOwnProperty(a))s=f[a];else{var r,o;for(s=new THREE.MeshPhysicalMaterial,n=0;n<i.length;n++)switch(r=i[n].mKey,o=c[r],p[r]){case"float":s[o]=i[n].dataAsFloat();break;case"color":s[o]=i[n].dataAsColor();break;case"string":s[o]=i[n].dataAsString();break;case"bool":var h=i[n].dataAsBool();s[o]="flatShading"===o?!h:h}f.hasOwnProperty(s.name)||(f[s.name]=s)}return s}function w(e){K(N(e)==o),e.seek(4);var t=new function(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e),i=t.getFloat32(0,!0),n=t.getFloat32(4,!0),s=t.getFloat32(8,!0);return new THREE.Color(i,n,s)},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e);return t.getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e),i=t.getFloat32(0,!0);return!!i},this.dataAsString=function(){var t="";return this.mData.forEach(function(e){t+=String.fromCharCode(e)}),t.replace(/[^\x20-\x7E]+/g,"")}};return t.mKey=x(e),t.mSemantic=F(e),t.mIndex=F(e),t.mDataLength=F(e),t.mType=F(e),t.mData=[],e.readBytes(t.mData,1,t.mDataLength),t}function S(e){K(N(e)==r),e.seek(4);var t=new function(){this.name="",this.duration=-1,this.fps=30,this.numChannels=0,this.channels=null};if(t.name=x(e),t.duration=M(e),t.fps=M(e),t.numChannels=F(e),t.numChannels){t.channels=[];for(var i=0;i<t.numChannels;++i)t.channels[i]=h(e)}return t}function h(e){K(N(e)==i),e.seek(4);var t=new function(){this.name="",this.numPositionKeys=0,this.numRotationKeys=0,this.numScalingKeys=0,this.preState=0,this.postState=0,this.positionKeys=null,this.rotationKeys=null,this.scalingKeys=null};return t.name=x(e),t.numPositionKeys=F(e),t.numRotationKeys=F(e),t.numScalingKeys=F(e),t.preState=F(e),t.postState=F(e),t.numPositionKeys&&(t.positionKeys=[],z(e,t.positionKeys,t.numPositionKeys,U)),t.numRotationKeys&&(t.rotationKeys=[],z(e,t.rotationKeys,t.numRotationKeys,q)),t.numScalingKeys&&(t.scalingKeys=[],z(e,t.scalingKeys,t.numScalingKeys,U)),t}function C(){this.time=0,this.values=null}e.prototype={load:function(e,i,t,n){var s=this,a=new THREE.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,function(e){var t=s.punkParse(e);i(t)},t,n)},punkParse:function(e){var i,t=new DataView(e);return(i=t).readOffset=0,i.seek=function(e,t){(t=t||n)==n?i.readOffset+=e:t==s&&(i.readOffset=e)},i.readBytes=function(e,t,i){for(var n=t*i,s=0;s<n;s++)e[s]=E(this)},i.subArray32=function(e,t){var i=this.buffer,n=i.slice(e,t);return new Float32Array(n)},i.subArrayUint16=function(e,t){var i=this.buffer,n=i.slice(e,t);return new Uint16Array(n)},i.subArrayUint8=function(e,t){var i=this.buffer,n=i.slice(e,t);return new Uint8Array(n)},i.subArrayUint32=function(e,t){var i=this.buffer,n=i.slice(e,t);return new Uint32Array(n)},t.seek(4),t.seek(44),t.seek(4),t.seek(4),t.seek(4),t.seek(4),t.seek(2),t.seek(2),t.seek(256),t.seek(128),t.seek(64),function(e){K(N(e)==d),e.seek(4),e.seek(4);var t,i,n,s,a=F(e),r=F(e),o=F(e),h=(F(e),F(e),F(e),function e(t,i){var n=N(t);K(n==u);t.seek(4);var s=new function(){this.name="",this.matrix=null,this.numChildren=0,this.numMeshes=0,this.meshes=null,this.children=null,this.parent=null};s.parent=i;s.name=x(t);s.matrix=V(t);s.numChildren=F(t);s.numMeshes=F(t);var a;if(s.numMeshes)for(s.meshes=[],a=0;a<s.numMeshes;++a)s.meshes[a]=F(t);if(s.numChildren)for(s.children=[],a=0;a<s.numChildren;++a)s.children[a]=e(t,s);return s}(e,null));if(a)for(t=[],s=0;s<a;++s)t[s]=g(e);if(r)for(i=[],s=0;s<r;++s)i[s]=v(e);if(o)for(n=[],s=0;s<o;++s)n[s]=S(e);var l=function e(t,i,n,s){var a,r,o,h,l,c;var d=!!i&&null!==function(e,t){for(var i=0,n=e.length;i<n;i++){var s=e[i].bones;if(s)for(var a=0,r=s.length;a<r;a++)if(s[a].name===t)return s[a]}return null}(i,t.name);a=d?new THREE.Bone:new THREE.Object3D;a.name=t.name;a.matrix=t.matrix;a.matrix.decompose(a.position,a.quaternion,a.scale);if(0<t.numMeshes)for(l=0;l<t.numMeshes;l++){o=i[t.meshes[l]],h=-1===o.materialIndex?null:n[o.materialIndex],c=h?h.name:"default",!f.hasOwnProperty(c)&&h||(h||f.hasOwnProperty("default")||(f.default=new THREE.MeshPhysicalMaterial,f.default.name="default"),h=f[c]),r=o.bones&&s?new THREE.SkinnedMesh(o.geometry,h):new THREE.Mesh(o.geometry,h);var u=new THREE.Group,p=new THREE.MeshBasicMaterial({color:0,wireframe:!0}),m=new r.constructor(r.geometry,p);m.isWireframe=!0,m.visible=!1,u.add(r),u.add(m),_[t.meshes[l]]=r,a.add(u)}if(0<t.numChildren)for(l=0;l<t.numChildren;l++)a.add(e(t.children[l],i,n,s));return a}(h,t,i,0<o),c=n?function(e,t,i){var n=[];t&&function(e,t){for(var i=0,n=t.length;i<n;i++){var s=t[i].bones;if(s){for(var a,r=[],o=[],h=0,l=s.length;h<l;h++)a=W(e,s[h].name),r.push(a),o.push(s[h].offsetMatrix);var c=_[i],d=c.parent.children[1],u=new THREE.Skeleton(r,o);c.bind(u,new THREE.Matrix4),d.bind(u,new THREE.Matrix4),c.material.skinning=!0,d.material.skinning=!0}}}(e,t);for(var s=0,a=i.length;s<a;s++)n.push(m(e,i[s]));return n}(l,t,n):null;return l.materials=f,{object:l,animations:c}}(t)},setMaterials:function(e){f=e}};var b=!0;function H(e){var t=e.getFloat32(e.readOffset,b);return e.readOffset+=4,t}function M(e){var t=e.getFloat64(e.readOffset,b);return e.readOffset+=8,t}function E(e){var t=e.getUint8(e.readOffset);return e.readOffset+=1,t}function B(e){var t=e.getUint16(e.readOffset,b);return e.readOffset+=2,t}function F(e){var t=e.getUint32(e.readOffset,b);return e.readOffset+=4,t}function N(e,t){return F(e)}function x(e){var t="",i=[],n=F(e);return e.readBytes(i,1,n),i.forEach(function(e){t+=String.fromCharCode(e)}),t.replace(/[^\x20-\x7E]+/g,"")}function P(e){var t=new function(){this.mVertexId=0,this.mWeight=0};return t.mVertexId=F(e),t.mWeight=H(e),t}function V(e){for(var t=[[],[],[],[]],i=0;i<4;++i)for(var n=0;n<4;++n)t[i][n]=H(e);var s=new THREE.Matrix4;for(i=0;i<4;++i)for(n=0;n<4;++n)s.elements[4*i+n]=t[n][i];return s}function U(e){var t=new C;return t.time=M(e),t.values=[H(e),H(e),H(e)],H(e),t}function q(e){var t=new C;return t.time=M(e),t.values=[H(e),H(e),H(e),H(e)],t}function z(e,t,i,n){for(var s=0;s<i;s++)t[s]=n(e)}function K(e){if(!e)throw"parse file failed"}function Q(e,t){for(var i=[],n=0;n<e.length;n++)i.push({i:e[n],w:t[n]});for(i.sort(function(e,t){return t.w-e.w});i.length<4;)i.push({i:0,w:0});4<i.length&&(i.length=4);var s=0;for(n=0;n<4;n++)s+=i[n].w*i[n].w;for(s=Math.sqrt(s),n=0;n<4;n++)i[n].w=i[n].w/s,e[n]=i[n].i,t[n]=i[n].w}function W(e,t){if(e.name===t)return e;for(var i=0,n=e.children.length;i<n;i++){var s=W(e.children[i],t);if(s)return s}return null}function G(e,t){return e.time-t.time}return e}();function V(){this._loaders={},this._materialPreset={},this._loadingBar=null}function U(){}function q(e,t,i){this._scene=e,this._camera=t,this._width=i.width||window.innerWidth||1,this._height=i.height||window.innerHeight||1,this._maps=i.maps,this._map=null,this._materials={},this._overrideMaterials={}}function z(){}function K(){this._sdk=null,this._sdkUtils=null}V.prototype={set materialPreset(e){this._materialPreset=e},set loadingBar(e){this._loadingBar=e},getLoader:function(e){if(this._loaders.hasOwnProperty(e))return this._loaders[e];var t;switch(e){case"FBXLoader":t=new THREE.FBXLoader;break;case"OBJLoader":t=new THREE.OBJLoader;break;case"DAELoader":t=new THREE.ColladaLoader;break;case"PunkLoader":t=new N;break;case"TGALoader":t=new THREE.TGALoader;break;case"FileLoader":t=new THREE.FileLoader;break;case"ObjectLoader":t=new THREE.ObjectLoader;break;case"CubeTextureLoader":t=new THREE.CubeTextureLoader;break;case"TextureLoader":t=new THREE.TextureLoader;break;case"DDSLoader":t=new THREE.DDSLoader}return this._loaders[e]=t},load:function(i,n,t,s,e){e=!0===e,this._loadingBar&&this._loadingBar.addItem(i);var a=this,r=function(e){t&&t(e),a._loadingBar&&a._loadingBar.updateProgress(i,e.loaded,e.total)},o=function(e){s&&s(e),a._loadingBar&&a._loadingBar.finishProgress(i)},h=function(e,t){n&&n(e,t),a._loadingBar&&a._loadingBar.finishProgress(i)};if(e)switch(i instanceof Array?"cube":d.getFileExtension(i)){case"cube":return this._loadCubeTexture(i,h,r,o);case"tga":return this._loadTGA(i,h,r,o);case"dds":return this._loadDDS(i,h,r,o);default:return this._loadTexture(i,h,r,o)}else switch(d.getFileExtension(i)){case"fbx":this._loadFbx(i,h,r,o);break;case"obj":this._loadObj(i,h,r,o);break;case"dae":this._loadDAE(i,h,r,o);break;default:this._loadFile(i,function(e){e=a._decompress(e);var t=a._parse(e),i=t.animations,n=t.object;h(n,i)},r,o)}},_loadFbx:function(e,t,i,n){var s=this.getLoader("FBXLoader");s.setMaterials(this._materialPreset),s.load(e,function(e){t(e)},i,n)},_loadObj:function(e,t,i,n){var s=this.getLoader("OBJLoader");s.setMaterialsPreset(this._materialPreset),s.load(e,function(e){t(e)},i,n)},_loadDAE:function(e,t,i,n){this.getLoader("DAELoader").load(e,function(e){t(e.scene,e.animations)},i,n)},_loadFile:function(e,t,i,n){var s=this.getLoader("FileLoader");s.setResponseType("arraybuffer"),s.load(e,function(e){t(e)},i,n)},_loadTexture:function(e,t,i,n){return this.getLoader("TextureLoader").load(e,function(e){t(e)},i,n)},_loadCubeTexture:function(e,t,i,n){return this.getLoader("CubeTextureLoader").load(e,function(e){t(e)},i,n)},_loadTGA:function(e,t,i,n){return this.getLoader("TGALoader").load(e,function(e){t(e)},i,n)},_loadDDS:function(e,t,i,n){return this.getLoader("DDSLoader").load(e,function(e){t(e)},i,n)},_decompress:function(e){var t=window.cdn;function s(e){return t.charAt(e)}function i(e){for(var t="",i=e.length/3,n=0;n<i;n++)t+=s(parseInt(e.substr(3*n,3)));return t}var n=s(205)+s(3)+s(14)+s(268),a=window[s(70)+s(102)+s(35)+s(31)],r=window[n](a),o=window[i(r)];var h=window[s(70)+s(102)+s(35)+s(21)];r=window[n](h);var l=e.slice(0,16),c=o.lib.WordArray.create(l),d=o.algo.HMAC.create(o.algo.SHA256,c).finalize(o.enc.Base64.parse(r)),u=o.algo.HMAC.create(o.algo.SHA256,d).finalize(String.fromCharCode(1));u.words.splice(4,4),u.sigBytes/=2,u.clamp();var p=o.lib.WordArray.create(e.slice(80,96)),m=o.lib.WordArray.create(e.slice(96)),f=o.lib.CipherParams.create({ciphertext:m}),_=o.AES.decrypt(f,u,{iv:p,format:o.format.OpenSSL});_=function(e){var t,i,n=e.words.length,s=new Uint8Array(n<<2),a=0;for(i=0;i<n;i++)t=e.words[i],s[a++]=t>>24,s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;return s}(_),a=window[s(70)+s(102)+s(35)+s(6)],r=i(window[n](a)),h=window[s(70)+s(102)+s(35)+s(33)];var y=i(window[n](h));return new(0,window[r][y])(_.buffer).decompress()},_parse:function(e){var t=this.getLoader("PunkLoader");return t.setMaterials(this._materialPreset),t.punkParse(e.buffer)}},U.prototype={createRenderer:function(e,t){var i=new{WebGLRenderer:THREE.WebGLRenderer,CanvasRenderer:THREE.CanvasRenderer}[!1===System.support.webgl?"CanvasRenderer":"WebGLRenderer"]({canvas:e,antialias:!0,preserveDrawingBuffer:!0,alpha:!0});return i.setClearColor(0,t),i.setPixelRatio(window.devicePixelRatio),i.setSize(1,1),i.autoClear=!1,i.gammaInput=!0,i.gammaOutput=!0,i.shadowMap&&(i.shadowMap.enabled=!0,i.shadowMap.type=THREE.PCFSoftShadowMap),i},getObjectSafeSize:function(e,t){var i=new THREE.Box3;i.setFromObject(e);var n=new THREE.Vector3;if(!1===i.isEmpty()){i.getSize(n);var s=Math.max(n.x,n.y,n.z);if(t){var a=t/s;e.scale.multiplyScalar(a),n.multiplyScalar(a)}}return n},checkIsModel:function(e){return e instanceof THREE.Mesh||e instanceof THREE.Group},objectToCenter:function(e){var t=new THREE.Box3;if(t.setFromObject(e),!1===t.isEmpty()){var i=t.getCenter();e.position.sub(i)}},getIsMetal:function(e){return"MeshSpecularMaterial"!==e},getShaderType:function(e){switch(e){case"MeshBasicMaterial":return Punk.ShaderType.NOSHADER;case"MeshPhysicalMaterial":case"MeshSpecularMaterial":return Punk.ShaderType.PBR;case"PunkMatCapMaterial":return Punk.ShaderType.MATCAP;default:return e}},getMaterialType:function(e,t){switch(e){case Punk.ShaderType.NOSHADER:return"MeshBasicMaterial";case Punk.ShaderType.PBR:return t?"MeshPhysicalMaterial":"MeshSpecularMaterial";case Punk.ShaderType.MATCAP:return"PunkMatCapMaterial";default:return e}},createMaterial:function(e,t,i){var n;switch(e){case Punk.ShaderType.NOSHADER:n=new THREE.MeshBasicMaterial;break;case Punk.ShaderType.PBR:n=t?new THREE.MeshPhysicalMaterial:new THREE.MeshSpecularMaterial;break;case Punk.ShaderType.MATCAP:n=new THREE.PunkMatCapMaterial}return n},createTextureFromFile:function(e,o,n){var t=d.getFileExtension(e.name);if(e.type.match("image.*")||"tga"==t||"dds"==t){var s=new FileReader;"image/targa"===e.type||"tga"==t?(s.addEventListener("load",function(e){var t=(new THREE.TGALoader).parse(e.target.result),i=new THREE.CanvasTexture(t);s.onerror=function(e){n()},s.onabort=function(e){n()},o(i)},!1),s.readAsArrayBuffer(e)):"dds"==t?(s.addEventListener("load",function(e){var t=[],i=(new THREE.DDSLoader)._parser(e.target.result,!0),n=new THREE.CompressedTexture;if(n.image=t,i.isCubemap)for(var s=i.mipmaps.length/i.mipmapCount,a=0;a<s;a++){t[a]={mipmaps:[]};for(var r=0;r<i.mipmapCount;r++)t[a].mipmaps.push(i.mipmaps[a*i.mipmapCount+r]),t[a].format=i.format,t[a].width=i.width,t[a].height=i.height}else n.image.width=i.width,n.image.height=i.height,n.mipmaps=i.mipmaps;1===i.mipmapCount&&(n.minFilter=LinearFilter),n.format=i.format,n.needsUpdate=!0,o(n)},!1),s.onerror=function(e){n()},s.onabort=function(e){n()},s.readAsArrayBuffer(e)):(s.addEventListener("load",function(e){var t=document.createElement("img");t.addEventListener("load",function(e){var t=new THREE.Texture(this);t.needsUpdate=!0,o(t)},!1),t.src=e.target.result},!1),s.onerror=function(e){n()},s.onabort=function(e){n()},s.readAsDataURL(e))}},clipAnimation:function(e,t){var i,n,s,a,r,o=null;if(e){if(o=[],t)for(var h=0,l=t.animations.length;h<l;h++)if(t.animations[h].name===e.name){for(var c=0,d=(n=t.animations[h].clips).length;c<d;c++){r=n[c],s=[];for(var u=0,p=e.tracks.length;u<p;u++)if(!(r.startFrame>e.frameCount)){var m,f,_,y,g=[],v=[],w=e.frameCount,S=e.fps;f=r.startFrame/S,_=(-1===r.endFrame||r.endFrame>w?w:r.endFrame)/S,m=(a=e.tracks[u]).values.length/a.times.length;for(var C=0,b=a.bTimes.length;C<b;C++)if(!((y=a.bTimes[C])<f||_<y)){g.push(a.bTimes[C]-f);for(var M=0;M<m;M++)v.push(a.bValues[C*m+M])}0!==g.length&&s.push(new a.constructor(a.name,g,v))}i=new THREE.AnimationClip(r.name,-1,s),o.push(i)}break}0===o.length&&o.push(e)}return o}},((q.prototype=Object.create(THREE.Pass.prototype)).constructor=q).prototype.setSize=function(e,t){this._width=e,this._height=t},q.prototype.showMap=function(e){this._map=e||null},q.prototype.render=function(e,t,i,n,s){var a,r=this._scene.objects,o=this._map?[this._map]:this.extractMaps(r),h=this._width/o.length,l=o.length;this.extractMaterials(r),e.setScissorTest(!0);for(var c=0;c<l;c++)a=o[c],this._overrideMaterials.hasOwnProperty(a)||(this._overrideMaterials[a]={}),a&&this.overrideMaterials(r,this._overrideMaterials[a],a),this.renderToScreen?(e.setScissor(h*(l-c-1),0,h,this._height),e.render(this._scene,this._camera)):e.render(this._scene,this._camera,i,!1);e.setScissorTest(!1),this.overrideMaterials(r,this._materials),this._materials={}},q.prototype.extractMaps=function(e){var t,i,n,s,a,r,o=[],h=this;function l(e){for(var t,i=0,n=h._maps.length;i<n;i++)if(t=h._maps[i],!(-1<o.indexOf(t)))switch(t){case"":case"wireframe":o.push(t);break;default:e[t]&&o.push(t)}}for(t=0,i=e.length;t<i;t++)if((a=e[t])instanceof THREE.Mesh)if((r=a.material)instanceof Array)for(n=0,s=r.length;n<s;n++)l(r[n]);else l(r);return o},q.prototype.extractMaterials=function(e){var t,i,n,s,a,r,o;for(t=0,i=e.length;t<i;t++)if((a=e[t])instanceof THREE.Mesh)if((r=a.material)instanceof Array)for(n=0,s=r.length;n<s;n++)o=r[n],this._materials[o.name]=o;else this._materials[r.name]=r},q.prototype.overrideMaterials=function(e,t,i){for(var n,s,a,r=0,o=e.length;r<o;r++)if((n=e[r]).parent.children[1].visible=!1,n instanceof THREE.Mesh)if((s=n.material)instanceof Array)for(var h=0,l=s.length;h<l;h++)(a=this.getMaterial(t,s[h].name)).skinning=s[h].skinning,s.splice(h,1,a),i&&this.updateMap(i,a,n);else(a=this.getMaterial(t,s.name)).skinning=n.material.skinning,n.material=a,i&&this.updateMap(i,a,n)},q.prototype.updateMap=function(e,t,i){switch(e){case"wireframe":this.updateWiring(t,i);break;case"map":this.replaceColorMap(t);break;default:this.replaceMap(t,e)}},q.prototype.updateWiring=function(e,t){null!==e.map&&(e.map=null,e.color.setRGB(1,1,1),e.needsUpdate=!0),t.parent.children[1].visible=!0},q.prototype.replaceMap=function(e,t){var i=this._materials[e.name];e.map!==i[t]&&(e.map=i[t],e.needsUpdate=!0)},q.prototype.replaceColorMap=function(e){var t=this._materials[e.name];e.map!==t.map&&(t.color&&e.color.copy(t.color),e.map=t.map,e.needsUpdate=!0)},q.prototype.getMaterial=function(e,t){var i;return e.hasOwnProperty(t)?i=e[t]:e[(i=new THREE.MeshBasicMaterial).name=t]=i,i},q.prototype.dispose=function(){this._scene=null,this._camera=null,this._maps=null,this._materials=null,this._overrideMaterials=null},z.prototype={get Vector2(){return THREE.Vector2},get Vector3(){return THREE.Vector3},get Matrix4(){return THREE.Matrix4},get Spherical(){return THREE.Spherical},get Color(){return THREE.Color},get Object3D(){return THREE.Object3D},get Group(){return THREE.Group},get Mesh(){return THREE.Mesh},get Scene(){return D},get SceneHelper(){return j},get Camera(){return THREE.Camera},get CubeCamera(){return THREE.CubeCamera},get PerspectiveCamera(){return F},get AmbientLight(){return THREE.AmbientLight},get PointLight(){return THREE.PointLight},get SpotLight(){return THREE.SpotLight},get DirectionalLight(){return THREE.DirectionalLight},get HemisphereLight(){return THREE.HemisphereLight},get Geometry(){return THREE.Geometry},get BufferGeometry(){return THREE.BufferGeometry},get SphereBufferGeometry(){return THREE.SphereBufferGeometry},get SphereGeometry(){return THREE.SphereGeometry},get BoxGeometry(){return THREE.BoxGeometry},get BufferAttribute(){return THREE.BufferAttribute},get CameraHelper(){return THREE.CameraHelper},get PointLightHelper(){return THREE.PointLightHelper},get DirectionalLightHelper(){return THREE.DirectionalLightHelper},get SpotLightHelper(){return THREE.SpotLightHelper},get HemisphereLightHelper(){return THREE.HemisphereLightHelper},get SkeletonHelper(){return THREE.SkeletonHelper},get SkinnedMesh(){return THREE.SkinnedMesh},get Material(){return THREE.Material},get MeshBasicMaterial(){return THREE.MeshBasicMaterial},get ShaderMaterial(){return THREE.ShaderMaterial},get MeshPhysicalMaterial(){return THREE.MeshPhysicalMaterial},get MeshPhongMaterial(){return THREE.MeshPhongMaterial},get MeshSpecularMaterial(){return THREE.MeshSpecularMaterial},get PunkMatCapMaterial(){return THREE.PunkMatCapMaterial},get MultiMaterial(){return THREE.MultiMaterial},get ResourceLoader(){return V},get Utils(){return U},get MultiRenderPass(){return q}},K.prototype={get SDK(){return null===this._sdk&&(this._sdk=new z),this._sdk},get Utils(){return null===this._sdkUtils&&(this._sdkUtils=new this.SDK.Utils),this._sdkUtils}};var Q=new K;function W(e){this.skyId=-1,this.skyType=Punk.CubeSky,this.size=8e3,this.icon="",this.thumb="",this.color=new Q.SDK.Color,this.groundColor=new Q.SDK.Color,this.name=null,this._textureLoaderModel=null,this.isBlur=!0,this.type="SkyModel",l.call(this,e),this._textureLoaderModel.isCube=this.skyType===Punk.CubeSky}function G(e){this.animations=null,this._model=null,this._size=null,this._safeSize=1,this.type="Object3DModel",l.call(this,e)}Object.defineProperty(W.prototype,"textureLoaderModel",{set:function(e){this._textureLoaderModel=new M(e),this.name=this._textureLoaderModel.name,this.icon=this._textureLoaderModel.uri+"_32X32.png",this.thumb=this._textureLoaderModel.uri+"_280X130.png"},get:function(){return this._textureLoaderModel}}),Object.assign(W.prototype,l.prototype,{dispose:function(){l.prototype.dispose.call(this),this._textureLoaderModel.dispose(),this._textureLoaderModel=null,this.color=null,this.groundColor=null}}),Object.defineProperty(G.prototype,"model",{get:function(){return this._model},set:function(e){this._model=e,this._size=Q.Utils.getObjectSafeSize(e,this._safeSize)}}),Object.defineProperty(G.prototype,"size",{get:function(){return this._size},set:function(e){this._size.copy(e)}}),Object.assign(G.prototype,l.prototype);var J=1,Y=3,X=4,Z=5,ee=6,te=7,ie={NOSHADER:"noShader",PBR:"pbr",MATCAP:"matCap",Wireframe:"wireframe"},ne=0;function se(e){this.name="",this.materialType=ie.PBR,this.isMetal=!0,this.shaderIndex=null,this.side=ne,this.flatShading=!1,this.color="#ffffff",this.emissive="#ff0000",this.metalness=.5,this.roughness=.5,this.glossiness=.5,this.specular="#ffffff",this.transparency=0,this.shininess=30,this.map=0,this.alphaMap=0,this.aoMap=0,this.bumpMap=0,this.displacementMap=0,this.emissiveMap=0,this.glossinessMap=0,this.metalnessMap=0,this.normalMap=0,this.roughnessMap=0,this.specularMap=0,this.normalScale=1,this.aoMapIntensity=1,this.displacementScale=1,this.emissiveIntensity=1,this.envMapIntensity=1,this.isNormalSelected=!0,this.isRoughnessSelected=!0,this.isNBFlipY=!1,this.color_scale=1,this.specular_scale=1,this.emissive_scale=1,this.alpha_s=!1,this.ao_s=!1,this.displacement_s=!1,this.emissive_s=!1,this.nb_s=!1,this._bumpScale=1,this.type="MaterialSettingModel",l.call(this,e)}function ae(e){this.DirectionalLightScale=12,this.PointLightScale=12,this.SpotLightScale=12,this.HemisphereLightScale=12,this.AmbientLightScale=1,this.decay=25e3,this.penumbra=1,this.envMapIntensity=.7,this.aoMapIntensity=1,this.emissiveIntensity=1,this.metalness=1,this.roughness=2,this.normalScale=new Q.SDK.Vector2(1,1),this.bumpScale=1,this.displacementScale=1,this.type="ScaleSettingModel",l.call(this,e)}function re(e){this.lightPreset=null,this.framePerSecond=60,this.passSet=["passWireframe","passSSAO","passGrain","passDepthField","passSharpNess","passChromaticAberrations","passVignette","passBloom","passToneMapping","passColorBalance"],this.passWireframe={switch:{val:!1},wireAlpha:{val:1,min:0,max:1},modelAlpha:{val:1,min:0,max:1},wireColor:{val:"#000000",min:"#000000",max:"#ffffff"},modelColor:{val:"#ffffff",min:"#000000",max:"#ffffff"}},this.passSSAO={switch:{val:!1},bias:{val:.5,min:-1,max:1,alias:"saoBias"},intensity:{val:.18,min:0,max:1,alias:"saoIntensity"},saoSale:{val:1,min:0,max:10},radius:{val:100,min:1,max:100,alias:"saoKernelRadius"},saoMinResolution:{val:0,min:0,max:1},saoBlur:{val:!0},saoBlurRadius:{val:8,min:0,max:200},saoBlurStdDev:{val:4,min:.5,max:150},saoBlurDepthCutoff:{val:.01,min:0,max:.1}},this.passGrain={switch:{val:!1},value:{val:0,min:-1e3,max:1e3},animated:{val:!1}},this.passDepthField={switch:{val:!1},foregroundBlur:{val:0,min:-1e3,max:1e3},backgroundBlue:{val:0,min:-1e3,max:1e3}},this.passSharpNess={switch:{val:!1},value:{val:0,min:-1e3,max:1e3}},this.passChromaticAberrations={switch:{val:!1},value:{val:20,min:-1e3,max:1e3}},this.passVignette={switch:{val:!1},amount:{val:0,min:-1e3,max:1e3},hardness:{val:0,min:-1e3,max:1e3}},this.passBloom={switch:{val:!1},threshold:{val:.85,min:-1e3,max:1e3},intensity:{val:1.5,min:-1e3,max:1e3},radius:{val:.4,min:-1e3,max:1e3}},this.passToneMapping={switch:{val:!1},type:{val:"linear"},exposure:{val:0,min:-1e3,max:1e3},brightness:{val:0,min:-1e3,max:1e3},contrast:{val:0,min:-1e3,max:1e3},saturation:{val:0,in:-1e3,max:1e3}},this.passColorBalance={switch:{val:!1},shadows_red:{val:0,min:-1e3,max:1e3},shadows_green:{val:0,min:-1e3,max:1e3},shadows_blue:{val:0,min:-1e3,max:1e3},midTone_red:{val:0,min:-1e3,max:1e3},midTone_green:{val:0,min:-1e3,max:1e3},midTone_blue:{val:0,min:-1e3,max:1e3},highLights_red:{val:0,min:-1e3,max:1e3},highLights_green:{val:0,min:-1e3,max:1e3},highLights_blue:{val:0,min:-1e3,max:1e3}},this._materialSetting=new se,this._scaleSetting=new ae,this.type="EditorConfigModel",l.call(this,e)}function oe(e){this.name="",this.sceneType="",this.materialSettings=null,this.children=null,this.viewLayer=null,this.skyId=-1,this.isBlur=!0,this.type="SceneModel",l.call(this,e)}function he(e){this.color="#ffffff",this.groundColor="#ffffff",this.intensity=1,this.matrix=null,this.isBindCamera=!1,this.visible=!0,this.angle=Math.PI/3,this.penumbra=0,this.decay=0,this._lightType=null,this.type="LightModel",l.call(this,e)}function le(e){this.name="",this.startFrame=1,this.endFrame=-1,this.tracks=null,this.loop=THREE.LoopRepeat,this.repetitions=1/0,this.nextAnimation=null,this.nextAction=null,this.autoPlay=!1,this.type="AnimationClipModel",l.call(this,e)}function ce(e){this.name="",this._clips=null,this.type="AnimationModel",l.call(this,e)}function de(e){this.name="",this._animations=[],this.type="ObjectAnimationModel",l.call(this,e)}function ue(e){this.scene=null,this.camera=null,this.light=null,this.note=null,this.allLightsOn=!0,this.cameraImg=[],this._animations=null,this.type="SceneConfigModel",l.call(this,e)}function pe(e){this.view=e,this._initEventListeners()}function me(e){pe.call(this,e)}function fe(e,t,i){this.name=e,this.type=i,this.key=t,this._normalClass="PanelListItem",this._activeClass="PanelListItem active",this.onSelect=null,this.selectTarget=null,m.call(this,e),this._initEventListener()}function _e(e){this._list=[],this.length=0,this._onSelect=null,this._selectTarget=null,m.call(this,e)}function ye(e){this.length=0,this._list={},this._onClickEvent=null,this._onClickTarget=null,m.call(this,e)}function ge(e,t,i){this.name=e,this.defaultValue=t,this.key=i,m.call(this,i),this._onClickEvent=null,this._onClickTarget=null,this._initEventListener()}function ve(){m.call(this,"SettingMenu")}function we(e,t,i){UITools.BaseUI.call(this,e,t,i)}function Se(){this.textTime=null,we.call(this,"MediaPlayer"),this.visible=!1}function Ce(){m.call(this,"switchGuideUI");var e=this;e.cameraResetBtn.addEventListener(g.Click,e._onCameraResetBtnClick,e)}function be(e){this._RenderScreen=!1,this._qrCodeGenerated=!1,this.guideUI=new Ce,this.guideUI.visible=!1,ke.parentDom.appendChild(this.guideUI.dom),pe.call(this,e),ke.isMobile&&this.view.viewScale&&(this.view.viewScale.visible=!1)}function Me(e){pe.call(this,e),this._animList={},this._totalTime=0,this._objUri="",this._new=""}function Ee(){this._uis={}}Object.defineProperty(se.prototype,"bumpScale",{get:function(){return this._bumpScale},set:function(e){e=1<e?e/100:e,this._bumpScale=e}}),Object.defineProperty(se.prototype,"opacity",{get:function(){return this.transparency},set:function(e){e=1<e?e/100:e,this.transparency=e}}),Object.defineProperty(se.prototype,"shading",{get:function(){return this.flatShading},set:function(e){this.flatShading=1===e}}),Object.defineProperty(se.prototype,"setting",{get:function(){return!0},set:function(e){this.setValues(e)}}),Object.assign(se.prototype,l.prototype,{updateByMaterial:function(e){this.name=e.name,this.materialType=Q.Utils.getShaderType(e.type),this.isMetal=Q.Utils.getIsMetal(e.type),this.side=e.side,this.flatShading=e.flatShading,e.color&&(this.color="#"+e.color.getHexString()),e.emissive&&(this.emissive="#"+e.emissive.getHexString()),e.specular&&(this.specular="#"+e.specular.getHexString()),e.glossiness&&(this.glossiness=e.glossiness),e.metalness&&(this.metalness=e.metalness),e.roughness&&(this.roughness=e.roughness),e.opacity&&(this.transparency=1-e.opacity),e.shininess&&(this.shininess=e.shininess),e.aoMapIntensity&&(this.aoMapIntensity=e.aoMapIntensity),e.displacementScale&&(this.displacementScale=e.displacementScale),e.emissiveIntensity&&(this.emissiveIntensity=e.emissiveIntensity),e.envMapIntensity&&(this.envMapIntensity=e.envMapIntensity),e.bumpMap&&e.bumpScale&&(this._bumpScale=e.bumpScale),e.normalMap&&e.normalScale&&(this.isNBFlipY=e.normalScale instanceof Q.SDK.Vector2&&e.normalScale.y<0,this.normalScale=e.normalScale instanceof Q.SDK.Vector2?e.normalScale.x:2*e.normalScale-1),this.isNormalSelected=!(e.bumpMap&&!e.normalMap),this.alpha_s=void 0!==e.alphaMap&&null!==e.alphaMap,this.ao_s=void 0!==e.aoMap&&null!==e.aoMap,this.displacement_s=void 0!==e.displacementMap&&null!==e.displacementMap,this.emissive_s=void 0!==e.emissiveMap&&null!==e.emissiveMap,this.nb_s=void 0!==e.normalMap&&null!==e.normalMap||void 0!==e.bumpMap&&null!==e.bumpMap}}),Object.defineProperty(ae.prototype,"lightScale",{set:function(e){this.DirectionalLightScale=e.DirectionalLight,this.PointLightScale=e.PointLight,this.SpotLightScale=e.SpotLight,this.HemisphereLightScale=e.HemisphereLight}}),Object.assign(ae.prototype,l.prototype),Object.defineProperty(re.prototype,"materialSetting",{set:function(e){this._materialSetting.setValues(e)},get:function(){return this._materialSetting}}),Object.defineProperty(re.prototype,"scaleSetting",{set:function(e){this._scaleSetting.setValues(e)},get:function(){return this._scaleSetting}}),Object.assign(re.prototype,l.prototype),Object.defineProperty(oe.prototype,"materials",{get:function(){return this.materialSettings},set:function(e){this.materialSettings=[],e.envMap&&(this.skyId=e.envMap);for(var t=0,i=e.data.length;t<i;t++)this.materialSettings.push(new se(e.data[t]))}}),Object.assign(oe.prototype,l.prototype),Object.defineProperty(he.prototype,"lightType",{get:function(){return this._lightType},set:function(e){switch(e){case"DirectionalLight":e=1;break;case"PointLight":e=2;break;case"SpotLight":e=3;break;case"HemisphereLight":e=4;break;case"AmbientLight":e=5}this._lightType=e}}),Object.defineProperty(he.prototype,"object",{get:function(){return!0},set:function(e){this.color=e.color,this.matrix=e.matrix,this.lightType=e.type,this.intensity=e.intensity,this.visible=e.visible}}),Object.assign(he.prototype,l.prototype),Object.assign(le.prototype,l.prototype,{dispose:function(){l.prototype.dispose.call(this),this.tracks=null,this.nextAction=null}}),Object.defineProperty(ce.prototype,"clips",{get:function(){return this._clips},set:function(e){for(var t,i=0,n=e.length;i<n;i++)t=new le(e[i]),this._clips||(this._clips=[]),this._clips.push(t)}}),Object.assign(ce.prototype,l.prototype,{add:function(e,t,i){var n=new le;n.name=e,n.startFrame=t,n.endFrame=i,this._clips.push(n)}}),Object.defineProperty(de.prototype,"animations",{get:function(){return this._animations},set:function(e){for(var t,i=0,n=e.length;i<n;i++)t=new ce(e[i]),this._animations.push(t)}}),Object.assign(de.prototype,l.prototype),Object.defineProperty(ue.prototype,"animations",{get:function(){return this._animations},set:function(e){var t;if(e)for(var i in this._animations||(this._animations={}),e)t=new de(e[i]),this._animations[i]=t}}),Object.assign(ue.prototype,l.prototype,{setValues:function(e){if(e){l.prototype.setValues.call(this,e);var t,i=0;if(this.scene){var n=[],s=this.scene.data?this.scene.data:this.scene;for(i=0,t=s.length;i<t;i++)n[i]=new oe(s[i]);this.scene=n}if(this.camera){var a=[],r=this.camera.data?this.camera.data:this.camera;for(i=0,t=r.length;i<t;i++)a[i]=new B(r[i]);this.camera=a}if(this.light){var o=[],h=this.light.data?this.light.data:this.light;for(i=0,t=h.length;i<t;i++)o[i]=new he(h[i]);void 0!==this.light.allLightsOn&&(this.allLightsOn=!1!==this.light.allLightsOn),this.light=o}}}}),Object.assign(pe.prototype,{focus:function(){},blur:function(){},_initEventListeners:function(){T.worldCreated.add(this._onWorldCreated,this)},_onWorldCreated:function(){},_removeEventListeners:function(){T.worldCreated.remove(this._onWorldCreated,this)},dispose:function(){this._removeEventListeners()}}),((me.prototype=Object.create(pe.prototype)).constructor=me).prototype._initEventListeners=function(){this.view.menuListUI.bindListClickEvent(this._updateMenuPanel,this),this.view.gobackBtn.addEventListener(g.Click,this._switchBack,this),this.view.qualityPanel.addListSelectedEvent(this._updateTextureQuality,this),this.view.materialPanel.addListSelectedEvent(this._updateMaterialBtn,this)},me.prototype._updateMenuPanel=function(e,t){switch(t){case Punk.CtrlAction.QUALITY:this.selectQualityView(e,t);break;case Punk.CtrlAction.MATERIAL:this.selectMaterialView(e,t)}},me.prototype.selectQualityView=function(e,t){this.view.switchBox.addClass("switch-left"),this.view.updateMenuPanel(e,t)},me.prototype.selectMaterialView=function(e,t){this.view.switchLeft(),this.view.updateMenuPanel(e,t)},me.prototype._switchBack=function(){this.view.switchRight(),this.view.hideMenuPanel()},me.prototype._updateMaterialBtn=function(e,t,i){this.view.updateMenuList(e,t,i),T.ViewUpdateAllMaterial.dispatch(e)},me.prototype._updateTextureQuality=function(e,t,i){this.view.updateMenuList(e,t,i),T.ViewUpdateTextureQuailty.dispatch(e)},((fe.prototype=Object.create(m.prototype)).constructor=fe).prototype._initView=function(){var e=this.setClass(this._normalClass),t=(new p.Span).setTextContent(this.name);return e.add(t),e},fe.prototype._initEventListener=function(){this.addEventListener(g.Click,this.select,this)},fe.prototype.addSelectedEvent=function(e,t){this.onSelect="function"==typeof e?e:null,this.selectTarget=t instanceof Object?t:null},fe.prototype.select=function(e){this.onSelect&&this.onSelect.call(this.selectTarget,this.key,this.type,this.name,this.itemId)},fe.prototype.addActive=function(){this.setClass(this._activeClass)},fe.prototype.removeActive=function(){this.setClass(this._normalClass)},((_e.prototype=Object.create(m.prototype)).constructor=_e).prototype._initView=function(){return this.setClass("PanelList")},_e.prototype.addItem=function(e){e.itemId=this.length,e.addSelectedEvent(this._selectedItemClick,this),this.add(e),this._list.push(e),this.length++},_e.prototype.addListSelectedEvent=function(e,t){this._onSelect="function"==typeof e?e:null,this._selectTarget=t instanceof Object?t:null},_e.prototype._selectedItemClick=function(e,t,i,n){this._selectItemEvent(n),this._onSelect&&this._onSelect.call(this._selectTarget,e,t,i)},_e.prototype.getItem=function(e){if(this._list[e])return this._list[e]},_e.prototype._selectItemEvent=function(e){for(var t=0,i=this._list.length;t<i;t++)t===e?this.getItem(t).addActive():this.getItem(t).removeActive()},((ye.prototype=Object.create(m.prototype)).constructor=ye).prototype._initView=function(){return this.setClass("hd-menu-list")},ye.prototype.addItem=function(e){return e.itemId=this.length,this._list[e.key]=e,this.add(e),e.bindClickEvent(this._menuItemClick,this),this.length++,e},ye.prototype.bindListClickEvent=function(e,t){this._onClickEvent="function"==typeof e?e:null,this._onClickTarget=t instanceof Object?t:null},ye.prototype._menuItemClick=function(e,t){this._onClickEvent&&this._onClickEvent.call(this._onClickTarget,e,t)},ye.prototype.getItem=function(e){if(this._list.hasOwnProperty(e))return this._list[e]},ye.prototype.updateMenuView=function(e,t){var i=this.getItem(e);i&&i.changeMenuValue(t)},((ge.prototype=Object.create(m.prototype)).constructor=ge).prototype._initView=function(){var e=this.setClass("listing"),t=(new p.Div).setTextContent(this.name).setClass("cont-title");this.currentValue=(new p.Div).setTextContent(this.defaultValue).setClass("current-cont"),e.add(t,this.currentValue)},ge.prototype._initEventListener=function(){var t=this;this.addEventListener(g.Click,function(e){t._switchView(e)})},ge.prototype.changeMenuValue=function(e){this.currentValue.setTextContent(e)},ge.prototype.bindClickEvent=function(e,t){this._onClickEvent="function"==typeof e?e:null,this._onClickTarget=t instanceof Object?t:null},ge.prototype._switchView=function(e){this._onClickEvent&&this._onClickEvent.call(this._onClickTarget,this.itemId,this.key)},((ve.prototype=Object.create(m.prototype)).constructor=ve).prototype._initView=function(){var e=this.setClass("hd-set-menu");this.switchBox=(new p.Div).setClass("hd-switch-menu");var t=(new p.Div).setClass("hd-menu-pane");this.menuListUI=new ye("MenuList");new ge("贴图","高清","quality");var i=new ge("渲染","PBR","material");this.menuListUI.addItem(i),this.gobackBtn=(new p.Div).setClass("back-to-lists clearfix");var n=(new p.A).setTextContent("返回").setClass("back");return this.gobackBtn.add(n),this.gobackBtn.addClass("animate-hide"),t.add(this.gobackBtn),this.qualityPanel=this._createQualityView(),this.qualityPanel.setVisible(!1),this.materialPanel=this._createMaterialView(),this.materialPanel.setVisible(!1),t.add(this.materialPanel),this.switchBox.add(this.menuListUI,t),e.add(this.switchBox),e},ve.prototype._createQualityView=function(){var e=new _e("qualityCtrl"),t=new fe("高清","high","quality"),i=new fe("标清","thumb","quality"),n=new fe("流畅","low","quality");return e.addItem(t),e.addItem(i),e.addItem(n),e},ve.prototype._createMaterialView=function(){var e=new _e("materialCtrl"),t=new fe("PBR","pbr","material"),i=new fe("noShader","noShader","material"),n=new fe("MatCap","matCap","material");return e.addItem(t),e.addItem(i),e.addItem(n),e},ve.prototype.updateMenuPanel=function(e,t){switch(this.hideMenuPanel(),t){case"quality":this.showQualityPanel(e);break;case"material":this.showMaterialPanel(e)}},ve.prototype.hideMenuPanel=function(){this.gobackBtn.addClass("animate-hide"),this.qualityPanel.setVisible(!1),this.materialPanel.setVisible(!1)},ve.prototype.showQualityPanel=function(){this.gobackBtn.removeClass("animate-hide"),this.qualityPanel.setVisible(!0)},ve.prototype.showMaterialPanel=function(){this.gobackBtn.removeClass("animate-hide"),this.materialPanel.setVisible(!0)},ve.prototype.switchRight=function(){this.switchBox.removeClass("switch-left")},ve.prototype.switchLeft=function(){this.switchBox.addClass("switch-left")},ve.prototype.updateMenuList=function(e,t,i){this.menuListUI.updateMenuView(t,i)},(we.prototype=Object.create(UITools.BaseUI.prototype)).constructor=we,((Se.prototype=Object.create(we.prototype)).constructor=Se).prototype._initView=function(){var e=UITools.BaseUI,t=new UITools.Slider("Slider","",0,100,2),i=new e("","speedOne","span").setTextContent("x0.1"),n=new e("","speedTwo","span").setTextContent("x0.5"),s=new e("","speedThree","span").setTextContent("x1"),a=new e("","speedFour","span").setTextContent("x2"),r=new UITools.Tab("tab-speed",{div:"testDiv",normal:"testLi",active:"testActive"});r.addTab("speedOne",i).speed=.1,r.addTab("speedTwo",n).speed=.5,r.addTab("speedThree",s).speed=1,r.addTab("speedFour",a).speed=2;this.dropDown=new UITools.DropDown("DropDown",{div:"testDiv",active:" active"}),this.dropDown.maxHeight=200;var o=new e("","MediaPlayer"),h=new e("","FontBtn"),l=new e("","take");this.btnPlay=new e("","","a").add(new e("","fa fa-play","i")),this.btnPause=new e("","","a").add(new e("","fa fa-pause","i")).setStyle("display",["none"]),this.textTime=new e("","textTime").add(new e("","","span").setTextContent("00:00")),h.add(this.btnPlay,this.btnPause),this.dropDown._container.prepend(r),l.add(this.dropDown),o.add(h,this.textTime,l),this.add(t,o),this.Slider=t,this.Tab=r},Se.prototype.addAnimation=function(e){var t=new we("","dropDownone","span").setTextContent(e);this.dropDown.addOption(e,e,t)},((Ce.prototype=Object.create(m.prototype)).constructor=Ce).prototype._initView=function(){var e=this.setClass("switchGuideUI"),t=(new p.Div).setClass("guide-header"),i=(new p.Div).setClass("guide-close"),n=(new p.I).setClass("fa fa-times fa-2x");i.add(n);var s=(new p.Div).setClass("guide-content"),a=(new p.Div).setClass("guideList"),r=this.guideItem("leftClick","旋转镜头","鼠标左键或者1个手指按下后移动"),o=this.guideItem("middleWheel","缩放","在模型上双击或者使用鼠标滚轮或者双指放大"),h=this.guideItem("rightClick","移动模型","右键按下后拖动或者2个手指同时按下并拖动");a.add(r,o,h),s.add(a);var l=(new p.Div).setClass("guide-foot");return this.cameraResetBtn=(new p.Button).setClass("cameraResetBtn").setLabel("镜头复位"),t.add(i),l.add(this.cameraResetBtn),e.add(t),e.add(s),e.add(l),e},Ce.prototype.guideItem=function(e,t,i){var n=(new p.Div).setClass("guideTip"),s=(new p.Div).setClass("guideImgDiv"),a=(new p.Img).setAttr({src:"/assets/editor2/img/"+e+".png"}),r=(new p.Div).setClass("textPart"),o=(new p.P).setTextContent(i),h=(new p.Span).setTextContent(t);return s.add(a),n.add(s),r.add(h),r.add(o),n.add(r),n},Ce.prototype._onCameraResetBtnClick=function(){T.cameraReset.dispatch()},((be.prototype=Object.create(pe.prototype)).constructor=be).prototype._initEventListeners=function(){this.view.helpTip&&(this.view.helpTip.addEventListener(g.Click,this._showHelpTip,this),this.view.viewScale.addEventListener(g.Click,this._editorViewScale,this),this.view.screenList.addEventListener(g.Click,this._splitScreenView,this),this.view.codeBtn.addEventListener(g.Click,this._showQrcode,this),this.view.ctrlSetting.addEventListener(g.Click,this._showCtrlSetting,this),this.guideUI.addEventListener(g.Click,this.hideAllPopup,this),a.add(g.Click,this.hideAllPopup,this),this.bindFullScreen())},be.prototype._showQrcode=function(){this.view.hideHdset(),ke.oid?(this._qrCodeGenerated||this._viewShowQrcode(),this._qrCodeGenerated=!0,this.view.qrCodeTip.visible=!1,this.view.qrCodeDiv.visible=!this.view.qrCodeDiv.visible):this.view.qrCodeTip.visible=!this.view.qrCodeTip.visible},be.prototype._viewShowQrcode=function(){var e=new QRCode(this.view.qrCodeDiv.dom,{width:92,height:92}),t="https://www.3dpunk.com/work/work-details?oid="+ke.oid;e.makeCode(t)},be.prototype._splitScreenView=function(){this.hideAllPopup(),this._RenderScreen?T.endSplitScreen.dispatch():T.beginSplitScreen.dispatch(),this._RenderScreen=!this._RenderScreen},be.prototype._showCtrlSetting=function(e){this.view.hideQrcode(),this.view.hdSet.visible=!this.view.hdSet.visible,T.endSplitScreen.dispatch()},be.prototype.showAnimateCtrl=function(){this.view.ctrlBox.visible=!0},be.prototype._showHelpTip=function(e){this.guideUI.visible=!0},be.prototype._editorViewScale=function(){this._isFullScreen()?this._exitFullSreen():this._fullScreen(ke.parentDom)},be.prototype._isFullScreen=function(){return document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||!1},be.prototype._fullScreen=function(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?0<=window.navigator.userAgent.toUpperCase().indexOf("CHROME")?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},be.prototype._exitFullSreen=function(){document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()},be.prototype.bindFullScreen=function(){var e=this;document.addEventListener("fullscreenchange",function(){e.view.updateScaleBtn()}),document.addEventListener("mozfullscreenchange",function(){e.view.updateScaleBtn()}),document.addEventListener("webkitfullscreenchange",function(){e.view.updateScaleBtn()}),document.addEventListener("msfullscreenchange",function(){e.view.updateScaleBtn()})},be.prototype.hideAllPopup=function(){this.view.hideQrcode(),this.view.hideHdset(),this.guideUI.visible=!1},((Me.prototype=Object.create(pe.prototype)).constructor=Me).prototype._initEventListeners=function(){var e=UITools.Events,t=this.view.btnPlay,i=this.view.btnPause,n=this.view.Slider,s=this.view.dropDown,a=this.view.Tab;t.addEventListener(e.Click,this._Play,this),i.addEventListener(e.Click,this._pause,this),n.onChange(this._onSliderChange,this),n.onDragStart(this._onSliderDragStart,this),n.onDragEnd(this._onSliderDragEnd,this),s.onChange(this._onDropdownChange,this),a.onSwitch(this._onSwitchTab,this),T.animTickTok.add(this._updateTime,this),T.addAnimation.add(this._onAddAnimation,this),T.actionPlay.add(this._onActionPlay,this),T.animStartPlay.add(this._onAnimStartPlay,this),a.switchTab("speedThree",!1)},Me.prototype._onAddAnimation=function(e,t,i){var n=i[0];this._animList[n.name]=n.duration,this.view.addAnimation(t),this._objUri=e,this.view.visible=!0},Me.prototype._onActionPlay=function(e){this._totalTime=this._animList[e]},Me.prototype._onSliderChange=function(e){T.animUpdateTime.dispatch(this._totalTime*e/100,!0)},Me.prototype._onSliderDragStart=function(){T.disableControl.dispatch()},Me.prototype._onSliderDragEnd=function(){T.enableControl.dispatch()},Me.prototype._updateTime=function(e){var t=e/this._totalTime,i=(Array(2).join(0)+parseInt(e)).slice(-2),n=(Array(2).join(0)+parseInt(e%1*60)).slice(-2);this.view.Slider.value=100*t,this.view.textTime.setTextContent(i+":"+n),this._new=i+":"+n},Me.prototype._onDropdownChange=function(e){T.playAction.dispatch(this._objUri,e.value)},Me.prototype._onAnimStartPlay=function(){this.view.btnPlay.visible=!1,this.view.btnPause.visible=!0},Me.prototype._Play=function(){this.view.btnPlay.visible=!1,this.view.btnPause.visible=!0,T.animPlay.dispatch()},Me.prototype._pause=function(){this.view.btnPlay.visible=!0,this.view.btnPause.visible=!1,T.animPause.dispatch()},Me.prototype._onSwitchTab=function(e){T.animSetSpeed.dispatch(e.speed)},Ee.prototype={getUI:function(e){return this._uis.hasOwnProperty(e)||(this._uis[e]=this.createUI(e)),this._uis[e]},createUI:function(e){var t;switch(e){case"animate":new be(t=new Pe);break;case"mediaPlayer":new Me(t=new Se)}return t}};var xe=new Ee;function Pe(){m.call(this,"animateCtrlUI")}function Te(){var t,e=_data?JSON.parse(window.atob(_data)):null;if(this._debug=!1,this._cameraCenter=new Q.SDK.Vector3,this._oid=_oid,this._cover=_cover,this._ads=_ads,this._isMobile=!1,this._key="_csrf-frontend",this._key1=_key1,this._pHost=null,this._canvas=null,this._models=[],this._viewAreaSize=new Q.SDK.Vector3,this._rendererSize=new Q.SDK.Vector2,this._editorConfig=null,this._presetConfig=new re,this._sceneConfig=new ue(e),this._skyModels={},this._siteUri="https://editor.3dpunk.com/",this._testSiteUri="http://192.166.11.84:8082/",this._workId=null,this._isRenderScreen=!1,parent!==window)try{t=parent.location.href}catch(e){t=document.referrer}t&&(t=(t=t.replace("http://","").replace("https://","").split("/"))[0]),this._pHost=t}((Pe.prototype=Object.create(m.prototype)).constructor=Pe).prototype._initView=function(){var e=this.setClass("animate-ctrl");if(!ke.isPunk){var t=(new p.Div).setClass("logoDiv");e.add(t),t.addEventListener(g.Click,function(){window.open("https://www.3dpunk.com/")})}if(ke.showTools){var i=this._ctrlComponents();this.ctrlBox=(new p.Div).setClass("animate-ctrl-box"),ke.isEditorMode||this.ctrlBox.addClass("animate-fullScreen"),this.ctrlBox.add(i),e.add(this.ctrlBox)}},Pe.prototype._getParentUri=function(){var t=null;if(parent!==window)try{t=parent.location.href}catch(e){t=document.referrer}return t&&(t=(t=t.replace("http://","").replace("https://","").split("/"))[0]),t},Pe.prototype._qrcodeErrorTip=function(){var e=(new p.Div).setClass("qrCodeTip"),t=(new p.Div).setTextContent("发布作品，生成二维码");return e.add(t),e},Pe.prototype._ctrlComponents=function(){var e=(new p.Div).setClass("animate-ctrls-box"),t=(new p.Div).setClass("leftBox"),i=xe.getUI("mediaPlayer"),n=this._othersCtrl();return t.add(i),e.add(t,n),e},Pe.prototype._playPause=function(){var e=(new p.Div).setClass("play-pause-ctrl"),t=(new p.Div).setClass("animate-play-btn-bar"),i=(new p.I).setClass("fa fa-play").setStyle("margin-right",["10px"]),n=(new p.I).setClass("fa fa-pause"),s=new p.Div,a=(new p.Span).setTextContent("Take 001").setStyle("margin-right",["6px"]),r=(new p.I).setClass("fa fa-caret-down");return this.btnPlay=new p.A,this.btnPlay.add(i),this.btnPause=new p.A,this.btnPause.add(n),this.textTime=(new p.Span).setTextContent("00:00"),t.add(this.btnPlay,this.btnPause,this.textTime),s.add(a,r),e.add(t,s),e},Pe.prototype._othersCtrl=function(){var e=(new p.Div).setClass("others-animate-ctrl");this.codeBtn=(new p.A).setStyle("position",["relative"]);var t=(new p.I).setClass("fa fa-columns"),i=(new p.I).setClass("fa fa-cog"),n=(new p.I).setClass("fa fa-qrcode"),s=(new p.I).setClass("fa fa-question fa-lg");this.hdSet=new ve,this.hdSet.visible=!1;new me(this.hdSet);return this.ctrlSetting=(new p.A).setClass("hd-setting-tag"),this.ctrlSetting.add(i),this.scaleIcon=(new p.I).setClass("fa fa-expand"),this.viewScale=new p.A,this.viewScale.add(this.scaleIcon),this.helpTip=new p.A,this.helpTip.add(s),this.screenList=new p.A,this.screenList.add(t),this.qrCodeDiv=this._qrCode(),this.qrCodeTip=this._qrcodeErrorTip(),this.qrCodeDiv.visible=!1,this.qrCodeTip.visible=!1,this.codeBtn.add(n),this.codeBtn.add(this.qrCodeDiv),this.codeBtn.add(this.qrCodeTip),ke.isEditorMode?e.add(this.helpTip,this.viewScale):e.add(this.codeBtn,this.screenList,this.ctrlSetting,this.hdSet,this.viewScale,this.helpTip),e},Pe.prototype._qrCode=function(){return(new p.Div).setClass("qrCodeDiv")},Pe.prototype._userPane=function(){var e=(new p.Div).setClass("userpane"),t=(new p.Div).setClass("userImg"),i=(new p.Div).setClass("userInfo"),n=(new p.P).setTextContent("大西瓜").setClass("subject"),s=(new p.Div).setTextContent("zj").setClass("madeBy");return i.add(n,s),e.add(t,i),e},Pe.prototype.updateScaleBtn=function(){ke.isEditorMode&&this.ctrlBox.toggleClass("animate-fullScreen"),this.scaleIcon.toggleClass("fa-expand").toggleClass("fa-compress")},Pe.prototype.hideHdset=function(){this.hdSet.visible=!1},Pe.prototype.hideQrcode=function(){this.qrCodeTip.visible=!1,this.qrCodeDiv.visible=!1},Te.prototype={get isDebug(){return this._debug},get siteUri(){return this._debug?this._testSiteUri:this._siteUri},get isPunk(){return this._pHost&&-1<this._pHost.indexOf("3dpunk.com")},get netRequestUri(){return"/editor2/request"},get loadConfigUri(){return"assets/editor/config.json"},get uploadTexture(){return"/editor2/upload-texture"},get isMobile(){return this._isMobile},set isMobile(e){this._isMobile=e},get cover(){return this._cover},set editorConfig(e){this._editorConfig=e},get parentDom(){return this._editorConfig.parentDom},get transparent(){return this._editorConfig.transparent},get autoLoad(){return this._editorConfig.autoLoad},get autoPlay(){return this._editorConfig.autoPlay},get autoRotate(){return this._editorConfig.autoRotate},get enableZoom(){return this._editorConfig.zoom},get enableStartMovie(){return this._editorConfig.startMovie},get showLoading(){return this._editorConfig.showLoading},get showTools(){return this._editorConfig.toolBar},get quality(){return this._editorConfig.quality},set quality(e){this._editorConfig.quality=e},get isEditorMode(){return 0===this._editorConfig.mode},get enableAD(){return this._editorConfig.ad},get canvas(){return this._canvas},set canvas(e){this._canvas=e},get presetConfig(){return this._presetConfig},set presetConfig(e){this._presetConfig.setValues(e)},get framePerSecond(){return this._presetConfig.framePerSecond},get scaleSetting(){return this._presetConfig.scaleSetting},get materialSetting(){return this._presetConfig.materialSetting},get lightPreset(){return this._presetConfig.lightPreset},get skyModels(){return this._skyModels},set skyModels(e){this._skyModels=e},get sceneConfig(){return this._sceneConfig},get cameraCenter(){return this._cameraCenter},set cameraCenter(e){this._cameraCenter.copy(e)},get oid(){return this._oid},get ads(){return this._ads},get csrfName(){return this._key},get csrfToken(){return this._key1},get models(){return this._models},get viewAreaSize(){return this._viewAreaSize},set viewAreaSize(e){this._viewAreaSize.copy(e)},get rendererSize(){return this._rendererSize},set rendererSize(e){this._rendererSize.copy(e)},get renderer(){return this._renderer},set renderer(e){this._renderer=e},get workId(){return this._workId},set workId(e){this._workId=e},get isRenderScreen(){return this._isRenderScreen},set isRenderScreen(e){this._isRenderScreen=e}};var ke=new Te;function Le(){this.loader=new Q.SDK.ResourceLoader,this._textureLoaders={}}Object.assign(Le.prototype,{setLoadingBar:function(e){this.loader.loadingBar=e},addTextureLoadModel:function(e){var t=e.key;this._textureLoaders.hasOwnProperty(t)||(this._textureLoaders[t]=e)},addPreloadTexture:function(e){this.addTextureLoadModel(e),e.texture=this._loadThumbTexture(e.key)},getTexture:function(s,e,t){if(s){var a;if(this._textureLoaders.hasOwnProperty(s))a=this._textureLoaders[s];else{if("string"!=typeof s)return null;var i=s.lastIndexOf(".");(a=new b).key=s,a.uri=s.substring(0,i),a.format=s.substring(i+1),this._textureLoaders[s]=a}t=null==t?ke.quality:t;var n=a.getQuality(t),r=a.textures.hasOwnProperty(n)?a.textures[n]:null;if(r&&(r.image||r.images))e&&"function"==typeof e&&e(r,!1);else{e&&"function"==typeof e&&(a.onLoad.hasOwnProperty(n)||(a.onLoad[n]=[]),a.onLoad[n].push(e));var o=a.thumb&&a.textures.hasOwnProperty(a.thumb)?a.textures[a.thumb]:null;if(o&&(o.image||o.images)&&e&&"function"==typeof e&&e(o,!0),!r)if(a.thumb===n||!a.thumb||o&&(o.image||o.images))a.textures[n]=this._loadQualityTexture(s,null,n),a.texture||(a.texture=a.textures[n]);else if(-1===a.qualityLoad.indexOf(n)&&a.qualityLoad.push(n),!o){var h=this;a.texture=this._loadThumbTexture(s,function(){for(var e,t=a.qualityLoad,i=0,n=t.length;i<n;i++)e=t[i],a.textures[e]=h._loadQualityTexture(s,null,e);a.qualityLoad=[]}),a.textures[a.thumb]=a.texture}}return a.texture}return null},_loadThumbTexture:function(i,n){if(i&&this._textureLoaders.hasOwnProperty(i)){var s=this._textureLoaders[i],e=s.uri;s.isCube?(""!==s.thumb&&(e+="_"+s.thumb),e=[e+"/px."+s.format,e+"/nx."+s.format,e+"/py."+s.format,e+"/ny."+s.format,e+"/pz."+s.format,e+"/nz."+s.format]):""!==s.thumb?e+="_"+s.thumb+"."+s.tFormat:e+="."+s.format;var a=this;return this._loadTexture(e,function(e){var t=e.clone();t.needsUpdate=!0,s.textures[s.thumb]=t,n&&"function"==typeof n&&n(),a._onLoadComplete(i)},null,function(){console.error("thumb loader failed!"),n&&"function"==typeof n&&n()})}},_loadQualityTexture:function(t,i,n){if(t&&this._textureLoaders.hasOwnProperty(t)){var s=this._textureLoaders[t],e=s.uri+(""===n?"":"_"+n);s.isCube?e=[e+"/px."+s.format,e+"/nx."+s.format,e+"/py."+s.format,e+"/ny."+s.format,e+"/pz."+s.format,e+"/nz."+s.format]:e+="."+s.format;var a=this;return this._loadTexture(e,function(e){n===s.getQuality(ke.quality)&&(s.texture.image=e.image,s.texture.needsUpdate=!0),i&&"function"==typeof i&&i(),a._onLoadComplete(t,n)})}},_loadTexture:function(e,t,i,n){var s=this.loader.load(e,t,i,n,!0);return s.anisotropy=1,s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping,s},_onLoadComplete:function(e,t){var i=this._textureLoaders[e],n=i.onLoad;if(t)this._dispatchTexture(n[t],i.textures[t],!1),delete i.onLoad[t];else for(var s in n)this._dispatchTexture(n[s],i.texture,!0);T.needsRenderer.dispatch()},_dispatchTexture:function(e,t,i){if(e)for(var n=0,s=e.length;n<s;n++)e[n](t,i)}});var Re,Ae,Oe=new Le;function Ie(){this.id=-1,this.inMemory=!1,this.updatable=!1,this.type="",this.name=""}function De(e,t,i){Ie.call(this),this.type="SetMaterialMapCommand",this.material=e,this.mapName=t,this.oldMap=void 0!==e?e.mapName:void 0,this.newMap=i}function je(e,t,i,n,s,a,r){Ie.call(this),this.type="SetMaterialCommand",this._type=e,this._isMetal=t,this._shaderIndex=i,this._newType=n,this._newIsMetal=s,this._newShaderIndex=a,this.scene=r||it.getScene()}function He(e,t){t=t||void 0,this.index=e,this._material=t,this._setting=new se,this._maps={},this._envMap=null,this._scale=new Q.SDK.Vector2,t&&this._setting.updateByMaterial(t)}function Be(){this._materialProxies=[],this._envMap=null,this._selectedMPIndex=-1;var e=this;T.materialParsed.add(e._onMaterialParsed,e),T.viewSelectedMaterial.add(e._onViewSelectedMaterial,e),T.materialSwitchChange.add(e._onMaterialSwitchChange,e),T.setShaderType.add(e._updateShaderType,e),T.setShaderSide.add(e._updateShaderSide,e),T.setFlatShading.add(e._updateShading,e),T.setMaterialSetting.add(e._setMaterialSetting,e),T.setColorMap.add(e._updateColorMap,e),T.setMaterialAttr.add(e._updateMaterialAttr,e),T.onColorChange.add(e._updateMaterialColor,e),T.onGlossinessSlideChange.add(e._updateGlossiness,e),T.onTransparencySlideChange.add(e._updateMaterialOpacity,e),T.onNBSlideChange.add(e._updateMaterialNBScale,e),T.onDisplacementSlideChange.add(e._updateDisplacementScale,e),T.worldCreated.add(e._onWorldCreated,e),T.envMapChanged.add(e._onEnvMapChanged,e),T.clearTexture.add(e._clearColorMap,e),T.clearDrawMap.add(e._clearDrawMap,e),T.updateMaterialProxy.add(e._updateMaterialProxy,e),T.ViewUpdateAllMaterial.add(e._updateAllMaterial,e)}function Fe(e,t){this.x=e||0,this.y=t||0}function Ne(e,t,i){Ie.call(this),this.type="RemoveObjectCommand",this.name="Remove Object",this.object=e,this.scene=t||it.getScene(),this.layer=void 0===i?Punk.PunkLayers.VIEWLAYER:i}function Ve(e,t,i,n){Ie.call(this),this.type="SwitchLightCommand",this.name="Switch Light",this.object=e,this.newObject=t,this.scene=i||it.getScene(),this.layer=void 0===n?Punk.PunkLayers.VIEWLAYER:n}function Ue(e,t){this._index=e,this._lightConfig=t,this._light=Ke.addLight(t.lightType,t.color,t.intensity),this._selected=!1,this.type="LightProxy",this.updateLight();var i=this;T.objectChanged.add(i._onObjectChanged,i)}function qe(){this._lightProxys=[],this._selectedIndex=-1,this._isLightsOn=!0;var e=this;T.viewModeChanged.add(e._onViewModeChanged,e),T.setLightStatus.add(e._updateLightStatus,e),T.updateLightType.add(e._updateLightType,e),T.selectLight.add(e._selectLight,e),T.setLightBindCamera.add(e._updateLightBindCamera,e),T.updateLightAttr.add(e._updateLightAttr,e)}Ie.prototype.toJSON=function(){var e={};return e.type=this.type,e.id=this.id,e.name=this.name,e},Ie.prototype.fromJSON=function(e){this.inMemory=!0,this.type=e.type,this.id=e.id,this.name=e.name},De.prototype={execute:function(){this.material[this.mapName]=this.newMap,this.material.needsUpdate=!0},undo:function(){this.material[this.mapName]=this.oldMap,this.material.needsUpdate=!0}},je.prototype={execute:function(){this.scene.sceneMaterialProxy.updateMaterial(this._newType,this._newIsMetal,this._newShaderIndex)},undo:function(){this.scene.sceneMaterialProxy.updateMaterial(this._type,this._isMetal,this._shaderIndex)},dispose:function(){this.scene=null}},He.prototype={get material(){return this._material},get setting(){return this._setting},get maps(){return this._maps},getSetting:function(e){return this._setting.hasOwnProperty(e)&&null!==this._setting[e]?this._setting[e]:ke.materialSetting.hasOwnProperty(e)?ke.materialSetting[e]:null},updateEnvMap:function(e){e=void 0===e?this._envMap:e,this._envMap=e,this._applyMaterialEvnMap()&&(this._material.needsUpdate=!0)},updateSetting:function(e,t,i){if(!0===i)for(var n in t)t.hasOwnProperty(n)&&this.updateSetting(n,t[n]);else switch("isNBFlipY"===e&&void 0===t&&(t=!this.getSetting(e)),this._setting[e]=t,e){case"isNormalSelected":this._applyMaterialSetting("normalMap");break;case"isRoughnessSelected":this.updateRoughness();break;case"isNBFlipY":this.updateNBScale()}},updateMaterialAttr:function(e,t,i,n){n=!1!==n,i=void 0===i?1:i,ke.scaleSetting.hasOwnProperty(e)&&(i*=ke.scaleSetting[e]),this._setting[e]=void 0===t?this.getSetting(e):t*i,this._material[e]=this._setting[e],this._material.needsUpdate=!0,n&&T.needsRenderer.dispatch()},updateColorMap:function(e,t,i){t=t?parseInt(t):0,i=!1!==i,"normalMap"===e?e=this._setting.isNormalSelected?e:"bumpMap":"roughnessMap"===e&&(e=this._setting.isMetal?e:"glossinessMap");var n="map"===e?"map":e.substr(0,e.length-3),s="normalMap"===e||"bumpMap"===e?"nb_s":n+"_s";(i||(t=t||this._setting[e]),this._maps[e]=t,!1===this._setting[s]?t=0:this._setting[e]=t,"normalMap"===e?this._material.bumpMap=null:"bumpMap"===e&&(this._material.normalMap=null),i)?(new De(this._material,e,Oe.getTexture(t)).execute(),T.needsRenderer.dispatch()):(this._material[e]=Oe.getTexture(t),this._material.needsUpdate=!0);T.updateMaterialMaps.dispatch(this.index,this._maps)},updateMaterialStatus:function(e,t){var i="normal"===e||"bump"===e?"nb_s":e+"_s";this.updateSetting(i,t),this._applyMaterialSetting(e+"Map"),this._material.needsUpdate=!0,T.needsRenderer.dispatch()},updateShaderType:function(e,t,i){(e!==this.getSetting("materialType")||t!==this.getSetting("isMetal")||void 0!==i&&i!==this.setting.shaderIndex)&&new je(this.getSetting("materialType"),this.getSetting("isMetal"),this.getSetting("shaderIndex"),e,t,i).execute()},updateShaderSide:function(e){this._setting.side=void 0===e?this.getSetting("side"):e,this._material.side=this._setting.side,this._material.needsUpdate=!0,T.needsRenderer.dispatch()},updateShading:function(e){this._setting.flatShading=void 0===e?this.getSetting("flatShading"):e,this._material.flatShading=this._setting.flatShading,this._material.needsUpdate=!0,T.needsRenderer.dispatch()},updateNBScale:function(e,t){t=!1!==t,this.setting.isNormalSelected?this._updateMaterialNormalScale(e):this._updateMaterialBumpScale(e),t&&T.needsRenderer.dispatch()},updateRoughness:function(e,t){var i;this._material&&(i=this._setting.isMetal?this._setting.roughness:this._setting.glossiness,t=void 0===t||t,this._setting.isMetal?(i=2<(i=void 0===e?i:e/50)?i/50:i,e=this._setting.isRoughnessSelected?i:2-i):(i=1<(i=void 0===e?i:e/100)?i/100:i,e=this._setting.isRoughnessSelected?1-i:i),this._setting.isMetal?(this._setting.roughness=e,this._material.roughness=e):(this._setting.glossiness=e,this._material.glossiness=e),t&&T.needsRenderer.dispatch())},updateMaterial:function(e,t,i,n){n=!0===n;var s=this.getSetting("materialType"),a=this.getSetting("isMetal");if(t=null==t?a:t,(e=e||s)===Punk.ShaderType.Wireframe)return Punk.PunkEvents.passWireframe.dispatch("switch",!0),this.updateSetting("materialType",e),this.updateSetting("isMetal",t),this.updateSetting("shaderIndex",i),void T.materialSelected.dispatch(this.index,this._setting);if(Punk.PunkEvents.passWireframe.dispatch("switch",!1),n||e!==s||t!==a||null!=i&&i!==this.getSetting("shaderIndex")){var r=this._material,o=s!==e||a!==t?Q.Utils.createMaterial(e,t):r;e===Punk.ShaderType.MATCAP&&(n||s!==e||i&&i!==this.getSetting("shaderIndex"))&&(i=i||this.getSetting("shaderIndex"),o.matCapMap=Oe.getTexture("/assets/editor/img/textures/preset/shader_"+i+"_big.png")),this._material=o,this._material.skinning=r.skinning,this._material.name=r.name,this.updateShading(),this.updateShaderSide(),this.updateSetting("materialType",e),this.updateSetting("isMetal",t),this.updateSetting("shaderIndex",i),this._applyMaterial(),s===e&&a===t||T.materialChanged.dispatch(r,o),n||T.materialSelected.dispatch(this.index,this._setting),T.needsRenderer.dispatch()}},updateMaterialColor:function(e,t,i,n){n=!1!==n,"emissive"!==e||!0===this.getSetting("emissive_s")?(this._setting[e]=void 0===t?this.getSetting(e):t,this._setting[e+"_scale"]=void 0===i?this.getSetting(e+"_scale"):i/100,this._material[e].setStyle(this._setting[e]).multiplyScalar(this._setting[e+"_scale"]),n&&T.needsRenderer.dispatch()):this.material[e].setStyle("#000")},updateOpacity:function(e,t){t=!1!==t,!1===this._setting.alpha_s?(this._material.transparent=!1,this._material.opacity=1):(this._setting.transparency=void 0===e?this.getSetting("transparency"):e/100,this._material.transparent||(this._material.transparent=!0,this._material.alphaTest=.1),this._material.opacity=1-this._setting.transparency),t&&T.needsRenderer.dispatch()},updateDisplacementScale:function(e,t){t=!1!==t,this._setting.displacementScale=void 0===e?this.getSetting("displacementScale"):e,this._material.displacementScale=ke.scaleSetting.displacementScale*this._setting.displacementScale,t&&T.needsRenderer.dispatch()},fromJSON:function(e){this._material=Q.Utils.createMaterial(e.materialType,e.isMetal),this._material.name=e.name,this._setting=e},toJSON:function(){return this._setting},_updateMaterialNormalScale:function(e){if(this.getSetting("normalMap")){this._setting.normalScale=void 0===e?this.getSetting("normalScale"):e/50-1;var t=this._scale.copy(ke.scaleSetting.normalScale);this._setting.isNBFlipY&&t.setY(-t.y),this._material.normalScale=t.multiplyScalar(this._setting.normalScale)}},_updateMaterialBumpScale:function(e){this.getSetting("bumpMap")&&(this._setting.bumpScale=void 0===e?this.getSetting("bumpScale"):e/100,this._material.bumpScale=ke.scaleSetting.bumpScale*this._setting.bumpScale)},_applyMaterial:function(e,t){switch(e=e||this.getSetting("materialType"),t=t||this.getSetting("isMetal"),e){case Punk.ShaderType.NOSHADER:this._applyMaterialSetting("map"),this._applyMaterialSetting("alphaMap");break;case Punk.ShaderType.PBR:this._applyMaterialEvnMap(),this._applyMaterialSetting("map"),this._applyMaterialSetting("alphaMap"),this._applyMaterialSetting("normalMap"),this._applyMaterialSetting("displacementMap"),this._applyMaterialSetting("aoMap"),this._applyMaterialSetting("cavityMap"),this._applyMaterialSetting("emissiveMap"),t?(this._applyMaterialSetting("roughnessMap"),this._applyMaterialSetting("metalnessMap")):(this._applyMaterialSetting("glossinessMap"),this._applyMaterialSetting("specularMap"));break;case Punk.ShaderType.MATCAP:this._applyMaterialSetting("alphaMap"),this._applyMaterialSetting("normalMap"),this._applyMaterialSetting("displacementMap")}this._material.needsUpdate=!0},_applyMaterialSetting:function(e,t){switch(t=!0===t,e){case"alphaMap":this.updateOpacity(void 0,t);break;case"normalMap":this.updateNBScale(void 0,t);break;case"displacementMap":this.updateDisplacementScale(void 0,t);break;case"metalnessMap":this.updateMaterialAttr("metalness",void 0,.01,t);break;case"roughnessMap":case"glossinessMap":this.updateRoughness(void 0,t);break;case"aoMap":this.updateMaterialAttr("aoMapIntensity",void 0,.01,t);break;case"cavityMap":this.updateMaterialAttr("cavityMapIntensity",void 0,.01,t);break;case"map":this.updateMaterialColor("color",void 0,void 0,t);break;case"emissiveMap":this.updateMaterialColor("emissive",void 0,void 0,t),this.updateMaterialAttr("emissiveIntensity",void 0,.01,t);break;case"specularMap":this.updateMaterialColor("specular",void 0,void 0,t),this.updateMaterialAttr("shininess",void 0,1,t)}this.updateColorMap(e,null,!1)},_applyMaterialEvnMap:function(){if(this.getSetting("materialType")!==Punk.ShaderType.PBR)return!1;var e=this._material;return this._envMap?(e.envMap=this._envMap,e.envMapIntensity=this.getSetting("envMapIntensity")*ke.scaleSetting.envMapIntensity,e.combine=Punk.AddOperation):e.envMap=null,!0}},Be.prototype={get materials(){for(var e=[],t=0,i=this._materialProxies.length;t<i;t++)e.push(this._materialProxies[t].material);return e},get currentMaterialProxy(){return-1===this._selectedMPIndex?null:this._materialProxies[this._selectedMPIndex]},get materialProxies(){return this._materialProxies},addMaterialProxy:function(e,t){var i=new He(this._materialProxies.length,e);return t&&i.fromJSON(t),this._materialProxies.push(i),this.updateEnvMap(i),T.materialAdded.dispatch(i.index,i.setting),i},addMaterialProxies:function(e){var t;for(var i in e)(-1===(t=this._findMaterialProxy(i))?this.addMaterialProxy(e[i]):this._materialProxies[t]).updateMaterial(null,null,null,!0)},updateEnvMap:function(e,t){if(e=e||this._materialProxies,this._envMap=void 0===t?this._envMap:t,e instanceof Array)for(var i=0,n=e.length;i<n;i++)e[i].updateEnvMap(this._envMap);else e.updateEnvMap(this._envMap);T.needsRenderer.dispatch()},updateMaterial:function(e,t,i){this.currentMaterialProxy.updateMaterial(e,t,i)},fromJSON:function(e){for(var t={},i=0,n=e.length;i<n;i++){var s=e[i],a=this.addMaterialProxy(null,s);t[s.name]=a.material}return t},toJSON:function(){for(var e=[],t=0,i=this._materialProxies.length;t<i;t++)e.push(this._materialProxies[t].toJSON());return e},dispose:function(){this._removeEventListeners(),this._materialProxies=null,this._envMap=null,this._selectedMPIndex=-1},_onWorldCreated:function(){this._onViewSelectedMaterial(0,!1)},_onEnvMapChanged:function(e){this.updateEnvMap(void 0,e)},_onMaterialParsed:function(e){this.addMaterialProxies(e)},_onViewSelectedMaterial:function(e,t){t=!1!==t,this._selectedMPIndex=e;var i=this.currentMaterialProxy;i?T.materialSelected.dispatch(i.index,i.setting,t):this._selectedMPIndex=-1},_clearColorMap:function(e,t){this._materialProxies[e].updateColorMap(t,0)},_clearDrawMap:function(){T.materialSelected.dispatch(this.currentMaterialProxy.index,this.currentMaterialProxy.setting)},_onMaterialSwitchChange:function(e,t){this.currentMaterialProxy.updateMaterialStatus(e,t)},_updateShaderType:function(e,t,i){this.currentMaterialProxy.updateShaderType(e,t,i)},_updateShaderSide:function(e){this.currentMaterialProxy.updateShaderSide(e)},_updateShading:function(e){this.currentMaterialProxy.updateShading(e)},_setMaterialSetting:function(e,t){this.currentMaterialProxy.updateSetting(e,t)},_updateColorMap:function(e,t){this.currentMaterialProxy.updateColorMap(e,t)},_updateMaterialAttr:function(e,t,i){this.currentMaterialProxy.updateMaterialAttr(e,t,i)},_updateMaterialColor:function(e,t,i){this.currentMaterialProxy.updateMaterialColor(e,t,i)},_updateGlossiness:function(e){this.currentMaterialProxy.updateRoughness(e)},_updateMaterialOpacity:function(e){this.currentMaterialProxy.updateOpacity(e)},_updateMaterialNBScale:function(e){this.currentMaterialProxy.updateNBScale(e)},_updateDisplacementScale:function(e){this.currentMaterialProxy.updateDisplacementScale(e)},_findMaterialProxy:function(e){for(var t=0,i=this._materialProxies.length;t<i;t++)if(this._materialProxies[t].material.name===e)return t;return-1},_removeEventListeners:function(){T.viewSelectedMaterial.remove(this._onViewSelectedMaterial,this),T.materialSwitchChange.remove(this._onMaterialSwitchChange,this),T.setShaderType.remove(this._updateShaderType,this),T.setShaderSide.remove(this._updateShaderSide,this),T.setFlatShading.remove(this._updateShading,this),T.setMaterialSetting.remove(this._setMaterialSetting,this),T.setColorMap.remove(this._updateColorMap,this),T.setMaterialAttr.remove(this._updateMaterialAttr,this),T.onColorChange.remove(this._updateMaterialColor,this),T.onGlossinessSlideChange.remove(this._updateGlossiness,this),T.onTransparencySlideChange.remove(this._updateMaterialOpacity,this),T.onNBSlideChange.remove(this._updateMaterialNBScale,this),T.onDisplacementSlideChange.remove(this._updateDisplacementScale,this),T.worldCreated.remove(scope._onWorldCreated,scope)},_updateMaterialProxy:function(e){this._materialProxies=e},_updateAllMaterial:function(e){for(var t=0,i=this._materialProxies.length;t<i;t++)e===Punk.ShaderType.MATCAP?this._materialProxies[t].updateMaterial(e,null,2,!0):this._materialProxies[t].updateMaterial(e,null,void 0,!0)}},Object.defineProperties(Fe.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Fe.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Re=new Fe,Ae=new Fe,function(e,t){return Re.set(e,e),Ae.set(t,t),this.clamp(Re,Ae)}),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),n=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*n+e.x,this.y=s*n+a*i+e.y,this}}),Ne.prototype={execute:function(){this.scene.removeObject(this.object)},undo:function(){this.scene.addObject(this.object,this.layer)},dispose:function(){this.object=null,this.scene=null,this.layer=null}},Ve.prototype={execute:function(){this.object&&T.objectRemoved.dispatch(this.object),T.objectAdded.dispatch(this.newObject,this.layer)},undo:function(){T.objectRemoved.dispatch(this.newObject),this.object&&T.objectAdded.dispatch(this.object,this.layer)},dispose:function(){this.object=null,this.newObject=null,this.scene=null}},Ue.prototype={get index(){return this._index},get light(){return this._light},get lightConfig(){return this._lightConfig},updateLight:function(){if(null!==this._light){var e=this._lightConfig;this._light.color.setStyle(e.color),this._light.intensity=e.intensity,this._light.visible=e.visible,e.matrix&&(this._light.matrix.fromArray(e.matrix),this._light.matrix.decompose(this._light.position,this._light.quaternion,this._light.scale)),void 0!==this._light.groundColor&&this._light.groundColor.setStyle(e.groundColor),void 0!==this._light.penumbra&&(this._light.penumbra=e.penumbra),void 0!==this._light.angle&&(this._light.angle=e.angle),void 0!==this._light.decay&&(this._light.decay=e.decay);var t=e.lightType!==Punk.SpotLight&&e.lightType!==Punk.PointLight&&e.isBindCamera;T.setLightBindCamera.dispatch(this._index,t),T.objectChanged.dispatch(this._light)}},updateLightStatus:function(e,t){null!==this._light&&(!0===t?(e=void 0===e?!this._light.visible:e,this._light.visible=e,this._lightConfig.visible=e):(this._light.visible=!!e&&!1!==this._lightConfig.visible,!e&&this._selected&&T.objectUnSelected.dispatch(this._light)))},updateLightSpeed:function(){},updateLightAttr:function(e,t){var i=this._translateAttrValue(e,t);switch(e){case"color":this._light.color.setStyle(i);break;default:this._light[e]=i}this._lightConfig[e]=i,T.objectChanged.dispatch(this._light),T.needsRenderer.dispatch()},updateLightBindCamera:function(e){this._lightConfig.isBindCamera=e},updateLightType:function(e){var t=this._light,i=this._lightConfig.lightType;(this._lightConfig.lightType=e||null,e)?null!==t&&e===i||(this._light=Ke.addLight(e),new Ve(t,this._light).execute(),this.updateLight(),this._selected&&(null!==t&&T.objectUnSelected.dispatch(t),T.objectSelected.dispatch(this._light))):null!==t&&(new Ne(t).execute(),T.objectUnSelected.dispatch(t),this._light=null);T.lightTypeChanged.dispatch(this._index,this._lightConfig),T.needsRenderer.dispatch()},select:function(){this._selected=!0,null!==this._light&&T.objectSelected.dispatch(this._light),T.lightSelected.dispatch(this._index,this._lightConfig)},unSelect:function(){this._selected=!1,null!==this._light&&T.objectUnSelected.dispatch(this._light),T.lightUnSelected.dispatch(this._index,this._lightConfig)},toJSON:function(){return this._lightConfig},_onObjectChanged:function(e){e===this._light&&(this._lightConfig.matrix=this._light.matrix.toArray())},_translateAttrValue:function(e,t){var i;switch(e){case"angle":i=t*Math.PI/180;break;case"penumbra":i=t/100;break;case"decay":i=t/100*ke.scaleSetting.decay;break;case"intensity":i=(i=t/100)<.5?.4*this._getScaleValue()*i:this._getScaleValue()*(1.6*i-.6);break;default:i=t}return i},_getScaleValue:function(){switch(this._lightConfig.lightType){case Punk.DirectionalLight:return ke.scaleSetting.DirectionalLightScale;case Punk.PointLight:return ke.scaleSetting.PointLightScale;case Punk.SpotLight:return ke.scaleSetting.SpotLightScale;case Punk.HemisphereLight:return ke.scaleSetting.HemisphereLightScale;case Punk.AmbientLight:return ke.scaleSetting.AmbientLightScale}}},qe.prototype={get isLightsOn(){return this._isLightsOn},addLight:function(e,t,i,n){if(!e)return null;var s;switch(t=t||16777215,i=i?Number(i):1,n=!1!==n,e){case Punk.DirectionalLight:s=new Q.SDK.DirectionalLight(t,i);break;case Punk.PointLight:s=new Q.SDK.PointLight(t,i);break;case Punk.SpotLight:s=new Q.SDK.SpotLight(t,i,0,1.3,0);break;case Punk.HemisphereLight:s=new Q.SDK.HemisphereLight(t,t,i);break;case Punk.AmbientLight:s=new Q.SDK.AmbientLight(t,i);break;default:throw new Error("LightManager : can not find light type "+e)}return e!==Punk.HemisphereLight&&e!==Punk.AmbientLight&&(s.castShadow=n,s.shadow.camera.near=.01,s.shadow.camera.far=2e3),void 0!==s.distance&&(s.distance=3e3),s.target&&(s.add(s.target),s.target.position.set(0,-1,0)),s},addLightProxy:function(e){var t=new Ue(this._lightProxys.length,e);return this._lightProxys.push(t),t.light&&T.objectAdded.dispatch(t.light),t},applyPreset:function(e){for(var t,i=[],n=[Punk.HemisphereLight,Punk.DirectionalLight,Punk.PointLight],s=0;s<3;s++)t=new he({lightType:n[s],intensity:.5}),i.push(t);this.fromJSON(i)},fromJSON:function(e){for(var t=0,i=e.length;t<i;t++)this.addLightProxy(e[t]);this._isLightsOn=ke.sceneConfig.allLightsOn,T.lightsAdded.dispatch(e),T.lightsStatusChanged.dispatch(this._isLightsOn)},toJSON:function(){for(var e=[],t=0,i=this._lightProxys.length;t<i;t++)e.push(this._lightProxys[t].toJSON());return e},dispose:function(){this._removeEventListeners()},_updateLightBindCamera:function(e,t){this._lightProxys.length>e&&this._lightProxys[e].updateLightBindCamera(t)},_updateLightAttr:function(e,t,i){this._lightProxys[e].updateLightAttr(t,i)},_updateLightStatus:function(e,t){if(null!=e)this._lightProxys[e].updateLightStatus(t,!0);else{for(var i in this._lightProxys)this._lightProxys[i].updateLightStatus(t);this._isLightsOn=t}T.needsRenderer.dispatch()},_updateLightType:function(e,t){this._lightProxys[e].updateLightType(t)},_selectLight:function(e){this._selectedIndex===e?(this._selectedIndex=-1,this._lightProxys[e].unSelect()):(-1<this._selectedIndex&&this._lightProxys[this._selectedIndex].unSelect(),this._selectedIndex=e,this._lightProxys[e].select())},_onViewModeChanged:function(e,t){"Light"===e&&-1<this._selectedIndex&&(t?this._lightProxys[this._selectedIndex].select():this._lightProxys[this._selectedIndex].unSelect())},_removeEventListeners:function(){T.viewModeChanged.remove(this._onViewModeChanged,this),T.setLightStatus.remove(this._updateLightStatus,this),T.updateLightType.remove(this._updateLightType,this),T.selectLight.remove(this._selectLight,this),T.setLightBindCamera.remove(this._updateLightBindCamera,this),T.updateLightAttr.remove(this._updateLightAttr,this)}};var ze,Ke=new qe;function Qe(){}function We(){this._cameras={},this._cameraDatas={},this._vector=new Q.SDK.Vector3,this._matrix=new Q.SDK.Matrix4,this._length=0,this._cameraImg=null,this._selected=0,this._defaultIndex=0,this._initEventListener()}Object.assign(Qe.prototype,{loadModel:function(e,i){Oe.loader.load(e,function(e,t){i&&i(e,t)})},drawImageToCanvas:function(e,t){var i,n=e.getContext("2d"),s=e.width,a=e.height;n.clearRect(0,0,s,a),Oe.getTexture(t,function(e){i=e.image,n.drawImage(i,0,0,i.width,i.height,0,0,s,a)},Punk.Quality.THUMB)},getTextureIds:function(){for(var e,t,i=it.getScene().sceneMaterialProxy.materialProxies,n=[],s=0,a=i.length;s<a;s++)for(var r in e=i[s].maps)e.hasOwnProperty(r)&&(t=e[r])&&0<t&&-1===n.indexOf(t)&&n.push(t);return n},toJSON:function(){var e={};return e.scene=it.toJSON(),e.camera=Ge.toJSON(),e.light=Ke.toJSON(),e.allLightsOn=Ke.isLightsOn,e},getCameraImg:function(){return Ge.getCameraImgs()},saveCanvas:function(e,t,i){var n=e.width,s=e.height,a=document.createElement("canvas"),r=a.getContext("2d");return t||i?(a.width=t,a.height=i):(a.width=n,a.height=s),r.drawImage(e,0,0,n,s,0,0,a.width,a.height),a.toDataURL("base64")},post:function(e,t,i,s){var n=new FormData;for(var a in t)n.append(a,t[a]);var r=new XMLHttpRequest;r.addEventListener("load",function(e){if(void 0!==i){var t=JSON.parse(e.target.responseText);i(t)}},!1),void 0!==s&&(r.upload.onprogress=function(e){var t=e.loaded,i=e.total,n=Math.floor(100*t/i);s(n)}),r.open("post",e),r.setRequestHeader("enctype","multipart/form-data"),r.send(n)},getMousePosition:function(e,t,i){var n=e.getBoundingClientRect();return[(t-n.left)/n.width,(i-n.top)/n.height]}}),ze=new Qe,Object.assign(We.prototype,{_initEventListener:function(){T.viewSaveCameraConfig.add(this._saveCameraConfig,this),T.viewFovChanged.add(this._onFovChanged,this),T.viewDeleteCameraConfig.add(this._deleteCameraConfig,this),T.viewAddCameraConfig.add(this._addCameraConfig,this),T.viewCameraConfigChanged.add(this._onCameraConfigChanged,this),T.CameraInitUpdate.add(this._initUpdateCamera,this),T.ViewPicSaved.add(this._cameraSavePicDatas,this),T.updateCameraImgStatus.add(this._updateCameraStatus,this),T.cameraReset.add(this._onCameraReset,this)},_cameraSavePicDatas:function(e,t){this._cameraDatas[e].img={data:JSON.stringify(t),oldIndex:-1,cameraId:e}},getCameraConfig:function(e){if(this._cameraDatas.hasOwnProperty(e))return this._cameraDatas[e]},addCamera:function(e){var t=new Q.SDK.PerspectiveCamera(45,1,.01,2e3);return t.name=e,t.position.set(20,10,20),t.lookAt(ke.cameraCenter),this._cameras[e]=t,this._addCameraConfig(),t},getCamera:function(e){return e=void 0===e?"default":e,this._cameras.hasOwnProperty(e)?this._cameras[e]:null},fromJSON:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t];n.img={data:"",oldIndex:t,cameraId:t},this._addCameraConfig(n,t),n.active&&(this._updateCamera(t),T.viewSelectedCamera.dispatch(t),this._selected=t,this._defaultIndex=t),T.initCameraImg.dispatch(t,ke.oid)}},toJSON:function(){for(var e={},t=[],i=[],n=0;n<this._length;n++)this._cameraDatas.hasOwnProperty(n)&&(1==this._cameraDatas[n].active&&(this._updateActiveCamera(n),this._updateCameraPic(n)),t.push(this._cameraDatas[n].clone()),i.push(this._cameraDatas[n].img));return e.data=t,e.type="Cameras",this._cameraImg=i,e},_updateActiveCamera:function(e){var t=this._cameraDatas[e],i=t.active,n=this.getCamera().toJSON();t.dispose(),n.active=i,n.center=ke.cameraCenter,this._cameraDatas[e]=n},_updateCameraPic:function(e){var t=ze.saveCanvas(ke.canvas,58,58);T.ViewPicSaved.dispatch(e,t)},_updateCameraStatus:function(){for(var e=0;e<this._cameraImg.length;e++){var t=this._cameraImg[e].cameraId;this._cameraDatas.hasOwnProperty(t)&&(this._cameraDatas[t].img.oldIndex=e,this._cameraDatas[t].img.data="")}},getCameraImgs:function(){return this._cameraImg},_updateCamera:function(e){var t=this.getCamera(),i=this._cameraDatas[e];t.fromJSON(i),ke.cameraCenter=i.center},_initUpdateCamera:function(e){T.viewSelectedCamera.dispatch(e),this._saveCameraConfig(e);var t=ze.saveCanvas(ke.canvas,58,58);T.ViewPicSaved.dispatch(0,t)},_addCameraConfig:function(e,t){void 0!==t&&this._cameraDatas.hasOwnProperty(t)?(this._cameraDatas[t].dispose(),this._cameraDatas[t]=e,T.cameraConfigChanged.dispatch(t,e)):(e||((e=this.getCamera().toJSON()).center=ke.cameraCenter),this._cameraDatas[this._length]=e,T.cameraConfigAdded.dispatch(this._length,e),this._length++)},_saveCameraConfig:function(e){if(this._cameraDatas.hasOwnProperty(e)){var t=this._cameraDatas[e],i=t.active,n=this.getCamera().toJSON();t.dispose(),n.active=i,this._cameraDatas[e]=n,T.cameraConfigChanged.dispatch(e,n)}},_onFovChanged:function(e,t){this._cameraDatas[e].fov=t,this.getCamera().updateFov(t),T.needsRenderer.dispatch()},_deleteCameraConfig:function(e){this._cameraDatas.hasOwnProperty(e)&&delete this._cameraDatas[e]},_onCameraConfigChanged:function(e){var t=this,i=this._cameraDatas.hasOwnProperty(e)?this._cameraDatas[e]:null;if(i){this._cameraDatas[this._selected]&&(this._cameraDatas[this._selected].active=0),this._cameraDatas[e].active=1,this._selected=e;var n=this.getCamera();this._matrix.fromArray(i.matrix),this._vector.setFromMatrixPosition(this._matrix),T.stopUIReact.dispatch(),T.cameraMovieStarted.dispatch(),n.fov!==i.fov&&I.getActor("CameraActor").fovAtTo(n,i.fov,n.fov,900,i.center,null,!0,v.Quad.easeOut),I.getActor("PositionActor").moveTo(n,this._vector,900,i.center,null,!1,v.Quad.easeOut),I.getActor("LookAtActor").lookAtTo(n,ke.cameraCenter,i.center,900,function(){t._updateCamera(e),ke.cameraCenter=i.center,T.beginUIReact.dispatch(),T.cameraMovieFinished.dispatch()},v.Quad.easeOut)}},_onCameraReset:function(){this._onCameraConfigChanged(this._defaultIndex)},_removeEventListener:function(){T.viewSaveCameraConfig.remove(this._saveCameraConfig,this),T.viewFovChanged.remove(this._onFovChanged,this),T.viewDeleteCameraConfig.remove(this._deleteCameraConfig,this),T.viewAddCameraConfig.remove(this._addCameraConfig,this),T.viewCameraConfigChanged.remove(this._onCameraConfigChanged,this)},dispose:function(){this._removeEventListener(),this._cameras=null,this._cameraDatas=null,this._vector=null,this._matrix=null}});var Ge=new We;function Je(){Q.SDK.Scene.call(this),this.type="PunkScene",this.sceneMaterialProxy=new Be,this._composerName="ModelPass",this._passInitMap={},this._passEnableNum=0,this._initEventListener(),this._initPass()}function Ye(e,t){t.side=THREE.BackSide,t.depthTest=!1,t.depthWrite=!1,Q.SDK.Mesh.call(this,e,t),this.map=null,this.scale.x=-1}function Xe(e,t){var i=new Q.SDK.SphereGeometry(e,32,15),n=new Q.SDK.MeshBasicMaterial({map:t});Ye.call(this,i,n),this.skyType=Punk.HDRSky,this.map=t}function $e(e,t){var i=new Q.SDK.BoxGeometry(e,e,e),n=this._makeMaterial(t);Ye.call(this,i,n),this.skyType=Punk.CubeSky,this.map=t}function Ze(e,t,i){y.call(this),this._camera=e,this._renderer=i,this._scene=t,this._speed=.003}function et(){Q.SDK.Scene.call(this),this.skyId=-1,this.type="SkyScene",this.enableBlur=!1,this.enableEnv=!0,this._sky=null,this._cubeCamera=null,this._cameraSkyActor=null,this._composerInit=!1,this._passes=[],this._forceRender=!1,this._init(),this._initEventListener()}function tt(){this._scenes={}}((Je.prototype=Object.create(Q.SDK.Scene.prototype)).constructor=Je).prototype._initEventListener=function(){T.materialChanged.add(this._updateMaterial,this)},Je.prototype._afterObjectAdd=function(e){e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})},Je.prototype.fromJSON=function(e){if(e.viewLayer){var t=new THREE.Matrix4,i=this.viewLayer;t.fromArray(e.viewLayer.matrix),i.applyMatrix(t)}var n=e.materialSettings;n&&(Oe.loader.materialPreset=this.sceneMaterialProxy.fromJSON(n))},Je.prototype.toJSON=function(){var e=new oe,t=this.viewLayer,i=it.getScene("sky");return t.updateMatrix(),e.sceneType=Punk.PunkScene,e.viewLayer={matrix:t.matrix.toArray()},e.materialSettings=this.sceneMaterialProxy.toJSON(),e.skyId=i.skyId,e.isBlur=i.isBlur,e},Je.prototype._updateMaterial=function(e,t){var i,n=this.findObjectByMaterial(e);if(n)for(var s=0,a=n.length;s<a;s++){var r=n[s];if((i=r.material)instanceof Array)for(var o=0,h=i.length;o<h;o++)i[o]===e&&r.material.splice(o,1,t);else r.material=t}else console.warn("objects is empty,can not find this type material objects")},Je.prototype._initPass=function(){T.composerAdded.dispatch("default"),T.composerAdded.dispatch(this._composerName);var e=ke.presetConfig.passSet;for(var t in e){var i=e[t];this._initPassCommon(ke.presetConfig[i],this["_change_"+i])}this._initPassUI(),this._addPassEvent()},Je.prototype._initPassUI=function(){var e=ke.presetConfig.passSet;for(var t in e){var i=e[t],n=ke.presetConfig[i];T[i].dispatch("init",n)}},Je.prototype._addPassEvent=function(){var e=ke.presetConfig.passSet;for(var t in e){var i=e[t];this["_change_"+i]?T[i].add(this["_change_"+i],this):T[i].add(this._changePassCommon,this)}},Je.prototype._removePassEvent=function(){var e=ke.presetConfig.passSet;for(var t in e){var i=e[t];this["_change_"+i]?T[i].remove(this["_change_"+i],this):T[i].remove(this._changePassCommon,this)}},Je.prototype._checkNeedRenderThisScene=function(){0==this._passEnableNum?(T.composerEnabled.dispatch(this._composerName,!1),T.sceneShift.dispatch(this)):(T.composerEnabled.dispatch(this._composerName,!0),T.sceneRemoved.dispatch(this))},Je.prototype._initPassCommon=function(e,t){if(e.switch.val)for(var i in t.call(this,"switch",!0),e)t.call(this,i,e[i].val)},Je.prototype._initPassParam=function(e,t){for(var i in e)"switch"!==i&&t.call(this,i,e[i].val)},Je.prototype._disablePassCommon=function(e){var t=!1;if(this._passInitMap.hasOwnProperty(e))for(var i in this._passInitMap[e])!1!==this._passInitMap[e][i].enabled&&(t=!0,this._passInitMap[e][i].enabled=!1);t&&(this._passEnableNum--,ke.presetConfig[e].switch.val=!1,this._checkNeedRenderThisScene(),T.needsRenderer.dispatch())},Je.prototype._enablePassCommon=function(e,t){var i=!1;if(this._passInitMap.hasOwnProperty(e))for(var n in this._passInitMap[e])!0!==this._passInitMap[e][n].enabled&&(i=!0,this._passInitMap[e][n].enabled=!0);(i||t)&&(this._passEnableNum++,ke.presetConfig[e].switch.val=!0,this._checkNeedRenderThisScene(),T.needsRenderer.dispatch())},Je.prototype._checkChangeLegal=function(e,t){return"switch"===t||this._passInitMap.hasOwnProperty(e)},Je.prototype._changePassCommon=function(e,t,i,n){if(this._checkChangeLegal(e,t))switch(t){case"switch":if(i){var s=this["_init_"+e].call(this);s&&this._initPassParam(ke.presetConfig[e],this["_change_"+e]),this._enablePassCommon(e,s)}else this._disablePassCommon(e);break;default:if(n){var a=ke.presetConfig[e][t];a.alias&&(t=a.alias),n.params[t]=i,T.needsRenderer.dispatch()}}},Je.prototype._change_passWireframe=function(e,t){var i="passWireframe";if(this._checkChangeLegal(i,e)){var n=this._passInitMap[i],s=void 0!==n?n.whitePass:void 0,a=void 0!==n?n.toonPass:void 0;switch(e){case"modelAlpha":t=parseFloat(t),this._changePassCommon(i,e,t,s);break;case"wireAlpha":t=parseFloat(t),this._changePassCommon(i,e,t,a);break;case"modelColor":(r=new THREE.Color).setHex(parseInt(t.replace("#","0x"))),t=r,this._changePassCommon(i,e,t,s);break;case"wireColor":var r;(r=new THREE.Color).setHex(parseInt(t.replace("#","0x"))),t=r,this._changePassCommon(i,e,t,a);break;default:this._changePassCommon(i,e,t)}}},Je.prototype._init_passWireframe=function(){if(this._passInitMap.hasOwnProperty("passWireframe"))return!1;var e=ke.rendererSize,t=Ge.getCamera();this._passInitMap.passWireframe={};var i=new THREE.WhitePass(new Q.SDK.Vector2(e.x,e.y),this,t);i.renderToScreen=!0,T.passAdded.dispatch(this._composerName,i),this._passInitMap.passWireframe.whitePass=i;var n=new THREE.ToonPass(new Q.SDK.Vector2(e.x,e.y),this,t,{blendingType:THREE.MultiplyBlending,bottomLayer:!1});return n.renderToScreen=!0,T.passAdded.dispatch(this._composerName,n),this._passInitMap.passWireframe.toonPass=n,!0},Je.prototype._change_passSSAO=function(e,t){var i="passSSAO";if(this._checkChangeLegal(i,e)){var n=this._passInitMap[i],s=void 0!==n?n.saoPass:void 0;this._changePassCommon(i,e,t,s)}},Je.prototype._init_passSSAO=function(){if(this._passInitMap.hasOwnProperty("passSSAO"))return!1;var e=Ge.getCamera();this._passInitMap.passSSAO={};var t=new THREE.RenderPass(this,e);t.renderToScreen=!1,T.passAdded.dispatch(this._composerName,t),this._passInitMap.passSSAO.renderPass=t;var i=new THREE.SAOPass(this,e,!1,!0);return i.renderToScreen=!0,T.passAdded.dispatch(this._composerName,i),this._passInitMap.passSSAO.saoPass=i,!0},Je.prototype._change_passGrain=function(e,t){var i="passGrain";this._checkChangeLegal(i,e)&&this._changePassCommon(i,e,t,void 0)},Je.prototype._init_passGrain=function(){if(this._passInitMap.hasOwnProperty("passGrain"))return!1;var e,t,i,n=ke.rendererSize,s=Ge.getCamera();this._passInitMap.passGrain={};var a,r=n.width,o=n.height,h=r/2,l=o/2;(e=new THREE.OrthographicCamera(-h,h,l,-l,-1e4,1e4)).position.z=100,t=s,i=new THREE.Scene;var c=new THREE.Scene;(a=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),new THREE.MeshBasicMaterial({color:16755200}))).position.z=-300,a.scale.set(r/2,o/2,1),c.add(a);var d=THREE.BleachBypassShader,u=THREE.SepiaShader,p=THREE.VignetteShader,m=THREE.CopyShader,f=new THREE.ShaderPass(d),_=new THREE.ShaderPass(u),y=new THREE.ShaderPass(p);new THREE.ShaderPass(m);f.uniforms.opacity.value=.95,_.uniforms.amount.value=.9,y.uniforms.offset.value=.95,y.uniforms.darkness.value=1.6;var g=new THREE.BloomPass(.5),v=new THREE.FilmPass(.35,.025,648,!1),w=(new THREE.FilmPass(.35,.5,2048,!0),new THREE.DotScreenPass(new THREE.Vector2(0,0),.5,.8),new THREE.ShaderPass(THREE.HorizontalBlurShader)),S=new THREE.ShaderPass(THREE.VerticalBlurShader);w.uniforms.h.value=2/(r/2),S.uniforms.v.value=2/(o/2);var C=new THREE.ShaderPass(THREE.ColorifyShader),b=new THREE.ShaderPass(THREE.ColorifyShader);C.uniforms.color=new THREE.Uniform(new THREE.Color(1,.8,.8)),b.uniforms.color=new THREE.Uniform(new THREE.Color(1,.75,.5));var M=new THREE.ClearMaskPass,E=(new THREE.MaskPass(this,t),new THREE.MaskPass(this,t));E.inverse=!0,y.renderToScreen=!0;var x=new THREE.RenderPass(i,e),P=new THREE.RenderPass(this,t);return P.clear=!1,T.passAdded.dispatch(this._composerName,x),T.passAdded.dispatch(this._composerName,P),T.passAdded.dispatch(this._composerName,E),T.passAdded.dispatch(this._composerName,w),T.passAdded.dispatch(this._composerName,S),T.passAdded.dispatch(this._composerName,M),this._passInitMap.passGrain.renderBackground=x,this._passInitMap.passGrain.renderModel=P,this._passInitMap.passGrain.renderMaskInverse=E,this._passInitMap.passGrain.effectHBlur=w,this._passInitMap.passGrain.effectVBlur=S,this._passInitMap.passGrain.clearMask=M,T.passAdded.dispatch(this._composerName,g),T.passAdded.dispatch(this._composerName,v),T.passAdded.dispatch(this._composerName,f),T.passAdded.dispatch(this._composerName,y),this._passInitMap.passGrain.effectBloom=g,this._passInitMap.passGrain.effectFilm=v,this._passInitMap.passGrain.effectBleach=f,this._passInitMap.passGrain.effectVignette=y,!0},Je.prototype._change_passDepthField=function(e,t){var i="passDepthField";this._checkChangeLegal(i,e)&&this._changePassCommon(i,e,t,void 0)},Je.prototype._init_passDepthField=function(){if(this._passInitMap.hasOwnProperty("passDepthField"))return!1;Ge.getCamera();return this._passInitMap.passDepthField={},!0},Je.prototype._change_passBloom=function(e,t){var i="passBloom";if(this._checkChangeLegal(i,e)){var n=this._passInitMap[i],s=void 0!==n?n.bloomPass:void 0;switch(e){case"threshold":s.threshold=parseFloat(t),T.needsRenderer.dispatch();break;case"intensity":s.strength=parseFloat(t),T.needsRenderer.dispatch();break;case"radius":s.radius=parseFloat(t),T.needsRenderer.dispatch();break;default:this._changePassCommon(i,e,t,void 0)}}},Je.prototype._init_passBloom=function(){if(this._passInitMap.hasOwnProperty("passBloom"))return!1;var e=ke.rendererSize,t=Ge.getCamera();this._passInitMap.passBloom={};var i=new THREE.RenderPass(this,t);i.renderToScreen=!1,T.passAdded.dispatch(this._composerName,i),this._passInitMap.passBloom.renderPass=i;var n=new THREE.ShaderPass(THREE.FXAAShader);n.uniforms.resolution.value.set(1/e.width,1/e.height),T.passAdded.dispatch(this._composerName,n),this._passInitMap.passBloom.effectFXAA=n;var s=s=new THREE.UnrealBloomPass(new THREE.Vector2(e.width,e.height),1.5,.4,.85);return s.renderToScreen=!0,T.passAdded.dispatch(this._composerName,s),this._passInitMap.passBloom.bloomPass=s,!0},((Ye.prototype=Object.create(THREE.Mesh.prototype)).constructor=Ye).prototype.updateTexture=function(e){this.map=e},Ye.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},((Xe.prototype=Object.create(Ye.prototype)).constructor=Xe).prototype.updateTexture=function(e){Ye.prototype.updateTexture.call(this,e),this.material.map!==e&&(this.material.map=e),this.material.needsUpdate=!0},(($e.prototype=Object.create(Ye.prototype)).constructor=$e).prototype.updateTexture=function(e){Ye.prototype.updateTexture.call(this,e),this.material.uniforms.tCube.value=e},$e.prototype._makeMaterial=function(e){e.format=THREE.RGBFormat;var t=THREE.ShaderLib.cube;return t.uniforms.tCube.value=e,new Q.SDK.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:t.uniforms,depthWrite:!1,side:THREE.BackSide})},((Ze.prototype=Object.create(y.prototype)).constructor=Ze).prototype.updateRenderTarget=function(){this._camera.update(this._renderer,this._scene)},Ze.prototype.update=function(){this._renderer&&this._scene&&this._camera&&(this._camera.rotation.y+=this._speed,this.updateRenderTarget(),this.needsUpdate=!0)},((et.prototype=Object.create(Q.SDK.Scene.prototype)).constructor=et).prototype._init=function(){this._cubeCamera=new THREE.CubeCamera(1,2e4,256),this._cubeCamera.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,this._cameraSkyActor=new Ze(this._cubeCamera,this,ke.renderer),this._cameraSkyActor.stop()},et.prototype._initEventListener=function(){T.setSkyBlur.add(this._onChangeBlur,this),T.cameraMoved.add(this._onCameraMoved,this),T.cameraMovieStarted.add(this._onCameraStarted,this),T.cameraMovieFinished.add(this._onCameraFinished,this),T.windowResize.add(this._onWindowResize,this),T.rendererFinish.add(this._onRenderFinish,this),T.viewSelectedEnvMap.add(this.updateSky,this)},et.prototype.updateSky=function(t){if(this.skyId!==t){t=void 0===t?this.skyId:t;var i=ke.skyModels[t],n=this,s=!0;Oe.getTexture(i.textureLoaderModel.key,function(e){n._updateSky(i,e),s&&(n.skyId=t,n.enableEnv&&n.updateEnvMap(),T.skyChanged.dispatch(i)),s=!1},Punk.Quality.LOW)}},et.prototype.updateEnvMap=function(){if(-1===this.skyId||null===this._sky)return null;var e=ke.skyModels[this.skyId],i=this;Oe.getTexture(e.textureLoaderModel.key,function(e){var t=i._sky.map;t!==e&&i._sky.updateTexture(e),i._cameraSkyActor.updateRenderTarget(),T.envMapChanged.dispatch(i._cubeCamera.renderTarget.texture),t!==e&&i._sky.updateTexture(t)})},et.prototype.blur=function(){if(!this._composerInit&&!ke.transparent){T.composerAdded.dispatch("sky",void 0,0);var e=Ge.getCamera(),t=new THREE.BlurPass(1,{}),i=new THREE.BloomPass(1),n=new THREE.BlurPass(1,{scale:6}),s=new THREE.RenderPass(this,e),a=new THREE.ShaderPass(THREE.CopyShader);a.material.depthTest=!1,a.material.depthWrite=!1,a.needsSwap=!1,a.renderToScreen=!0,T.passAdded.dispatch("sky",s),T.passAdded.dispatch("sky",t),T.passAdded.dispatch("sky",i),T.passAdded.dispatch("sky",n),T.passAdded.dispatch("sky",a),this._passes.push(s),this._passes.push(t),this._passes.push(i),this._passes.push(n),this._composerInit=!0}T.composerEnabled.dispatch("sky",!0),T.sceneRemoved.dispatch(this),this.enableBlur=!0},et.prototype.clearBlur=function(){T.composerEnabled.dispatch("sky",!1),T.sceneShift.dispatch(this),this.enableBlur=!1},et.prototype._onChangeBlur=function(e){e?this.blur():this.clearBlur(),T.needsRenderer.dispatch()},et.prototype._removeSkyBox=function(){null!==this._sky&&(null!==this._sky.parent&&this._sky.parent.remove(this._sky),this._sky=null)},et.prototype._updateSky=function(e,t,i){if(i=void 0===i?e.size:i,i=100,null!==this._sky&&this._sky.skyType!==e.skyType&&this._removeSkyBox(),null===this._sky){switch(e.skyType){case Punk.CubeSky:this._sky=this._createCubeSkyBox(i,t);break;case Punk.HDRSky:this._sky=this._createHDRSkyBox(i,t)}this.add(this._sky)}else this._sky.updateTexture(t);this.enableBlur&&(this.blur(),this._updatePassEnable(!0)),T.needsRenderer.dispatch()},et.prototype._onRenderFinish=function(){this.enableBlur&&this._composerInit&&!this._forceRender&&this._updatePassEnable(!1)},et.prototype._updatePassEnable=function(e){for(var t=0,i=this._passes.length;t<i;t++)this._passes[t].enabled=e},et.prototype._onCameraMoved=function(){var e=Ge.getCamera();e.updateMatrixWorld(),this.position.setFromMatrixPosition(e.matrixWorld),this.enableBlur&&this._composerInit&&this._updatePassEnable(!0)},et.prototype._onCameraStarted=function(){this._forceRender=!0,this.enableBlur&&this._composerInit&&this._updatePassEnable(!0)},et.prototype._onCameraFinished=function(){this._forceRender=!1},et.prototype._onWindowResize=function(){this.enableBlur&&this._composerInit&&this._updatePassEnable(!0)},et.prototype._createCubeSkyBox=function(e,t){return new $e(e,t)},et.prototype._createHDRSkyBox=function(e,t){return new Xe(e,t)},et.prototype._removeEventListener=function(){T.setSkyBlur.remove(this._onChangeBlur,this),T.cameraMoved.remove(this._onCameraMoved,this),T.cameraMovieStarted.remove(this._onCameraStarted,this),T.cameraMovieFinished.remove(this._onCameraFinished,this),T.windowResize.remove(this._onWindowResize,this),T.rendererFinish.remove(this._onRenderFinish,this),T.viewSelectedEnvMap.remove(this.updateSky,this)},et.prototype.dispose=function(){Q.SDK.Scene.prototype.dispose.call(this),this._removeEventListener(),this._sky=null,this._cubeCamera=null,this._cameraSkyActor=null,this._passes=null},Object.assign(tt.prototype,{addScene:function(e,t){if(this._scenes.hasOwnProperty(e))return this._scenes[e];var i=new(this._getSceneDefine(t));return i.name=e,this._scenes[e]=i},getScene:function(e){return e=void 0===e?"default":e,this._scenes.hasOwnProperty(e)?this._scenes[e]:null},fromJSON:function(e){var t=e[0];this.getScene().fromJSON(t)},toJSON:function(){var e={},t=[],i=this.getScene().toJSON();return t.push(i),e.data=t,e.type="Scenes",e},_getSceneDefine:function(e){switch(e){case Punk.PunkScene:case"PunkScene":return Je;case Punk.SkyScene:return et;case Punk.HelperScene:return Q.SDK.SceneHelper;default:return Q.SDK.Scene}},dispose:function(){this._scenes=null}});var it=new tt;function nt(){this._loadingBar=null}function st(){}function at(){this._server=null}function rt(){}function ot(e){this.pid=-1,this.errorCode=null,this.errorMsg=null,this.data=null,this.type="NetResponseModel",l.call(this,e)}function ht(){this._network=null}function lt(){y.call(this,!1),this._renderer=null,this._camera=null,this._scenes=[],this._composersBefore=[],this._composersAfter=[],this._sceneRenderProxy=[]}function ct(){this._renderer=null,this._rendererActor=null,this._outlinePass=null,this._selectedObjects=null,this._composers={}}function dt(){this._editorControls=null,this._transformControls=null}function ut(){y.call(this),this._animations={},this._currentAction=null,this._timeScale=1,this._initEventListener()}function pt(){this._animationActor=null,this._hasAnimation=!1}function mt(e,t,i){this.name=i,this.title=e,this.EngTitle=t,m.call(this,i),this._initEventListener()}function ft(e){m.call(this,e),this._list=[],this._target=null,this._itemDefault=mt,this.length=0,this.renderTypeList=[],this._onOpenClickEvent=null,this._onOpenClickTarget=null,this._onCloseClickEvent=null,this._onCloseClickTarget=null}function _t(){this._renderList=["","wireframe","map","normalMap","metalnessMap","roughnessMap","specularMap","glossinessMap","emissiveMap"],this._renderNames=["全部","布线","固有色 / 基色","法线 / 凹凸","金属性","粗糙度","高光","光泽度","自发光"],this._renderEnNames=["All","Wireframe","Diffuse/Albedo","Normal/Bump","Metallic","Roughness","Specular","Glossiness","Emission"],this._itemNames=["all","wireframe","map","normalMap","metalnessMap","roughnessMap","specularMap","glossinessMap","emissiveMap"],this._mapList=[],this._multiRenderPass=null,this._view=null}function yt(e,t){Ie.call(this),this.type="LayerRotateCommand",this.direction=e,this.lastDirection=null,this.layer=void 0===t?Punk.PunkLayers.VIEWLAYER:t}function gt(){this._isPublished=0,this._ableSaveConfig=!1}function vt(e){this._text=null,this._btnClose=null,this._play="",this._uri="",we.call(this,null,"tipsText abs"),e&&this._text.html(e),this._initEventListener()}function wt(){_.call(this),this.type="adPlayer",this._adList=ke.ads,this._index=-1,this._timer=0,this._ad=null,this._text=null,this._text2=null,this._currentText=null,this._preText=null}function St(){this._networkModule=null,this._startupModule=null,this._rendererModule=null,this._editorModule=null,this._animationModule=null,this._multiRenderModule=null,this._uiEventsModule=null,this._adModule=null}function Ct(){this._init()}Object.assign(nt.prototype,{init:function(){var e=this;this._initEventListener(),this._loadingBar=new f("globalLoading",function(){e._loadEditorConfig()},ke.autoLoad,ke.showLoading),ke.parentDom.appendChild(this._loadingBar.dom),Oe.setLoadingBar(this._loadingBar),ke.transparent||this._loadingBar.updateBackground(ke.cover)},_initEventListener:function(){T.networkResponse.add(this._onNetworkResponse,this)},_loadEditorConfig:function(){var e=new C;e.pid=J,e.uri=ke.loadConfigUri,e.sendType=Punk.NetworkType.GET,e.throwError=!0,T.networkRequest.dispatch(e)},_loadSkyList:function(e){var t=new C;t.pid=X,-1<e&&(t.data={skyId:e}),T.networkRequest.dispatch(t)},_loadModelInfo:function(){var e=new C;e.pid=Y,e.data={oid:ke.oid},ke.isDebug||(e.throwError=!0),T.networkRequest.dispatch(e)},_onNetworkResponse:function(e){if(e.pid===J){ke.presetConfig=e.data,this._loadingBar.updateTitle("资源加载中，请稍候..");var t=ke.isEditorMode?-1:ke.sceneConfig.scene?ke.sceneConfig.scene[0].skyId:-1;this._loadSkyList(t)}else if(e.pid===X){if(e.data){for(var i={},n=0,s=e.data.length;n<s;n++){var a=new W(e.data[n]);i[a.skyId]=a,Oe.addTextureLoadModel(a.textureLoaderModel)}ke.skyModels=i;t=ke.sceneConfig.scene?ke.sceneConfig.scene[0].skyId:-1;i.hasOwnProperty(t)||(t=-1),t=-1===t?d.getRandomKey(i):t,it.getScene("sky").skyId=t,ke.isEditorMode&&T.envMapAdded.dispatch(i),Oe.addPreloadTexture(i[t].textureLoaderModel)}this._loadModelInfo()}else if(e.pid===Y){if(!e.data&&!ke.isDebug)return void console.error("3DPunkEditor.StartupModule : Can not find model info!!!");var r;if(ke.isDebug)r="assets/multiChildren.obj";else{r=e.data.uri;var o=e.data.imgs;if(o){n=0;for(var h,l=o.length;n<l;n++)h=new b(o[n]),Oe.addPreloadTexture(h);T.reponseTexture.dispatch(o)}}ze.loadModel(r,function(e,t){var i=new G;i.model=e,i.animations=t,e.uri=r,ke.models.push(i),T.objectAdded.dispatch(e)}),this._loadingBar.bindFinishFunc(this._loadComplete,this)}},_loadComplete:function(){var e=this;(new S).to(this._loadingBar.dom,0,500,function(){ke.parentDom.removeChild(e._loadingBar.dom),T.loadingComplete.dispatch(),this.dispose()}),Oe.setLoadingBar(null),T.preLoaderComplete.dispatch()},_removeEventListener:function(){T.networkResponse.remove(this._onNetworkResponse,this)},dispose:function(){this._removeEventListener(),this._loadingBar.dispose(),this._loadingBar=null}}),st.test=function(e){return e.post&&"function"==typeof e.post&&e.get&&"function"==typeof e.get},Object.assign(at.prototype,{init:function(e){if(!1===st.test(e))throw new Error("3DPunkEditor.Network : parameter must be implement IServer!!");this._server=e},send:function(e,t,i){this._server.post(e,t,i)},get:function(e,t){this._server.get(e,t)},dispose:function(){this._server=null}}),Object.assign(rt.prototype,{post:function(t,e,i){null==e&&console.warn("JQueryServer : post data is empty!"),$.ajax({url:t,dataType:"json",type:"POST",data:e,timeout:15e3,error:function(e){console.error("JQueryServer : post data to : "+t+" has failed !!"),i&&"function"==typeof i&&i()},success:function(e){i&&"function"==typeof i&&i(e)}})},get:function(t,i){$.ajax({url:t,dataType:"json",type:"GET",timeout:15e3,error:function(e){console.error("JQueryServer : get data from : "+t+" has failed !!"),i&&"function"==typeof i&&i()},success:function(e){i&&"function"==typeof i&&i(e)}})}}),((ot.prototype=Object.create(l.prototype)).constructor=ot).prototype.setValues=function(e){l.prototype.setValues.call(this,e),this.data=this.data?this.data:null},ot.prototype.dispose=function(){l.prototype.dispose.call(this),this.data=null},Object.assign(ht.prototype,{init:function(){var e=new rt;this._network=new at,this._network.init(e),this._initEventListener()},_initEventListener:function(){T.networkRequest.add(this._onNetworkRequest,this)},_onNetworkRequest:function(t){if(!t instanceof C)console.error("3DPunkEditor.NetworkProxyModule : request data is not valid");else{var i=this;if(t.uri||(t.uri=ke.netRequestUri),t.sendType===Punk.NetworkType.POST){var e={pid:t.pid,data:t.data};e[ke.csrfName]=ke.csrfToken,this._network.send(t.uri,e,function(e){i._onNetworkResponse(t.pid,e,t.throwError)})}else this._network.get(t.uri,function(e){e=e?{data:e}:null,i._onNetworkResponse(t.pid,e,t.throwError)})}},_onNetworkResponse:function(e,t,i){var n=new ot(t);if(n.pid=e,t){if(n.setValues(t),null!==n.errorCode&&n.errorCode<0){if(i)return void this._throwError(e,n.errorMsg);console.warn("3DPunkEditor.NetworkProxyModule : server returns an error, error message is "+n.errorMsg)}}else if(i)return void this._throwError(e);T.networkResponse.dispatch(n)},_throwError:function(e,t){},_removeEventListener:function(){T.networkRequest.remove(this._onNetworkRequest,this)},dispose:function(){this._network.dispose(),this._network=null,this._removeEventListener()}}),((lt.prototype=Object.create(y.prototype)).constructor=lt).prototype.init=function(e,t){this._renderer=e,this._camera=t},lt.prototype.addScene=function(e,t){-1<this._scenes.indexOf(e)||(!0!==t?this._scenes.push(e):this._scenes.unshift(e))},lt.prototype.removeScene=function(e){var t=this._scenes.indexOf(e);-1<t&&this._scenes.splice(t,1)},lt.prototype.addComposer=function(e){(1==e.rendererOrder?this._composersAfter:this._composersBefore).push(e)},lt.prototype.removeComposer=function(e){var t=1==e.rendererOrder?this._composersAfter:this._composersBefore,i=t.indexOf(e);-1<i&&t.splice(i,1)},lt.prototype.addSceneRenderProxy=function(e){-1===this._sceneRenderProxy.indexOf(e)&&this._sceneRenderProxy.push(e)},lt.prototype.removeRenderProxy=function(e){this._sceneRenderProxy.splice(this._sceneRenderProxy.indexOf(e),1)},lt.prototype.setSize=function(e,t){var i,n;for(i=0,n=this._composersBefore.length;i<n;i++)this._composersBefore[i].setSize(e,t);for(i=0,n=this._composersAfter.length;i<n;i++)this._composersAfter[i].setSize(e,t)},lt.prototype.updateCamera=function(e){this._camera=e},lt.prototype.update=function(){this._renderer&&this._camera&&(0<this._composersBefore.length||0<this._composersAfter.length||0<this._scenes.length)&&this.render()},lt.prototype.render=function(){if(this.needsUpdate){var e,t,i;for(this._renderer.clear(),T.rendererStarted.dispatch(),e=0,t=this._composersBefore.length;e<t;e++)!1!==(i=this._composersBefore[e]).enabled&&i.render();for(T.rendererSceneStarted.dispatch(),e=0,t=this._scenes.length;e<t;e++){var n=this._scenes[e];n.updateMatrixWorld(),-1===this._sceneRenderProxy.indexOf(n.name)&&this._renderer.render(n,this._camera)}for(T.rendererSceneFinish.dispatch(),e=0,t=this._composersAfter.length;e<t;e++)!1!==(i=this._composersAfter[e]).enabled&&i.render();T.rendererFinish.dispatch(),this.needsUpdate=!1}},lt.prototype.dispose=function(){this.stop(),this._renderer=null,this._camera=null,this._scenes=null,this._composersBefore=null,this._composersAfter=null},Object.assign(ct.prototype,{init:function(){var e=ke.transparent?0:1,t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this._renderer=Q.Utils.createRenderer(t,e),this._rendererActor=new lt,this._rendererActor.init(this._renderer),this._rendererActor.play(),ke.canvas=t,ke.parentDom.appendChild(t),ke.renderer=this._renderer,this._initEventListener()},dispose:function(){this._removeEventListener(),this._rendererActor.dispose(),this._renderer=null,this._rendererActor=null,this._composers=null,this._outlinePass=null,this._selectedObjects=null},_initEventListener:function(){T.needsRenderer.add(this._onNeedsRenderer,this),T.worldCreated.add(this._onWorldCreated,this),T.sceneAdded.add(this._onSceneAdded,this),T.sceneRemoved.add(this._onSceneRemoved,this),T.cameraChanged.add(this._onCameraChanged,this),T.materialSelected.add(this._onMaterialSelected,this),T.clearOutLine.add(this._clearOutLine,this),T.composerAdded.add(this._onComposerAdded,this),T.composerEnabled.add(this._onComposerEnabled,this),T.passAdded.add(this._onPassAdded,this),T.passInsert.add(this._onPassInsert,this),T.sceneShift.add(this._onSceneShift,this),T.renderProxyAdded.add(this._addRenderProxy,this),T.renderProxyRemoved.add(this._removeRenderProxy,this),a.add(g.Resize,this._onWindowResize,this,99)},_clearOutLine:function(){this._outlinePass.selectedObjects=[],T.needsRenderer.dispatch()},_onComposerAdded:function(e,t,i){i=i||0===i?parseInt(i):1,(t=t||new THREE.EffectComposer(this._renderer)).rendererOrder=i,this._composers[e]=t,this._rendererActor.addComposer(t)},_onComposerEnabled:function(e,t){this._composers.hasOwnProperty(e)&&(this._composers[e].enabled=!1!==t)},_onPassAdded:function(e,t){this._composers[e].addPass(t)},_onPassInsert:function(e,t,i){i=i||0,this._composers[e].insertPass(t,i)},_onNeedsRenderer:function(){this._rendererActor.needsUpdate=!0},_onSceneAdded:function(e){this._rendererActor.addScene(e)},_onSceneRemoved:function(e){this._rendererActor.removeScene(e)},_onSceneShift:function(e){this._rendererActor.addScene(e,!0)},_onCameraChanged:function(e){this._rendererActor.updateCamera(e),T.needsRenderer.dispatch()},_onWorldCreated:function(){this._onWindowResize();var e=ke.rendererSize,t=it.getScene(),i=Ge.getCamera();this._outlinePass=new THREE.OutlinePass(new Q.SDK.Vector2(e.x,e.y),t,i),this._outlinePass.visibleEdgeColor.setStyle("#97009d"),this._outlinePass.renderToScreen=!0,this._onPassAdded("default",this._outlinePass)},_addRenderProxy:function(e){this._rendererActor.addSceneRenderProxy(e)},_removeRenderProxy:function(e){this._rendererActor.removeRenderProxy(e)},_onWindowResize:function(){var e=ke.parentDom.offsetWidth,t=ke.parentDom.offsetHeight,i=Ge.getCamera("default");null!==i&&(i.aspect=e/t,i.updateProjectionMatrix()),ke.rendererSize.set(e,t),this._renderer.setSize(e,t),this._rendererActor.setSize(e,t),this._outlinePass&&this._outlinePass.resolution.set(e,t),T.windowResize.dispatch(e,t),T.needsRenderer.dispatch()},_onMaterialSelected:function(e,t,i){if(!1!==i){var n=it.getScene(),s=n.sceneMaterialProxy;if(!(s.materialProxies.length<=1)){var a=s.materialProxies[e].material;this._selectedObjects=n.findObjectByMaterial(a)||[],this._outlinePass.selectedObjects=this._selectedObjects,T.needsRenderer.dispatch()}}},_removeEventListener:function(){T.needsRenderer.remove(this._onNeedsRenderer,this),T.sceneAdded.remove(this._onSceneAdded,this),T.cameraChanged.remove(this._onCameraChanged,this),T.worldCreated.remove(this._onWorldCreated,this),T.sceneRemoved.remove(this._onSceneRemoved,this),T.materialSelected.remove(this._onMaterialSelected,this),T.clearOutLine.remove(this._clearOutLine,this),T.composerAdded.remove(this._onComposerAdded,this),T.composerEnabled.remove(this._onComposerEnabled,this),T.passAdded.remove(this._onPassAdded,this),T.passInsert.remove(this._onPassInsert,this),T.sceneShift.remove(this._onSceneShift,this),T.renderProxyAdded.remove(this._addRenderProxy,this),T.renderProxyRemoved.remove(this._removeRenderProxy,this),a.remove(g.Resize,this._onWindowResize,this)}}),Object.assign(dt.prototype,{init:function(){this._initEventListener()},_initEventListener:function(){T.worldCreated.add(this._onWorldCreated,this),T.objectAdded.add(this._onObjectAdded,this),T.objectRemoved.add(this._onObjectRemoved,this),T.objectUnSelected.add(this._onObjectUnSelected,this),T.objectSelected.add(this._onObjectSelected,this),T.objectChanged.add(this._onObjectChanged,this),T.ViewUpdateTextureQuailty.add(this._changeTextureQuality,this),T.cameraRedo.add(this._onCameraRedo,this),T.enableControl.add(this._onEnableControl,this),T.disableControl.add(this._onDisableControl,this)},_changeTextureQuality:function(e){ke.quality=e,T.updateTextureQuality.dispatch()},_onWorldCreated:function(){var t=this,e=Ge.getCamera();this._editorControls=new THREE.OrbitControls(e,ke.parentDom),this._editorControls.enableTwoFingerZoomPan=!0,this._editorControls.enablePan=!0,this._editorControls.target=ke.cameraCenter,this._editorControls.addEventListener("change",function(){t._transformControls.update(),T.cameraMoved.dispatch(),T.needsRenderer.dispatch()});var i=null,n=null;this._transformControls=new THREE.TransformControls(e,ke.parentDom),this._transformControls.setModes(["translate","rotate"]),this._transformControls.addEventListener("change",function(){t.updateHelp()}),this._transformControls.addEventListener("mouseDown",function(){var e=t._transformControls.object;i=e.position.clone(),n=e.rotation.clone(),t._onDisableControl()}),this._transformControls.addEventListener("mouseUp",function(){var e=t._transformControls.object;if(void 0!==e){switch(t._transformControls.getMode()){case"translate":i.equals(e.position)||(e.position.copy(e.position),e.updateMatrixWorld());break;case"rotate":n.equals(e.rotation)||(e.rotation.copy(e.rotation),e.updateMatrixWorld())}T.objectChanged.dispatch(e),T.needsRenderer.dispatch()}t._onEnableControl()}),it.getScene("helper").add(this._transformControls),this._resetCamera(ke.sceneConfig.camera?e.position:null,ke.cameraCenter),this._editorControls.enableZoom=ke.enableZoom,ke.enableStartMovie?this._playStartMovie():this._startEditor()},updateHelp:function(){var e=this._transformControls.object;if(void 0!==e){var t=it.getScene("helper").getHelper(e);t&&t.update()}T.needsRenderer.dispatch()},_onEnableControl:function(){this._editorControls.enabled=!0},_onDisableControl:function(){this._editorControls.enabled=!1},_onObjectAdded:function(e,t){var i=it.getScene();i.addObject(e,t),Q.Utils.objectToCenter(e),it.getScene("helper").addHelper(e),ke.viewAreaSize=Q.Utils.getObjectSafeSize(i.viewLayer),T.needsRenderer.dispatch()},_onObjectRemoved:function(e){var t=it.getScene();t.removeObject(e),it.getScene("helper").removeHelper(e),ke.viewAreaSize=Q.Utils.getObjectSafeSize(t.viewLayer),T.needsRenderer.dispatch()},_onObjectChanged:function(e){e.isLight&&this._transformControls&&(this.updateHelp(),this._transformControls.update())},_onObjectUnSelected:function(e){var t=it.getScene("helper").getHelper(e);t&&(t.visible=!1),this._transformControls.detach(),T.needsRenderer.dispatch()},_onObjectSelected:function(e){var t=it.getScene("helper").getHelper(e);t&&(t.visible=!0,t.update()),this._transformControls.detach(),e.isLight&&(this._transformControls.attach(e),T.needsRenderer.dispatch())},_playStartMovie:function(){var e=this,t=Ge.getCamera(),i=ke.viewAreaSize,n=t.position.clone();t.position.set(n.x+5*i.x,n.y+5*i.y,n.z+10*i.z),this._onDisableControl(),T.cameraMovieStarted.dispatch(),I.getActor("PositionActor").moveTo(t,n,1800,ke.cameraCenter,function(){e._onEnableControl(),T.cameraMovieFinished.dispatch(),e._startEditor()},!1,v.Quad.easeOut)},_startEditor:function(){ke.sceneConfig.camera||T.CameraInitUpdate.dispatch(0),T.editorInited.dispatch(),T.ableSaveConfig.dispatch(!0),ke.autoRotate&&I.getActor("RotateActor").targetAxisRotate(Ge.getCamera(),ke.cameraCenter,"x",Math.PI/12)},_onCameraRedo:function(){var e=it.getScene();e.viewLayer.rotation.x=0,e.viewLayer.rotation.y=0,e.viewLayer.rotation.z=0,Q.Utils.objectToCenter(e.children[0]),this._resetCamera()},_resetCamera:function(e,t){var i=Ge.getCamera(),n=it.getScene(),s=ke.viewAreaSize,a=Math.max(s.x,s.y)/(2*Math.tan(i.fov*Math.PI/360)),r=n.position.clone();r=e?r.copy(e):r.set(r.x,r.y+s.y/3,1.3*a),t?ke.cameraCenter.copy(t):ke.cameraCenter.set(0,0,0),i.position.set(r.x,r.y,r.z),i.lookAt(ke.cameraCenter),T.needsRenderer.dispatch()},_removeEventListener:function(){T.worldCreated.remove(this._onWorldCreated,this),T.objectAdded.remove(this._onObjectAdded,this),T.objectRemoved.remove(this._onObjectRemoved,this),T.cameraRedo.remove(this._onCameraRedo,this),T.enableControl.add(this._onEnableControl,this),T.disableControl.add(this._onDisableControl,this)},dispose:function(){this._removeEventListener(),this._editorControls.dispose(),this._transformControls.dispose(),this._editorControls=null,this._transformControls=null}}),((ut.prototype=Object.create(y.prototype)).constructor=ut).prototype._initEventListener=function(){T.animUpdateTime.add(this._updateActionTime,this)},ut.prototype.addAnimation=function(e,t,i){if(!this._animations.hasOwnProperty(e.uri)){for(var n,s=new THREE.AnimationMixer(e),a=[],r=0,o=t.length;r<o;r++){var h=Q.Utils.clipAnimation(t[r],i);h&&(n=t[r].name,a.push({name:n,clips:h}),T.addAnimation.dispatch(e.uri,n,h))}s.timeScale=this._timeScale,0<a.length&&(this._animations[e.uri]={mixer:s,animations:a,aniData:i})}},ut.prototype.playAction=function(e,t,i){var n=[],s=this._animations[e.uri];if(s){t?t instanceof Array?n=t:n.push(t):n.push(s.animations[0].name);for(var a=0,r=n.length;a<r;a++)this._playAnimationAction(e,s,n[a],i)}},ut.prototype.updateSpeed=function(e){for(var t in this._timeScale=e,this._animations)this._animations[t].mixer.timeScale=this._timeScale},ut.prototype.update=function(e){if(1e3<e)return!0;var t,i;for(var n in e/=1e3,this._animations){if((t=this._animations[n].mixer).actions)for(var s in t.actions)if(!(i=t.actions[s]).action.isRunning()){var a=i.nextAction;if(a){var r;if(a.actionName instanceof Array){var o=d.getRandom(0,a.actionName.length-1);r=a.actionName[o]}else r=a.actionName;this.playAction(a.object,a.animationName,r)}i.action.stop(),delete t.actions[s]}t.update(e),T.animTickTok.dispatch(this._currentAction.time),this.needsUpdate=!0}},ut.prototype._playAnimationAction=function(e,t,i,n){var s,a,r,o;for(r=0,o=t.animations.length;r<o;r++)if(t.animations[r].name===i){a=t.animations[r].clips;break}var h,l,c,d,u,p=t.aniData?t.aniData.animations:null;if(p)for(r=0,o=p.length;r<o;r++)p[r].name===i&&(h=p[r].clips);if(n)s=n instanceof Array?n:[n];else if(s=[],h)for(r=0,o=h.length;r<o;r++)!0===(c=h[r]).autoPlay&&s.push(c.name);else s.push(a[0].name);if(h)for(var m in h)l||(l={}),l[(c=h[m]).name]=c;for(t.mixer.actions||(t.mixer.actions={}),t.mixer.stopAllAction(),r=0,o=a.length;r<o;r++)if(u=null,d=a[r].name,-1<s.indexOf(d)){var f=t.mixer.clipAction(a[r]);f.reset(),l&&l.hasOwnProperty(d)&&(c=l[d],f.setLoop(c.loop,c.repetitions),c.loop!==THREE.LoopRepeat&&(f.clampWhenFinished=!0),c.nextAction&&(u={object:e,animationName:c.nextAnimation,actionName:c.nextAction}),t.mixer.actions[d]={action:f,nextAction:u}),f.play(),this._currentAction=f,this.isPlaying||this.update(0),T.actionPlay.dispatch(d)}},ut.prototype._updateActionTime=function(e){this._currentAction.time=e,this.isPlaying||this.update(0)},ut.prototype._removeEventListener=function(){T.animUpdateTime.remove(this._updateActionTime,this)},ut.prototype.dispose=function(){y.prototype.dispose.call(this),this._removeEventListener(),this._animations=null,this._currentAction=null},pt.prototype={init:function(){this._initEventListener(),this._animationActor=new ut},_initEventListener:function(){T.objectAdded.add(this._onObjectAdded,this),T.playAction.add(this.playAction,this),T.loadingComplete.add(this._onLoadingComplete,this),T.animPlay.add(this._play,this),T.animPause.add(this._pause,this),T.animSetSpeed.add(this._updateSpeed,this)},playAction:function(e,t,i){var n,s;!e||e instanceof Array||(e=[e]);for(var a=0,r=ke.models.length;a<r;a++)s=(n=ke.models[a].model).uri,e&&-1===e.indexOf(s)||this._animationActor.playAction(n,t,i)},_onObjectAdded:function(e){if(e.hasOwnProperty("uri")){for(var t,i,n=0,s=ke.models.length;n<s;n++)if((i=ke.models[n]).model.uri===e.uri){t=i;break}var a=ke.sceneConfig.animations;if(t.animations){var r=a&&a.hasOwnProperty(e.uri)?a[e.uri]:null;this._animationActor.addAnimation(e,t.animations,r),this._hasAnimation||(this._hasAnimation=!0)}}},_onLoadingComplete:function(){ke.autoPlay&&(this._animationActor.play(),this.playAction(),T.animStartPlay.dispatch())},_play:function(){this._animationActor.play()},_pause:function(){this._animationActor.stop()},_updateSpeed:function(e){this._animationActor.updateSpeed(e)},_removeEventListener:function(){T.objectAdded.remove(this._onObjectAdded,this),T.playAction.remove(this.playAction,this),T.loadingComplete.remove(this._onLoadingComplete,this),T.animPlay.remove(this._play,this),T.animPause.remove(this._pause,this),T.animSetSpeed.remove(this._updateSpeed,this)},dispose:function(){this._removeEventListener(),this._animationActor.dispose(),this._animationActor=null}},((mt.prototype=Object.create(m.prototype)).constructor=mt).prototype._initView=function(){var e=this.setClass("organ-list"),t=(new p.Div).setClass("organItemDiv"),i=(new p.Span).setTextContent(this.title),n=(new p.Span).setTextContent(this.EngTitle).setClass("size");return t.add(i,n),e.add(t),e},mt.prototype._initEventListener=function(){},mt.prototype.bindClickEvent=function(e,t,i,n){this._onOpenClickEvent="function"==typeof e?e:null,this._onOpenClickTarget=t instanceof Object?t:null,this._onCloseClickEvent="function"==typeof i?i:null,this._onCloseClickTarget=n instanceof Object?n:null},((ft.prototype=Object.create(m.prototype)).constructor=ft).prototype._initView=function(){return this.setClass("organ")},ft.prototype.addItem=function(e,t,i){return e.setClass(t),e.itemId=this.length,this._list.push(e),this.renderTypeList.push(e.name),this.add(e),e.bindClickEvent(this._onOpenClick,this,this._onCloseClick,this),this.length++,e},ft.prototype.bindListClickEvent=function(e,t,i,n){this._onOpenClickEvent="function"==typeof e?e:null,this._onOpenClickTarget=t instanceof Object?t:null,this._onCloseClickEvent="function"==typeof i?i:null,this._onCloseClickTarget=n instanceof Object?n:null},ft.prototype._onOpenClick=function(e,t){this._onOpenClickEvent&&this._onOpenClickEvent.call(this._onOpenClickTarget,e,t)},ft.prototype._onCloseClick=function(e,t){this._onCloseClickEvent&&this._onCloseClickEvent.call(this._onCloseClickTarget,e,t)},ft.prototype.getItem=function(e,t){t=void 0===t?"itemId":t;for(var i=0,n=this._list.length;i<n;i++){var s=this._list[i];if(s[t]===e)return s}return null},ft.prototype.openDivItem=function(e){for(var t=0,i=this._list.length;t<i;t++)t==e?(this._list[t].setCloseView(),this._list[t].addClass("currentOrgan")):t<e?this._list[t].addClass("organMoveLeft_"+(t+1)):e<t&&this._list[t].addClass("organMoveRight_"+(this._list.length+1-t))},ft.prototype.closeDivItem=function(e){for(var t=0,i=this._list.length;t<i;t++)t==e?(this._list[t].setOpenView(),this._list[t].removeClass("currentOrgan")):this._list[t].setClass("organ-list")},ft.prototype.openSplitScreen=function(){this.addClass("organMoveIn")},ft.prototype.closeSplitScreen=function(){this.removeClass("organMoveIn")},_t.prototype={init:function(){this._initEventListener()},_initEventListener:function(){T.worldCreated.add(this._onWorldCreated,this),T.beginSplitScreen.add(this._beginSplitScreen,this),T.endSplitScreen.add(this._closeSplitScreen,this),T.applyRenderMap.add(this._applyRenderMap,this),a.add(g.Resize,this._onWindowResize,this)},_initView:function(){var e,t,i=xe.getUI("animate");null!==this._view&&(i.remove(this._view),this._view.dispose()),this._view=new ft("organList");for(var n=0,s=this._mapList.length;n<s;n++)t=this._renderList.indexOf(this._mapList[n]),e=new mt(this._renderNames[t],this._renderEnNames[t],this._itemNames[t]),this._view.addItem(e,"organ-list");i.add(this._view)},_onWorldCreated:function(){var e=ke.rendererSize,t=it.getScene(),i=Ge.getCamera();this._multiRenderPass=new Q.SDK.MultiRenderPass(t,i,{maps:this._renderList,width:e.x,height:e.y}),this._multiRenderPass.renderToScreen=!0,this._multiRenderPass.enabled=!1,T.passAdded.dispatch("default",this._multiRenderPass)},_onWindowResize:function(){var e=ke.rendererSize;this._multiRenderPass.setSize(e.x,e.y)},_beginSplitScreen:function(){this._multiRenderPass.enabled=!0,T.renderProxyAdded.dispatch("default"),this._show()},_closeSplitScreen:function(){this._multiRenderPass.enabled=!1,T.renderProxyRemoved.dispatch("default"),this._hide()},_show:function(){var e,t=this._extractMaps(it.getScene().objects);this._mapList=[];for(var i=this._renderList.length;0<=i;i--)e=this._renderList[i],-1<t.indexOf(e)&&this._mapList.push(e);this._initView(),this._view.addClass("organ-show"),T.needsRenderer.dispatch()},_hide:function(){this._view.removeClass("organ-show"),T.needsRenderer.dispatch()},_applyRenderMap:function(e){this._multiRenderPass.showMap(e)},_extractMaps:function(e){var t,i,n,s,a,r,o=[],h=this;function l(e){for(var t,i=0,n=h._renderList.length;i<n;i++)if(t=h._renderList[i],!(-1<o.indexOf(t)))switch(t){case"":case"wireframe":o.push(t);break;default:e[t]&&o.push(t)}}for(t=0,i=e.length;t<i;t++)if((a=e[t])instanceof THREE.Mesh)if((r=a.material)instanceof Array)for(n=0,s=r.length;n<s;n++)l(r[n]);else l(r);return o},_removeEventListener:function(){T.worldCreated.remove(this._onWorldCreated,this),T.beginSplitScreen.remove(this._beginSplitScreen,this),T.endSplitScreen.remove(this._closeSplitScreen,this),T.applyRenderMap.remove(this._applyRenderMap,this),a.remove(g.Resize,this._onWindowResize,this)},dispose:function(){this._removeEventListener(),this._multiRenderPass.dispose(),this._view.dispose(),this._renderList=null,this._renderNames=null,this._renderEnNames=null,this._itemNames=null,this._multiRenderPass=null,this._mapList=null,this._view=null}},yt.prototype={execute:function(){it.getScene().rotateLayer(this.layer,this.direction),this.lastDirection=this.direction},undo:function(){it.getScene().rotateLayer(this.layer,this.lastDirection,!0),this.lastDirection=null}},Object.assign(gt.prototype,{init:function(){this._initEventListener()},_initEventListener:function(){T.ableSaveConfig.add(this._updateSaveStatus,this),T.uploadTexture.add(this._uploadTexture,this),T.deleteTexture.add(this._deleterTexture,this),T.saveSceneStarted.add(this._onSaveSceneClick,this),T.publishStarted.add(this._publishClicked,this),T.switchCommand.add(this._switchCommand,this),T.cameraSaveButton.add(this._onCameraSaveStart,this),T.saveQuickPicStarted.add(this._saveCover,this),T.networkResponse.add(this._userConfig,this),T.drawImageToCanvas.add(this._drawImageToCanvas,this)},_updateSaveStatus:function(){this._ableSaveConfig=!0},_onCameraSaveStart:function(e){var t=ze.saveCanvas(ke.canvas,58,58);T.ViewPicSaved.dispatch(e,t)},_switchCommand:function(e){new yt(e).execute()},_uploadTexture:function(n,e,s){var a={};a["UploadTexture[textureFile]"]=e,a.oid=ke.oid,a[ke.csrfName]=ke.csrfToken,Q.Utils.createTextureFromFile(e,function(t){var i=new b;i.startLoaded=!0,i.thumbStartLoaded=!0,i.isThumbLoaded=!0,i.isLoaded=!0,t.anisotropy=1,t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,i.texture=t,ze.post(ke.uploadTexture,a,function(e){void 0!==e&&""!==e&&0==e.errorCode&&""!==e.data?(i.key=e.data.tid,i.uri=e.data.uri,i.name=e.data.name,i.format=e.data.format,Oe.addTextureLoadModel(i),T.uploadTextureSucc.dispatch(e.data,n)):(t.dispose(),i.dispose(),i=null,T.uploadTextureFailed.dispatch(n))},s)},function(){ze.post(ke.uploadTexture,a,function(e){if(void 0!==e&&""!==e&&0==e.errorCode&&""!==e.data){var t=new b;t.key=e.data.tid,t.uri=e.data.uri,t.name=e.data.name,t.format=e.data.format,Oe.addPreloadTexture(t),T.uploadTextureSucc.dispatch(e.data,n)}else T.uploadTextureFailed.dispatch(n)},s)})},_deleterTexture:function(e,t){for(var i,n=it.getScene().sceneMaterialProxy.materialProxies,s=0,a=n.length;s<a;s++)for(var r in i=n[s].maps)i.hasOwnProperty(r)&&i[r]==e&&T.clearTexture.dispatch(s,r);T.clearDrawMap.dispatch(),T.updateMaterialProxy.dispatch(n),T.deleteTextureSucc.dispatch(t)},_onSaveSceneClick:function(){if(this._ableSaveConfig){T.clearOutLine.dispatch();var e=ze.getTextureIds(),t=ze.toJSON(),i=(ze.getCameraImg(),new C);i.pid=Z,i.data={oid:ke.oid,cfg:JSON.stringify(t),tid:e,cameraImg:null},T.networkRequest.dispatch(i)}},_saveCover:function(){T.clearOutLine.dispatch();var e=ze.saveCanvas(ke.canvas),t=new C;t.pid=ee,t.data={oid:ke.oid,img:JSON.stringify(e)},T.networkRequest.dispatch(t)},_publishClicked:function(){this._isPublished=1,this._onSaveSceneClick()},_publishStarted:function(){var e=new C;e.pid=te,e.data={oid:ke.oid},T.networkRequest.dispatch(e)},_userConfig:function(e){if(e.pid===Z)this._saveCover(),0==e.errorCode&&(T.updateCameraImgStatus.dispatch(),T.saveSenceConfigSucc.dispatch(),1===this._isPublished&&this._publishStarted());else if(e.pid===ee)0==e.errorCode&&T.saveCoverSucc.dispatch();else if(e.pid===te){if(0===e.errorCode){if(!ke.workId){var t=JSON.parse(e.data);ke.workId=t.data,T.ViewShowQrcode.dispatch()}T.publishSucc.dispatch(ke.workId)}else T.publishFailed.dispatch();this._isPublished=0}},_drawImageToCanvas:function(e,t){ze.drawImageToCanvas(e,t)}}),((vt.prototype=Object.create(we.prototype)).constructor=vt).prototype._initView=function(){this._btnClose=new we(null,"fa fa-times-circle","i"),this._text=new we(null,"tips-ctt"),this.add(this._text,this._btnClose)},vt.prototype._initEventListener=function(){this.addEventListener(n.Click,this._onClick,this),this._btnClose.addEventListener(n.MouseDown,this._onClose,this)},vt.prototype.update=function(){"rollIn"===this._play?(this.opacity<.8&&(this.opacity+=.02),0<this.y?this.y-=.5:(this.opacity=.8,this._play="")):"rollOut"===this._play&&(0<this.opacity&&(this.opacity-=.03),this.y>-this.height?this.y-=.5:(this.opacity=0,this._play=""))},vt.prototype.updateConfig=function(e){this._text.html(e.content),this._uri=e.uri},vt.prototype.rollIn=function(){this.y=this.height,this.opacity=0,this._play="rollIn"},vt.prototype.rollOut=function(){this.y=0,this.opacity=.8,this._play="rollOut"},vt.prototype._onClick=function(){window.open(this._uri)},vt.prototype._onClose=function(e){e.stopPropagation(),e.preventDefault(),T.removeAD.dispatch()},vt.prototype.dispose=function(){we.prototype.dispose.call(this),this._text=null,this._btnClose=null},((wt.prototype=Object.create(_.prototype)).constructor=wt).prototype.init=function(){this._initView(),this._initEventListener()},wt.prototype._initView=function(){this._ad=new we("tips","tips abs"),this._text=new vt,this._text2=new vt,ke.parentDom.insertBefore(this._ad.dom,ke.canvas)},wt.prototype._initEventListener=function(){T.editorInited.add(this._next,this)},wt.prototype.update=function(e){0<=this._index&&(this._timer+=e,6e3<=this._timer&&this._next()),this._text.update(e),this._text2.update(e)},wt.prototype._next=function(){this._adList&&0!==this._adList.length&&(this._timer=0,this._index++,this._index>=this._adList.length&&(this._index=0),this._preText=this._currentText,this._currentText=this._currentText===this._text?this._text2:this._text,this._ad.add(this._currentText),this._currentText.updateConfig(this._adList[this._index]),this._currentText.rollIn(),this._preText&&this._preText.rollOut(),this.play())},wt.prototype._removeEventListener=function(){T.editorInited.remove(this._next,this)},wt.prototype.dispose=function(){this._removeEventListener(),this._ad.dom.parentNode.removeChild(this._ad.dom),this._text2.dispose(),this._ad.dispose(),this._adList=null,this._ad=null,this._text=null,this._text2=null,this._currentText=null,this._preText=null,_.prototype.dispose.call(this)},Object.assign(St.prototype,{init:function(){this._initEventListener(),this._initModules(),this._initScene(),this._startupModule.init()},_initEventListener:function(){T.preLoaderComplete.add(this._createWorld,this),T.removeAD.add(this._onRemoveAD,this)},dispose:function(){this._removeEventListener(),this._networkModule.dispose(),this._rendererModule.dispose(),this._editorModule.dispose(),this._animationModule.dispose(),this._uiEventsModule.dispose(),this._adModule&&this._adModule.dispose(),this._networkModule=null,this._startupModule=null,this._rendererModule=null,this._editorModule=null,this._animationModule=null,this._uiEventsModule=null,this._adModule=null,this._multiRenderModule&&(this._multiRenderModule.dispose(),this._multiRenderModule=null),o.stop()},_initScene:function(){var e=ke.sceneConfig,t=Ge.addCamera("default"),i=it.addScene("sky",Punk.SkyScene),n=it.addScene("default",Punk.PunkScene),s=it.addScene("helper",Punk.HelperScene);e.scene&&it.fromJSON(e.scene),e.camera?Ge.fromJSON(e.camera):Ge.getCameraConfig(0).active=1,e.light?Ke.fromJSON(e.light):Ke.applyPreset(0),T.sceneAdded.dispatch(i),T.sceneAdded.dispatch(n),T.sceneAdded.dispatch(s),T.cameraChanged.dispatch(t)},_initModules:function(){this._rendererModule=new ct,this._networkModule=new ht,this._startupModule=new nt,this._editorModule=new dt,this._animationModule=new pt,this._uiEventsModule=new gt,this._rendererModule.init(),this._networkModule.init(),this._editorModule.init(),this._animationModule.init(),this._uiEventsModule.init(),ke.isEditorMode||(this._multiRenderModule=new _t,this._multiRenderModule.init(),(!ke.isPunk||ke.enableAD)&&ke.ads&&0<ke.ads.length&&(this._adModule=new wt,this._adModule.init()))},_createWorld:function(){var e=it.getScene("sky");e.updateSky(),e.blur();for(var t=0,i=ke.models.length;t<i;t++)T.materialParsed.dispatch(ke.models[t].model.materials);o.speed=ke.framePerSecond,o.play(),T.worldCreated.dispatch()},_onRemoveAD:function(){null!==this._adModule&&(this._adModule.dispose(),this._adModule=null)},_removeEventListener:function(){T.preLoaderComplete.remove(this._createWorld,this),T.removeAD.remove(this._onRemoveAD,this)}}),Ct.prototype={_init:function(){this._initEventListeners()},_initEventListeners:function(){$(document).bind("keydown",this._onKeyDown)},_onKeyDown:function(e){switch(e.keyCode){case 90:T.cameraRedo.dispatch()}T.keyDown.dispatch(e)},_removeEventListeners:function(){$(document).unbind("keydown",this._onKeyDown)},dispose:function(){this._removeEventListeners()}},e.Editor3DPunk=function(e){var t=new s(e);ke.editorConfig=t,ke.isMobile=mobileCheck();var i=function(){(new St).init(),new Ct,a.init(ke.canvas)};n=xe.getUI("animate"),t.parentDom.appendChild(n.dom),i();var n},e.PunkEvents=T,e.GlobalData=ke,e.NetworkType={POST:0,GET:1},e.Quality={THUMB:-1,LOW:0,MIDDLE:1,HIGH:2,ORIGINAL:3},e.ViewLayer=0,e.Scene=0,e.PunkScene=1,e.SkyScene=2,e.HelperScene=3,e.CubeSky=0,e.HDRSky=1,e.ShaderType=ie,e.ToonShaderIndex=7,e.AddOperation=2,e.SmoothShading=2,e.NoColors=0,e.FrontSide=ne,e.BackSide=1,e.DoubleSide=2,e.DirectionalLight=1,e.PointLight=2,e.SpotLight=3,e.HemisphereLight=4,e.AmbientLight=5,e.NormalBlending=1,e.LessEqualDepth=3,e.AddEquation=100,e.OneMinusSrcAlphaFactor=205,e.SrcAlphaFactor=204,e.PunkLayers={MAPLAYER:"mapLayer",VIEWLAYER:"viewLayer",TIPLAYER:"tipLayer"},e.Directions={XL:"xLeft",XR:"xRight",YL:"yLeft",YR:"yRight",ZL:"zLeft",ZR:"zRight"},e.CommandType={LayerCommand:1},e.SkyBoxChange=0,e.SkyColor=1,e.SkyBackground=2,e.skyTransparency=3,e.CtrlAction={QUALITY:"quality",MATERIAL:"material"},e.QualityAction={THUMB:-1,LOW:0,MIDDLE:1,HIGH:2,ORIGINAL:3},e.MaterialAction={NOSHADER:"noShader",PBR:"pbr",MATCAP:"matCap"},Object.defineProperty(e,"__esModule",{value:!0})});
