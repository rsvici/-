THREE.TGALoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TGALoader.prototype.load=function(e,a,r,t){var o=this,i=new THREE.Texture,s=new THREE.FileLoader(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){i.image=o.parse(e),i.needsUpdate=!0,void 0!==a&&a(i)},r,t),i},THREE.TGALoader.prototype.parse=function(e){function a(e,a,r,t,o,i,s,n,c){var d,l,p,h=c,f=0,g=k.width;for(p=a;p!==t;p+=r)for(l=o;l!==s;l+=i,f++)d=n[f],e[4*(l+g*p)+3]=255,e[4*(l+g*p)+2]=h[3*d+0],e[4*(l+g*p)+1]=h[3*d+1],e[4*(l+g*p)+0]=h[3*d+2];return e}function r(e,a,r,t,o,i,s,n){var c,d,l,p=0,h=k.width;for(l=a;l!==t;l+=r)for(d=o;d!==s;d+=i,p+=2)c=n[p+0]+(n[p+1]<<8),e[4*(d+h*l)+0]=(31744&c)>>7,e[4*(d+h*l)+1]=(992&c)>>2,e[4*(d+h*l)+2]=(31&c)>>3,e[4*(d+h*l)+3]=32768&c?0:255;return e}function t(e,a,r,t,o,i,s,n){var c,d,l=0,p=k.width;for(d=a;d!==t;d+=r)for(c=o;c!==s;c+=i,l+=3)e[4*(c+p*d)+3]=255,e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+1]=n[l+1],e[4*(c+p*d)+0]=n[l+2];return e}function o(e,a,r,t,o,i,s,n){var c,d,l=0,p=k.width;for(d=a;d!==t;d+=r)for(c=o;c!==s;c+=i,l+=4)e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+1]=n[l+1],e[4*(c+p*d)+0]=n[l+2],e[4*(c+p*d)+3]=n[l+3];return e}function i(e,a,r,t,o,i,s,n){var c,d,l,p=0,h=k.width;for(l=a;l!==t;l+=r)for(d=o;d!==s;d+=i,p++)c=n[p],e[4*(d+h*l)+0]=c,e[4*(d+h*l)+1]=c,e[4*(d+h*l)+2]=c,e[4*(d+h*l)+3]=255;return e}function s(e,a,r,t,o,i,s,n){var c,d,l=0,p=k.width;for(d=a;d!==t;d+=r)for(c=o;c!==s;c+=i,l+=2)e[4*(c+p*d)+0]=n[l+0],e[4*(c+p*d)+1]=n[l+0],e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+3]=n[l+1];return e}var n=0,c=1,d=2,l=3,p=9,h=10,f=11,g=48,u=4,E=0,T=1,_=2,m=3;e.length<19&&console.error("THREE.TGALoader.parse: Not enough data to contain header.");var w=new Uint8Array(e),v=0,k={id_length:w[v++],colormap_type:w[v++],image_type:w[v++],colormap_index:w[v++]|w[v++]<<8,colormap_length:w[v++]|w[v++]<<8,colormap_size:w[v++],origin:[w[v++]|w[v++]<<8,w[v++]|w[v++]<<8],width:w[v++]|w[v++]<<8,height:w[v++]|w[v++]<<8,pixel_size:w[v++],flags:w[v++]};!function(e){switch(e.image_type){case c:case p:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case d:case l:case h:case f:e.colormap_type&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case n:console.error("THREE.TGALoader.parse.tgaCheckHeader: No data");default:console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}(k),k.id_length+v>e.length&&console.error("THREE.TGALoader.parse: No data"),v+=k.id_length;var H=!1,y=!1,b=!1;switch(k.image_type){case p:H=!0,y=!0;break;case c:y=!0;break;case h:H=!0;break;case d:break;case f:H=!0,b=!0;break;case l:b=!0}var R=document.createElement("canvas");R.width=k.width,R.height=k.height;var A=R.getContext("2d"),x=A.createImageData(k.width,k.height),G=function(e,a,r,t,o){var i,s,n,c;if(s=r.pixel_size>>3,n=r.width*r.height*s,a&&(c=o.subarray(t,t+=r.colormap_length*(r.colormap_size>>3))),e){i=new Uint8Array(n);for(var d,l,p,h=0,f=new Uint8Array(s);h<n;)if(d=o[t++],l=1+(127&d),128&d){for(p=0;p<s;++p)f[p]=o[t++];for(p=0;p<l;++p)i.set(f,h+p*s);h+=s*l}else{for(l*=s,p=0;p<l;++p)i[h+p]=o[t++];h+=l}}else i=o.subarray(t,t+=a?r.width*r.height:n);return{pixel_data:i,palettes:c}}(H,y,k,v,w);!function(e,n,c,d,l){var p,h,f,w,v,H;switch((k.flags&g)>>u){default:case _:p=0,f=1,v=n,h=0,w=1,H=c;break;case E:p=0,f=1,v=n,h=c-1,w=-1,H=-1;break;case m:p=n-1,f=-1,v=-1,h=0,w=1,H=c;break;case T:p=n-1,f=-1,v=-1,h=c-1,w=-1,H=-1}if(b)switch(k.pixel_size){case 8:i(e,h,w,H,p,f,v,d);break;case 16:s(e,h,w,H,p,f,v,d);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}else switch(k.pixel_size){case 8:a(e,h,w,H,p,f,v,d,l);break;case 16:r(e,h,w,H,p,f,v,d);break;case 24:t(e,h,w,H,p,f,v,d);break;case 32:o(e,h,w,H,p,f,v,d);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}}(x.data,k.width,k.height,G.pixel_data,G.palettes);return A.putImageData(x,0,0),R};
